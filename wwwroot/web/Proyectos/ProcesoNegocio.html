<!--Proceso Negocio -->
<div class="pure-g" style="height: max-content">
    <div class="pure-u-1-24"></div>
    <div class="pure-u-22-24" style="margin: 0em 0em 0.5em 0em;">
        <div class="pure-g steps">
            <div v-for="(tab, index) in tabs" :key="index" class="pure-u-1-1 pure-u-md-1-4">
                <div class="wizarTab wizarTabNoSelect" :class="tabClasses[index]"
                    @click="handleNext(index)">
                    {{ tab }}
                </div>
            </div>
        </div>
    </div>

    <div class="pure-u-1-24"></div>
    <div class="pure-u-1-24"></div>
    <div class="pure-u-22-24 menuCard"
        :style="'height: calc(100vh - 13rem); overflow-y: auto; padding: 1em 1em 0 1em !important;' + (mode == 3 && esOpcionGuardada ? ' border: 2px solid rgb(245, 158, 11); background-color: rgba(254, 243, 199, 0.05);' : '')">
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Bienvenida------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div class="pure-g" v-if="mode == 0">
            <div class='pure-u-1-1 pure-u-md-1-1'>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.3em;">
                    Bienvenida a Cliente
                    <div v-if="isClienteVetado" class="btn-vetado" @click="modalveto">Situaci√≥n administrativa</div>
                </div>
                <div class="pure-g" style="align-items: center; justify-content: space-between; margin: .5em 0;">
                    <div class="pure-u-md-8-24" style="display: flex; align-items: center;">
                        <input type="text" v-model="cliente" maxlength="100" placeholder="N√∫mero de Documento (C.C, NIT, etc. Sin puntos ni espacios)"
                            class="pure-u-md-22-24"  @keyup.enter="busquedaCliente(true)" />
                
                        <div class="imgGraybutton" style="cursor: pointer;">
                            <img src="./img/ico/svg/search.svg" @click="busquedaCliente(true)" />
                        </div>
                    </div>

                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="continuarCliente">√öltimo Cliente</button>
                    </div>

                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="antencionRapida">Atenci√≥n Rapida</button>
                    </div>
                
                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="sincliente">Cotizar sin cliente</button>
                    </div>
                
                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="limpiarObjClient(); initIntlTel(ObjCliente)">Nuevo Cliente</button>
                    </div>
                </div>
                <div v-if="iscliente">
                    <div>
                        <div class="toggleSection" @click="mostrarCliente = !mostrarCliente" style="margin-top: 1rem;">
                            <span> Informaci√≥n B√°sica</span>
                            <span :class="{'arrow-up': mostrarCliente, 'arrow-down': !mostrarCliente}">‚ñº</span>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Nombres</span>
                                <input type='text' v-model='ObjCliente.nombres' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Apellido 1</span>
                                <input type='text' v-model='ObjCliente.apellido1' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Apellido 2</span>
                                <input type='text' v-model='ObjCliente.apellido2' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Fecha Nacimiento</span>
                                <input type='date' v-model='ObjCliente.fechaNacimiento' maxlength='100' placeholder="Seleccione" />
                            </div>
                        </div>
                    </div>
                    <div v-show="mostrarCliente" class="contenidoOculto">
                        <div style="height: 47vh; overflow-y: auto;">
                            <div class='formInputStandard'>
                            <label class="check" style="display: flex; align-items: center; gap: 0.4em;">
                                <input type="checkbox" value="1" v-model="isTitular" />
                                <span class="checkmark"></span>
                                <span style="font-size: 1.1em;">En representaci√≥n de:</span>
                            </label>
                        </div>
                        <div v-if="isTitular">
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Nombre empresa / Representado</span>
                                    <input type='text' v-model='ObjCliente.nombreEmpresa' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>C√©dula / NIT</span>
                                    <input type='text' v-model='ObjCliente.nit' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                        </div>
                            <div class='pure-u-4-5'>
                                <div class='formInputStandard'>
                                    <span>Direcci√≥n</span>
                                    <input type='text' v-model='ObjCliente.direccion' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Ciudad</span>
                                    <input type='text' v-model='ObjCliente.ciudad' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Barrio</span>
                                    <input type='text' v-model='ObjCliente.barrio' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Departamento</span>
                                    <input type='text' v-model='ObjCliente.departamento' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Pais</span>
                                    <input type='text' v-model='ObjCliente.pais' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Email 1</span>
                                    <input type='text' v-model='ObjCliente.email1' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Email 2</span>
                                    <input type='text' v-model='ObjCliente.email2' maxlength='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Telefono 1 / Indicativo</span>
                                    <input type='text' id="telefono1" v-model='ObjCliente.telefono1' maxlength='12' 
                                        @input="validarNumero" placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Telefono 2 / Indicativo</span>
                                    <input type='text' id="telefono2" v-model='ObjCliente.telefono2' maxlength='12' 
                                        @input="validarNumero" placeholder="Seleccione" />
                                </div>
                            </div>
                            <div v-if="iscliente">
                                <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.3em;">
                                    Documento de Identificaci√≥n
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Tipo Documento</span>
                                        <select v-model='ObjCliente.tipoDocumento'>
                                            <option value='' selected>Seleccione</option>
                                            <option value='CC'>C√©dula de Ciudadan√≠a</option>
                                            <option value='TI'>Tarjeta de Identidad</option>
                                            <option value='CE'>C√©dula de Extranjer√≠a</option>
                                            <option value='PA'>Pasaporte</option>
                                            <option value='NIT'>NIT</option>
                                            <option value='RC'>Registro Civil</option>
                                        </select>
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>N√∫mero Documento</span>
                                        <input type='text' v-model='ObjCliente.numeroDocumento' maxlength='10' placeholder="Seleccione" @input="validarNumero"/>
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Pa√≠s Expedici√≥n</span>
                                        <input type='text' v-model='ObjCliente.paisExpedicion' maxlength='100' placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Depart. Expedici√≥n</span>
                                        <input type='text' v-model='ObjCliente.departamentoExpedicion' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Ciudad Expedici√≥n</span>
                                        <input type='text' v-model='ObjCliente.ciudadExpedicion' maxlength='100' placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Fecha Expedici√≥n</span>
                                        <input type='date' v-model='ObjCliente.fechaExpedicion' maxlength='100' placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.3em;">
                                    Informaci√≥n Familiar
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-1'>
                                    <div class='formInputStandard'>
                                        <textarea v-model='ObjCliente.observaciones' rows='2' maxlength='500' placeholder="Ingrese observaciones" style="min-height: 43px;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
                    <div class="modal-card">
                        <div class="modal-header">
                            <h3>Situaci√≥n Administrativa del Cliente</h3>
                            <div class="close-btn" @click="closeModal">‚úï</div>
                        </div>
                        <div class="modal-body">
                            <div v-if="vetoData && vetoData.length">
                                <div v-for="(item, i) in vetoData" :key="i" class="veto-item">
                                    <p><strong>üìÖ Fecha:</strong> {{ item.fecha }}</p>
                                    <p><strong>‚ö†Ô∏è Motivo:</strong> {{ item.motivo }}</p>
                                    <p><strong>üë§ Responsable:</strong> {{ item.vetado_por }}</p>
                                    <hr v-if="i < vetoData.length - 1" />
                                </div>
                            </div>
                            <div v-else>
                                <p>No hay registros de veto para este cliente.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-1' v-if="iscliente">
                <div class='formInputStandard'>
                    <div class='pure-g'>
                        <div class='pure-u-1-1'>
                            <label class="check" style="display: inline-flex; align-items: center;">
                                <input type="checkbox" :value="1" v-model="policyAccepted"
                                    @change="acceptPolicy(policyAccepted)" />
                                <span class="checkmark"></span>
                                <span style="margin-right: 0.5em;">
                                    Al enviarnos su informaci√≥n personal usted autoriza a CONSTRUCTORA CAPITAL BOGOT√Å
                                    S.A.S y
                                    CONSTRUCTORA CAPITAL MEDELL√çN S.A.S en adelante ‚ÄúEL RESPONSABLE‚Äù para que traten sus
                                    datos de
                                    conformidad con la autorizaci√≥n <a
                                        href="https://www.constructoracapital.com/autorizacion-tratamiento-datos-personales"
                                        target="_blank">aqu√≠ indicada</a>.
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="israpida" class="pure-u-1">
                <div class="formDivision" style="font-size: 1.2em; margin-top: 1em;">
                    Atenci√≥n R√°pida
                </div>
                <div class="pure-g">
                    <div class="pure-u-1 pure-u-md-1-2">
                        <div class="formInputStandard">
                            <span>Nombres</span>
                            <input type="text" v-model="ObjCliente.nombres" maxlength="100" placeholder="Seleccione" @input="validarTexto"/>
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>Apellido 1</span>
                            <input type='text' v-model='ObjCliente.apellido1' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>Apellido 2</span>
                            <input type='text' v-model='ObjCliente.apellido2' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <div class="formInputStandard">
                            <span>Email</span>
                            <input type="text" v-model="ObjCliente.email1" maxlength="100" placeholder="Seleccione" />
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>N√∫mero Documento</span>
                            <input type='text' v-model='ObjCliente.numeroDocumento' maxlength='10' placeholder="Seleccione" @input="validarNumero"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Registro--------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div class="pure-g" v-if="mode == 1">
            <div class='pure-u-4-5' style="font-size: 1.6em;">
                {{ ObjCliente.nombres + " " + ObjCliente.apellido1 + " " +  ObjCliente.apellido2 }}
            </div>
            <div class='pure-u-1-5' style="text-align: right;">
                <button @click="showRotafolio">Ver Rotafolio</button>
            </div>
            <div class="pure-u-1-1 tabs-container-registro">
                <div v-for="(tabItem, index) in tab" :key="index" @click="activeTab = index" :class="[
                    'tab-registro', { active: activeTab === index },{ 'highlight-text': tabItem === 'Registros de compras' && registroCompras.length > 0 }]">
                    {{ tabItem }}
                    <span v-if="tabItem === 'Registros de compras' && registroCompras.length > 0" class="dot"></span>
                </div>
            </div>
            <div v-if="activeTab == 0">
                <div class='pure-u-1-1 formDivision'">
                    <span style="font-size: 1.5em;">Registros de visita</span>
                    <button @click="limpiarObj(1)" style="float: right;">Nueva visita</button>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-4 filtro-proyecto-inline' style="display: inline-flex;">
                    <label for="filtro-proyecto" style="white-space: nowrap;">Filtrar por Proyecto:</label>
                    <select v-model="filtroProyecto" id="filtro-proyecto" style="flex: 1;">
                        <option value="">Todos</option>
                        <option v-for="proy in proyectosUnicos" :key="proy" :value="proy">
                            {{ proy }}
                        </option>
                    </select>
                </div>
                <div class='pure-u-1-1 pure-u-md-3-4' style="text-align: end; margin-top: .5rem;">
                    <img src="../../img/cli/excel_02.png" alt="Excel" class="pure-img logoExcel"
                            @click="exportExcel(visitasFiltradas)" title="Descargar datos a Excel" />
                </div>
                <div
                    style="height: 11rem; overflow-y: auto; margin-top: 0.1em; border: 1px solid #666;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 16.5%;">Fecha</th>
                                <th>Proyecto</th>
                                <th>Tipo</th>
                                <th>Modo</th>
                                <th style="width: 30%;">Descripci√≥n</th>
                                <th>Contador</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in visitasFiltradas" :key="item.id_visita"
                                @click="editarVisita(item.id_visita)"
                                :class="{ 'seleccionado': item.id_visita === id_visita }">
                                <td>{{ item.fecha }}</td>
                                <td>{{ item.proyecto }}</td>
                                <td style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                    :title="item.nombre_tipo_registro">
                                    {{ item.nombre_tipo_registro }}
                                </td>
                                <td style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                    :title="item.nombre_modo_atencion">
                                    {{ item.nombre_modo_atencion }}
                                </td>
                                <td>{{ item.descripcion }}</td>
                                <td>{{ contadorProyectos[item.proyecto] || 0 }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div v-if="activeTab == 1">
                <div class='pure-u-1-1 formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.5em;">Registros de compras</span>
                    <span v-if="registroCompras.length > 0" style="font-size: 1.2em; color: #666; margin-left: 0.5em;">({{ registroCompras.length }} registros)</span>
                </div>
                <div style="height: 11rem; overflow-y: auto; margin-top: 0.5em;">
                    <div v-if="registroCompras.length === 0" style="display: flex; align-items: center; justify-content: center; height: 100%; color: #999; font-size: 1.1em;">
                        No hay registros de compras para este cliente en este proyecto.
                    </div>
                    <table v-else class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 15%;">Fecha</th>
                                <th>Proyecto</th>
                                <th>Tipo</th>
                                <th>Modo</th>
                                <th style="width: 30%;">Descripci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, idx) in registroCompras" :key="idx">
                                <td>{{ item.fecha }}</td>
                                <td>{{ item.proyecto }}</td>
                                <td>{{ item.tipo }}</td>
                                <td>{{ item.modo }}</td>
                                <td>{{ item.descripcion }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div :class="{ 'registro-bloqueado': camposBloqueados }" style="margin-top: .5rem;">
                <div v-if="camposBloqueados" class="banner-solo-lectura">
                    <span class="icono">üìã</span>
                    <span class="texto">Registro de solo lectura - Este registro no es del d√≠a de hoy y no puede ser modificado</span>
                </div>
                <div class='pure-u-1-1 formDivision'>
                    <span style="font-size: 1.2em;">Tipo de Registro (referido a la visita seleccionada en la tabla)</span>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1'>
                    <div class='formInputStandard'>
                        <div class='pure-g'>
                            <div v-for='(item, index) in tipo_registro' :key="index" class='pure-u-1-1 pure-u-md-1-6'
                                style='margin: .8rem 0 .8rem 0; '>
                                <label class="check">
                                    <input type="checkbox" :value='item.id_tipo_registro' :true-value="item.id_tipo_registro"
                                        v-model="ObjVisita.id_tipo_registro" :disabled="camposBloqueados" />
                                    <span class="checkmark"></span>
                                    {{ item.tipo_registro }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision'>
                    <span style="font-size: 1.2em;">Motivo de atenci√≥n (referido a la visita seleccionada in la tabla)</span>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-1">
                    <div class="formInputStandard">
                        <div class="pure-g" style="align-items: center; flex-wrap: wrap;">
                            <template v-for="(item, index) in modo_atencion" :key="index">
                                <div v-if="item.modo_atencion !== 'Tramites' && item.modo_atencion !== 'Otro'"
                                    class="pure-u-1-1 pure-u-md-1-8" style="display: flex; align-items: center;">
                                    <label class="check">
                                        <input type="checkbox" :value='item.id_modo_atencion' :true-value="item.id_modo_atencion"
                                            v-model="ObjVisita.id_modo_atencion" :disabled="camposBloqueados" />
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Tramites'" class="pure-u-1-1 pure-u-md-1-12"
                                    style="display: flex; align-items: center;">
                                    <label class="check">
                                        <input type="checkbox" v-model="ObjVisita.id_modo_atencion" :disabled="camposBloqueados"
                                            :value="item.id_modo_atencion" :true-value="item.id_modo_atencion"/>
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Tramites'" class="pure-u-1-1 pure-u-md-1-5"
                                    style="padding-left: 1rem;">
                                    <select v-model="ObjVisita.id_tipo_tramite" :disabled="camposBloqueados || !tramite">
                                        <option :value="0">[Tr√°mites]</option>
                                        <option v-for="opcion in tipo_tramite" :value="opcion.id_tipo_tramite">
                                            {{ opcion.tipo_tramite }}
                                        </option>
                                    </select>
                                </div>
                                <div v-if="item.modo_atencion === 'Otro'" class="pure-u-1-1 pure-u-md-1-12"
                                    style="padding-left: 1rem;">
                                    <label class="check">
                                        <input type="checkbox" v-model="ObjVisita.id_modo_atencion" :disabled="camposBloqueados"
                                            :value="item.id_modo_atencion" :true-value="item.id_modo_atencion"/>
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Otro'" class="pure-u-1-1 pure-u-md-1-4">
                                    <input type="text" v-model="ObjVisita.otro_texto" maxlength="100" placeholder="Especificar"
                                         style="width: 100%;" :disabled="camposBloqueados || !Otro"/>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision'>
                    <span style="font-size: 1.2em;">Otra informaci√≥n (referido a la visita seleccionada en latabla)</span>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Categor√≠a Medio</span>
                        <select v-model='ObjVisita.id_categoria' :disabled="camposBloqueados">
                            <option value='' disabled selected>Seleccione</option>
                            <option v-for='item in categoria' v-bind:value='item.id_categoria'>
                                {{ item.categoria }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Medio</span>
                        <select v-model='ObjVisita.id_medio' :disabled="camposBloqueados">
                            <option value='' disabled selected>Seleccione</option>
                            <option v-for='item in medio' v-bind:value='item.id_medio'>
                                {{ item.medio }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Motivo de Compra</span>
                        <select v-model='ObjVisita.id_motivo_compra' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in motivo_compra' v-bind:value='item.id_motivo_compra'>
                                {{ item.motivo_compra }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Presupuesto disponible</span>
                        <select v-model='ObjVisita.id_presupuesto_vivienda' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in presupuesto_vivienda' v-bind:value='item.id_presupuesto_vivienda'>
                                {{ item.rango }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Referencias</span>
                        <select v-model='ObjVisita.id_referencia' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in referencia' v-bind:value='item.id_referencia'>
                                {{ item.referencia }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1'>
                    <div class='formInputStandard'>
                        <span>Notas</span>
                        <textarea v-model='ObjVisita.descripcion' maxlength='200' rows='3' placeholder="Escriba sus notas aqu√≠" :disabled="camposBloqueados" style="width: 100%; min-height: 43px; resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
            <div class="btn-modern btn-fixed" @click="showAtencionModal">
                <span class="icon">‚úî</span>
                <span class="text">Terminar<br>Atenci√≥n</span>
            </div>
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- --------------------------- Cotizaci√≥n--------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div style="display: flex; flex-direction: column; gap: .5rem; height: 100%;" v-if="mode == 2">
            <div style="height: 50%;">
                <div class='pure-u-1-1' style="font-size: 2em;">
                    {{ ObjCliente.nombres + " " + ObjCliente.apellido1 + " " +  ObjCliente.apellido2 }}
                </div>
                <div class="formDivision" style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.5em;">
                    <span style="font-size: 1.8em;">Cotizaciones</span>
                    <label class="check" style="display: flex; align-items: center; gap: 0.4em;">
                        <input type="checkbox" value="1" v-model="ishistory" />
                        <span class="checkmark"></span>
                        <span style="font-size: 1.1em;">Historial</span>
                    </label>
                    <button @click="addCotizacion">Nueva Cotizaci√≥n</button>
                </div>
                <div style="width: 100%; height: calc(100% - 7rem); overflow-y: auto; margin-top: 0.5rem;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th class="col-1-6">Cotizaci√≥n</th>
                                <th class="col-1-6">Fecha</th>
                                <th class="col-3-6">Descripci√≥n</th>
                                <th class="col-1-6" title="Importe Base.">Importe Base</th>
                                <th class="col-1-6">Status</th>
                                <th class="col-1-6">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in cotizacionesFiltradas" :key="index" @click="seleccionarCotizacion(item.cotizacion, item.id_cotizacion)"
                                :class="{ seleccionado: cotizacionSeleccionada === item.cotizacion }">
                                <td class="col-1-6">{{ item.cotizacion }}</td>
                                <td class="col-1-6">{{ item.fecha }}</td>
                                <td class="col-3-6">
                                    <input type="text" v-model="item.descripcion" placeholder="Descripci√≥n"
                                        @focus="seleccionarCotizacion(item.cotizacion)" />
                                </td>
                                <td class="col-1-6" style="text-align: right;">
                                    {{ item.importe ? formatoMoneda(item.importe - (item.valor_descuento || 0)) : '' }}
                                </td>
                                <td class="col-1-6" style="text-align: center;">
                                    <span :style="{
                                        color: item.status === 'Opcionada' ? '#27ae60' : item.status === 'Borrador' ? '#f39c12' : '#95a5a6',
                                        fontWeight: item.status === 'Opcionada' ? 'bold' : 'normal'
                                    }">
                                        {{ item.status || 'Pendiente' }}
                                    </span>
                                </td>
                                <td v-if="!item.importe" style="text-align: center;">
                                <span class="delete"
                                    @click.stop.prevent="reqOperation(`Desea eliminar la cotizacion? <b></b>.`, deleteCotiz, null, item)"> ‚úñ
                                </span>
                            </td>
                            <td v-else></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div style="height: 50%;">
                 <div class='formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.8em;">Unidad</span>
                    <button style="float: right;" @click="abrirNuevoModulo">Agregar Item</button>
                </div>
                <div style="width: 100%; height: calc(100% - 7rem); overflow-y: auto; margin-top: 0.5rem;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 5%;">Torre</th>
                                <th style="width: 10%;">Tipo</th>
                                <th style="width: 8%;">ID Unidad</th>
                                <th style="width: 10%;">Fecha</th>
                                <th style="width: 36%;">Observaci√≥n</th>
                                <th style="width: 4%;" title="Precio Alternativo">Alt</th>
                                <th style="width: 13%;">
                                    <span v-if="unidades.some(u => u.mostrar_precio_alt)">Importe Alt</span>
                                    <span v-else>Importe</span>
                                </th>
                                <th style="width: 13%;">Descuento Base</th>
                                <th v-if="hayFeriasActivas" style="width: 13%;">Descuento Feria</th>
                                <th style="width: 8%;">Lista</th>
                                <th style="width: 4%;" title="Inventario terminado">IT</th>
                                <th style="width: 7%;">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in unidades" :key="index">
                                <td>{{ item.consecutivo }}</td>
                                <td>{{ item.tipo }}</td>
                                <td>{{ item.numero_apartamento }}</td>
                                <td>{{ item.fecha_formateada }}</td>
                                <td :title="item.observacion_apto">{{ item.observacion_apto }}</td>
                                <td style="text-align: center;">
                                    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                                        <label class="check" style="margin: 0; padding-left: 15px; position: relative;">
                                            <input type="checkbox" v-model="item.mostrar_precio_alt" @change="recalcularTotales" :disabled="esCotizacionOpcionada" />
                                            <span class="checkmark"></span>
                                        </label>
                                    </div>
                                </td>
                                <td style="text-align: right;">
                                    {{ formatoMoneda(item.mostrar_precio_alt ? item.precio_alt : item.valor_unidad) }}
                                </td>
                                <td style="text-align: right">
                                    {{ formatoMoneda(item.valor_descuento) }}
                                </td>
                                <td v-if="hayFeriasActivas" style="text-align: right">
                                    {{ formatoMoneda(item.descuento_feria || 0) }}
                                </td>
                                <td style="text-align: center;">{{ item.lista }}</td>
                                <td style="text-align: center;">{{ item.inv_terminado == '1' ? 'SI' : 'NO' }} </td>
                                 <td style="text-align: center;">
                                    <span class="delete" v-if="item.is_asignado == 1"
                                        @click.stop.prevent="reqOperation(`Desea eliminar el item? <b></b>.`, dropitem, null, item)"> ‚úñ
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="btn-modern btn-fixed" @click="showAtencionModal">
                    <span class="icon">‚úî</span>
                    <span class="text">Terminar<br>Atenci√≥n</span>
                </div>
            </div>
            <!-- <div class="pure-u-1-1"
                        style="margin-top: 0.5em; display: flex; align-items: center; justify-content: space-between;">
                        <div class="pure-u-1-1 pure-u-md-1-3" style="display: flex; align-items: center; gap: 6.5em;">
                            <samp class="pure-u-1-1 pure-u-md-1-3">Lista Activa:</samp>
                            <select v-model="">
                                <option value="" selected>[Seleccione]</option>
                                <option value="">Opci√≥n 1</option>
                            </select>
                        </div>
                 
                    </div> -->
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Opci√≥n ---------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div v-if="mode == 3">
            <div class="pure-u-1-1 formDivision"
                style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
                <div class="pure-u-1 pure-u-md-1-2" style="display: flex; align-items: center; gap: .5rem;">
                    <span style="font-size: 1.2em;">Opcionar:</span>
                    <samp class="resaltado">{{ textoCotizacion }}</samp>
                    <div v-if="esOpcionGuardada || modoSoloLectura" style="position: relative; display: inline-block; margin-left: 0.5rem;"
                         @mouseenter="mostrarTooltipOpcion = true"
                         @mouseleave="mostrarTooltipOpcion = false">
                        <div :style="'cursor: pointer; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; background-color: #f59e0b; border-radius: 50%; transition: all 0.3s ease; transform: ' + (mostrarTooltipOpcion ? 'scale(1.15)' : 'scale(1)') + '; box-shadow: ' + (mostrarTooltipOpcion ? '0 2px 8px rgba(245, 158, 11, 0.4)' : '0 1px 3px rgba(0,0,0,0.1)')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                        </div>
                        <div :style="'position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(' + (mostrarTooltipOpcion ? '8px' : '0px') + '); margin-top: 8px; min-width: 320px; max-width: 380px; background-color: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 0.75rem 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease; opacity: ' + (mostrarTooltipOpcion ? '1' : '0') + '; visibility: ' + (mostrarTooltipOpcion ? 'visible' : 'hidden') + '; z-index: 1000;'">
                            <div style="display: flex; align-items: flex-start; gap: 0.5rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 2px;">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                <span style="color: #92400e; font-weight: 500; font-size: 0.9rem; line-height: 1.4;" v-if="esOpcionGuardada && !modoSoloLectura">Esta opci√≥n ya ha sido guardada y est√° en modo de solo visualizaci√≥n. No se pueden realizar modificaciones.</span>
                                <span style="color: #92400e; font-weight: 500; font-size: 0.9rem; line-height: 1.4;" v-if="esCotizacionAntigua">Esta es una cotizaci√≥n antigua (no del d√≠a de hoy) y est√° en modo de solo visualizaci√≥n. No se pueden realizar modificaciones.</span>
                                <span style="color: #92400e; font-weight: 500; font-size: 0.9rem; line-height: 1.4;" v-if="unidadesNoDisponibles">Las unidades de esta cotizaci√≥n ya fueron opcionadas. Los datos se muestran en modo de solo visualizaci√≥n. No se pueden realizar modificaciones.</span>
                                <span style="color: #92400e; font-weight: 500; font-size: 0.9rem; line-height: 1.4;" v-if="modoSoloLectura && !esOpcionGuardada">Esta unidad ya fue opcionada por otro proceso. Los datos se muestran solo con fines informativos. No se pueden realizar modificaciones.</span>
                            </div>

                            <div style="position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 8px solid #f59e0b;"></div>
                            <div style="position: absolute; bottom: calc(100% - 2px); left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 7px solid transparent; border-right: 7px solid transparent; border-bottom: 7px solid #fef3c7;"></div>
                        </div>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-2"
                    style="display: flex; align-items: center; justify-content: flex-end; gap: .5rem; padding-right: .5rem;">
                    <span style="font-size: 1.2em;">Importe Base:</span>
                    <samp class="resaltado">{{ formatoMoneda(importeBase) }}</samp>
                </div>
            </div>
            <div class='pure-u-1-1 formDivision' style="font-size: 1em;">
                Reformas, Acabados, Descuento
            </div>
            <div class="pure-u-1 pure-u-md-1-1">
                <div class="pure-u-1 pure-u-md-1-8" v-if="valor_reformas != 0 && valor_reformas != '' && valor_reformas != null">
                    <div class="formInputStandard">
                        <span>Reformas <span v-if="reformaActivo" style="color: red; font-weight: bold;">(IT)</span></span>
                        <input type="text" style="text-align: right;" v-model="f_valor_reformas" @keyup="validarFormato"
                            :disabled="esOpcionGuardada || modoSoloLectura || reformaActivo" />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-8" v-if="valor_acabados != 0 && valor_acabados != '' && valor_acabados != null">
                    <div class="formInputStandard">
                        <span>Acabados <span v-if="reformaActivo" style="color: red; font-weight: bold;">(IT)</span></span>
                        <input type="text" style="text-align: right;" v-model="f_valor_acabados" @keyup="validarFormato"
                            :disabled="esOpcionGuardada || modoSoloLectura || reformaActivo"/>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Descuento Adicional</span>
                        <input type="text" style="text-align: right;" v-model="f_valor_descuento_adicional"
                            @keyup="validarFormato" :disabled="esOpcionGuardada || modoSoloLectura" />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-3-8">
                    <div class="formInputStandard">
                        <span class="info-container">
                            Descripci√≥n Descuento Adicional
                            <i class="info-icon">‚ìò</i>
                            <div class="tooltip-opc">
                                Debe ser aprobado por la direcci√≥n comercial.
                            </div>
                        </span>
                        <input type="text"/>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6" style="margin-top: 1.1rem; ">
                    <div class="formInputStandard" style="display: flex; align-items: flex-end; text-align: right;">
                        <div class="add-chip-modern" style="width: 100%;" @click="!(esOpcionGuardada || modoSoloLectura) && abrirModalCliente()" :style="(esOpcionGuardada || modoSoloLectura) ? 'opacity: 0.5; cursor: not-allowed;' : ''">
                            <span>Agregar Cliente</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class='pure-g formDivision' style="font-size: 1em;">
                <div class="pure-u-1 pure-u-md-1-2">
                    <span>Modo de Pago</span>
                </div>
                <div class="pure-u-1 pure-u-md-1-2" style="text-align: right;">
                    <span style="font-size: 1em; color: #17a2b8;">Importe Total (con reformas, acabados y descuento adicional):</span>
                    <samp class="resaltado">{{ formatoMoneda(importeActiva) }}</samp>
                </div>
            </div>
                  <div class="pure-u-1 pure-u-md-1-4">
                <div class="formInputStandard" style="display: flex; align-items: center; gap: 10px;">
                    <span class="info-container" style="white-space: nowrap;">
                        Valor Separaci√≥n
                        <i class="info-icon">‚ìò</i>
                        <div class="tooltip-opc">
                            (*) El valor de la separaci√≥n no hace parte del pago del inmueble si este es de caracter√≠stica VIS,
                            acepto y entiendo que estos recursos entregados a Constructora Capital o la Fiducia corresponden
                            al pago que realizar√° la constructora por los diferentes conceptos requeridos para poder escriturar
                            el inmueble, entre los que se encuentran Aval√∫os, Estudios de T√≠tulos, Tr√°mites de Subsidio,
                            Gastos Administrativos, Gastos de Notariado y Registro, entre otros y no es negociable por las
                            partes.
                        </div>
                    </span>
                    <input type="text" style="text-align: right; flex: 1;" v-model="f_valor_separacion" @keyup="validarFormato" disabled/>
                </div>
            </div>
            <div class="pure-g">
                <div class="pure-u-1 pure-u-md-3-8" style="margin-bottom: .5em;">
                    <fieldset :class="['opcionPago', { activo: pagoSeleccionado === 'contado' }]">
                        <div class="pure-u-1 pure-u-md-1-1">
                            <label class="check pure-u-1-6">
                                <input type="radio" name="pago" value="contado" v-model="pagoSeleccionado" :disabled="esOpcionGuardada || modoSoloLectura" />
                                <span class="checkmark"></span>
                                Contado
                            </label>
                        </div>
                        <div class="pure-u-1 pure-u-md-1-1" style="padding-top: 1.2rem;">
                            <span class="pure-u-1 pure-u-md-1-4">Modalidad:</span>
                            <div class="pure-u-1 pure-u-md-3-4">
                                <select class="pure-input-1" v-model="planSeleccionado" @change="calcularPlanPago"
                                    :disabled="esOpcionGuardada || modoSoloLectura || pagoSeleccionado !== 'contado'">
                                    <option value="">Seleccione</option>
                                    <option v-for="plan in planes_pago" :key="plan.id_planes_pago" :value="plan.id_planes_pago">
                                        {{ plan.descripcion }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="pure-u-1 pure-u-md-5-8">
                    <fieldset :class="['opcionPago', { activo: pagoSeleccionado === 'financiado' }]">
                        <div class="pure-u-1 pure-u-md-1-1">
                            <label class="check pure-u-1 pure-u-md-1-6" @click="!(esOpcionGuardada || modoSoloLectura) && (pagoSeleccionado = 'financiado')">
                                <input type="radio" name="pago" value="financiado" v-model="pagoSeleccionado" :disabled="esOpcionGuardada || modoSoloLectura"/>
                                <span class="checkmark"></span>
                                Financiado
                            </label>
                            <span class="pure-u-1 pure-u-md-1-6">1. Entidad:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="bancoSeleccionado" @change="cargarFactor"
                                    :disabled="esOpcionGuardada || modoSoloLectura || pagoSeleccionado !== 'financiado'">
                                    <option :value="0">Seleccione banco</option>
                                    <option v-for="b in banco_financiador" :key="b.id_bancos_financiador"
                                        :value="b.id_bancos_financiador">
                                        {{ b.banco }}
                                    </option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-24"></div>
                            <span class="pure-u-1 pure-u-md-1-6">2. Tipo:</span>
                            <div class="pure-u-1 pure-u-md-1-5">
                                <select class="pure-input-1" v-model="unidadSeleccionada" @change="cargarAnios"
                                    :disabled="esOpcionGuardada || modoSoloLectura || pagoSeleccionado !== 'financiado' || bancoSeleccionado == 0">
                                    <option value="0">Seleccione unidad</option>
                                    <option v-for="unidad in unidadesDisponibles" :key="unidad" :value="unidad">
                                        {{ unidad }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="pure-u-1 pure-u-md-1-1" style="padding-top: .5rem;">
                            <div class="pure-u-1 pure-u-md-1-6"></div>
                            <span class="pure-u-1 pure-u-md-1-6">3. A√±os:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="anioSeleccionado"
                                    :disabled="esOpcionGuardada || modoSoloLectura || pagoSeleccionado !== 'financiado' || unidadSeleccionada == 0"
                                    @change="onChangeAnio">
                                    <option value="">Seleccione a√±os</option>
                                    <option v-for="anio in listaAnios" :key="anio" :value="anio">
                                        {{ anio }} a√±os
                                    </option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-24"></div>
                            <span class="pure-u-1 pure-u-md-1-6">4. Modalidad:</span>
                            <div class="pure-u-1 pure-u-md-1-5">
                                <select class="pure-input-1" v-model="tipoFinanciacionSeleccionada"
                                    :disabled="esOpcionGuardada || modoSoloLectura || pagoSeleccionado !== 'financiado' || anioSeleccionado == 0"
                                    @change="calcularFinanciacion">
                                    <option value="">Seleccione Modalidad:</option>
                                    <option v-for="tipo in tipo_financiacion" :key="tipo.id_tipo_financiacion"
                                        :value="tipo.tipo_financiacion">
                                        {{ tipo.tipo_financiacion }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class='pure-u-1-1 formDivision' style="font-size: 1em;">
                Descuentos, subsidios, aportes, reformas y acabados.
            </div>
            <div class="pure-g">
                <div class="pure-u-1 pure-u-md-1-1">
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span>Ingresos Familiares</span>
                            <input ref="inputIngresos" style="text-align: right;" type="text" v-model="f_ingresos_mensuales"
                                @keyup="validarFormato" @blur="onBlurIngresos" @input="onInputIngresos"
                                :disabled="esOpcionGuardada || modoSoloLectura || !tipoFinanciacionSeleccionada" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span class="info-container">
                                Cesant√≠as
                            </span>
                            <input type="text" style="text-align: right;" v-model="f_valor_cesantias" @keyup="validarFormato"
                                :disabled="esOpcionGuardada || modoSoloLectura || f_ingresos_mensuales == 0" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span class="info-container">
                                Ahorros
                            </span>
                            <input type="text" style="text-align: right;" v-model="f_valor_ahorros" @keyup="validarFormato"
                                :disabled="esOpcionGuardada || modoSoloLectura || f_ingresos_mensuales == 0" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span title="Financiaci√≥n m√°xima permisible por ingresos">Fin. m√°x permisible <samp class="formula-pequena">(FMP)</samp></span>
                            <input style="text-align: right;" type="text" :value="formatoMoneda(valor_maxfinanciable)" disabled>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span title="Cuota mensual m√°ximo permisible por ingresos">Cuota m√°x perm.<samp class="formula-pequena">(CMP)</samp></span>
                            <input style="text-align: right;" type="text" :value="formatoMoneda(cuotaMaxima)" disabled/>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span title="Cuota del Importe m√°ximo financiable">Cuota m√°x fin.<samp class="formula-pequena">(CMF)</samp></span>
                            <input style="text-align: right;" type="text" :value="formatoMoneda(valorCreditoMillonFormateado)"
                                disabled title="Cuota mes M√°x.">
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-7">
                        <div class="formInputStandard">
                            <span title="Ingresos requeridos para el m√°ximo financiable">Ingr. req. m√°x fin.</span>
                                <input style="text-align: right;" type="text" :value="formatoMoneda(minimoFamiliar)" disabled>
                        </div>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-1">
                    <!-- <div class="pure-u-1 pure-u-md-1-7" style="margin-top: 1.5em">
                        <div class="formInputStandard">
                            <label class="check pure-u-1-1 pure-u-md-1-6" style="margin-top: .4em;"
                                v-show="pagoSeleccionado === 'financiado'">
                                <input type="checkbox" v-model="subsidioActivo" disabled/>
                                <span class="checkmark"></span>
                                Subsidio
                            </label>
                        </div>
                    </div> -->
                    <div class="pure-u-1 pure-u-md-1-6" v-show="subsidioActivo && valor_acabados == 0">
                        <div class="formInputStandard">
                            <span>
                                A√±o Entrega
                                <samp class="formula-pequena" v-if="!dentroRangoSubsidio">(Excede los 4 SMLV)</samp>
                            </span>
                            <select v-model="seleccionAnioEntrega" @change="calcularSubsidio" style="width: 100%;"
                                :disabled="esOpcionGuardada || modoSoloLectura || !subsidioActivo || pagoSeleccionado === 'contado' || !dentroRangoSubsidio">
                                <option value="">Seleccione</option>
                                <option v-for="anio in listaAniosEntrega" :key="anio" :value="anio">
                                    {{ anio }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6" v-show="subsidioActivo && valor_acabados == 0">
                        <div class="formInputStandard">
                            <span>Valor Subsidio</span>
                            <input style="text-align: right;" type="text" :value="formatoMoneda(valor_subsidio)" readonly
                                :disabled="esOpcionGuardada || pagoSeleccionado === 'contado'" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6" v-show="subsidioActivo && valor_acabados == 0">
                        <div class="formInputStandard">
                            <span>Caja de compensaci√≥n:</span>
                            <select v-model="caja_compensacion" style="width: 100%;"
                                :disabled="esOpcionGuardada || modoSoloLectura || !subsidioActivo || pagoSeleccionado === 'contado' || !dentroRangoSubsidio">
                                <option value="">Seleccione</option>
                                <option v-for="caja in cajas_compensacion" :key="caja.id_caja" :value="caja.id_caja">
                                    {{ caja.caja }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6"></div>
                    <div class="pure-u-1 pure-u-md-1-6">
                        <div class="formInputStandard">
                            <span class="detalle-label" style="margin: 1.5rem;"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="detalle" class="modal-overlay" @click.self="detalle = false">
                                    <div class="modal-card-large">
                                        <div class="modal-header">
                                            <h2>Detalles del c√°lculo</h2>
                                            <div class="close-btn" @click="detalle = false">‚úñ</div>
                                        </div>
                                        <div class="modal-body">
                                            <div class="grid-detalles elegante">
                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>IMPORTE TOTAL DE LA OPERACI√ìN</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Importe Unidades <strong>(A):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(importeOriginal)}}</span>
                                                            </div>
                                                        </li>   
                                                        <li>
                                                            <div>
                                                                Acabados <strong>(B):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ reformaActivo ? formatoMoneda(f_valor_acabados) : '$ 0' }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Reformas <strong>(C):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ reformaActivo ? formatoMoneda(f_valor_reformas) : '$ 0' }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Descuento Adicional <strong>(D):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_descuento_adicional)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Importe Total <strong>(E):</strong>
                                                                <div class="formula-pequena">
                                                                    ((A)+(B)+(C)-(D))
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(importeActiva)}}</span>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>

                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>IMPORTE M√ÅXIMO FINANCIABLE Y CUOTA MENSUAL HIPOTECA</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Modalidad Financiaci√≥n:
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ tipoFinanciacionSeleccionada || 'N/A' }}</span>
                                                            </div>
                                                        </li>
                                                        <li>A√±os Financiaci√≥n:
                                                            <span class="valor-badge">{{ anioSeleccionado || 'N/A' }}</span>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Factor/mill√≥n <strong>(F):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ f_factorBanco || 'N/A' }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                M√°ximo Financiable <strong>(G):</strong>
                                                                <div class="formula-pequena">
                                                                    70%(A-D)
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(valor_credito_base)}}</span>
                                                            </div>
                                                        </li>
                                                        <li> 
                                                            <div>
                                                                Cuota mes M√°x. financiable <strong>(H):</strong>
                                                            
                                                                <div class="formula-pequena">
                                                                    (G)x(F) / 1e6
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(valorCreditoMillonFormateado)}}</span>
                                                            </div>
                                                        </li>
                                                        <li> 
                                                            <div>
                                                                 <strong>(Nota):</strong>
                                                            
                                                                <div class="formula-pequena">
                                                                    M√°x. financiable: porcentaje de financiaci√≥n aplicado al total de la operaci√≥n.
                                                                    Cuota m√°x.: resultado de multiplicar el monto financiado por el factor/mill√≥n del plazo del cr√©dito.
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>

                                                <div class="card-detalle" v-if="excedentePagoCuotaInicial > 0">
                                                    <div class="card-header">
                                                        <h3 style="color: black;">AJUSTE POR EXCEDENTE EN CUOTA INICIAL</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Importe Financiaci√≥n Base:
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(valor_credito_final_base)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Excedente Pagado en Cuota Inicial:
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge" style="color: #27ae60; font-weight: bold;">{{formatoMoneda(excedentePagoCuotaInicial)}}</span>
                                                            </div>
                                                        </li>
                                                        <li style="border-top: 2px solid #27ae60; padding-top: 0.5rem; margin-top: 0.5rem;">
                                                            <div>
                                                                <strong>Importe Financiaci√≥n Ajustado:</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge" style="color: #2980b9; font-weight: bold;">{{formatoMoneda(importeFinanciacionAjustado)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                 <strong>(Nota):</strong>

                                                                <div class="formula-pequena">
                                                                    El cliente pag√≥ m√°s de lo requerido en la cuota inicial. Este excedente se aplica para reducir el importe de financiaci√≥n, resultando en un menor monto a financiar.
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>

                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>IMPORTE PERMISIBLE POR INGRESOS DE LA UNIDAD FAMILIAR</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Ingresos de la Unidad Familiar <strong>(I):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ formatoMoneda(f_ingresos_mensuales) }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Cuota m√°x. permisible UF <strong style="font-weight: bold;">(J):</strong>
                                                                <div class="formula-pequena">
                                                                    40% (I)
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ formatoMoneda(cuotaMaxima) }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Ingresos Reqs. para m√°x. financiable <strong>(K):</strong>
                                                                <div class="formula-pequena">
                                                                    (H) / 40%
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{ formatoMoneda(minimoFamiliar) }}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Financiaci√≥n m√°x. permisible por ingresos UF:
                                                                <div class="formula-pequena">
                                                                    Max. permisible (Cuota menor al 40% Ingre. grupo familiar)
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(valor_maxfinanciable)}}</span>
                                                            </div>
                                                        </li>
                                                        <li> Cuota mensual permisible:
                                                            <span class="valor-badge">{{formatoMoneda(cuotaMaxima)}}</span>
                                                        </li>
                                                    </ul>
                                                </div>


                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>SEPARACI√ìN Y GASTOS DE ESCRITURA</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Separaci√≥n <strong>(L):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_separacion)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Gastos de Escritura <strong>(M):</strong>
                                                                <div class="formula-pequena">
                                                                    (M1) + (M2) + (M3)
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_escrituras)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Notariales <strong>(M1):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_notariales)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Beneficiencia <strong>(M2):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_beneficiencia)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Registro <strong>(M3):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_registro)}}</span>
                                                            </div>
                                                        </li>
                                                         <li> 
                                                            <div>
                                                                 <strong>(Nota):</strong>
                                                            
                                                                <div class="formula-pequena">
                                                                    Nota: (1) Este valor de gastos notariales es aproximado. El valor final podr√≠a variar dependiendo de los anexos que
                                                                    lleve la escritura, las autenticaciones y biometrias de la misma. (2) Si el cliente quiere afectar el inmueble como
                                                                    vivienda familiar el valor se debe incrementar en $200.000.
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                        
                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>SUBSIDIOS, CESANTIAS Y AHORROS</h3>
                                                    </div>
                                                    <ul>
                                                        <li>
                                                            <div>
                                                                Subsidio <strong>(N):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(valor_subsidio)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                                Cesantias <strong>(O):</strong>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_cesantias)}}</span>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <div>
                                                            </div>
                                                            <div>
                                                                <span class="valor-badge">{{formatoMoneda(f_valor_ahorros)}}</span>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                        
                                                <div class="card-detalle">
                                                    <div class="card-header">
                                                        <h3>FECHAS ESTIMADAS</h3>
                                                    </div>
                                                    <ul>
                                                        <li>Entrega: <span class="valor-badge">{{ display_fecha_entrega || 'N/A' }}</span>
                                                        </li>
                                                        <li>Escrituraci√≥n: <span class="valor-badge">{{ display_fecha_escrituracion || 'N/A' }}</span>
                                                        </li>
                                                        <li>1ra cuota: <span class="valor-badge">{{ display_fecha_primera_cuota || 'N/A' }}</span>
                                                        </li>
                                                        <li>√öltima cuota: <span class="valor-badge">{{ display_fecha_ultima_cuota || 'N/A' }}</span>
                                                        </li>
                                                        <li>Meses: <span class="valor-badge">{{ d_meses || 'N/A' }}</span></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="infoCalculos">
                                        
                                                <div class="infoItem">
                                                    <b>Importe apto (Importe Total)</b>
                                                    Es el valor total del inmueble incluyendo acabados y reformas,
                                                    menos descuentos adicionales. Este valor sirve como base para
                                                    todos los c√°lculos financieros posteriores.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Financiaci√≥n m√°x. permisible ingr.</b>
                                                    Corresponde al monto m√°ximo que el banco permite financiar,
                                                    calculado como el 70% del importe total del inmueble.
                                                    Esta regla aplica seg√∫n la ciudad del proyecto y sus restricciones.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Cuota inicial preliminar</b>
                                                    Es la diferencia entre el importe total del inmueble y el m√°ximo
                                                    financiable. Representa el dinero que la familia debe aportar
                                                    con recursos propios.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Factor por mill√≥n</b>
                                                    Es un indicador bancario que define cu√°nto se paga por cada
                                                    mill√≥n financiado seg√∫n la tasa y el plazo del cr√©dito.
                                                    Permite estimar la cuota mensual.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Cuota mes M√°x. financiable</b>
                                                    Es la cuota mensual estimada del cr√©dito hipotecario, calculada
                                                    multiplicando el valor financiado por el factor por mill√≥n.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Ingreso real familia</b>
                                                    Es la suma del ingreso total de los miembros del hogar.
                                                    Se utiliza para evaluar si la familia cuenta con capacidad
                                                    de pago suficiente para el monto solicitado.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Cuota mensual permisible</b>
                                                    Es el valor m√°ximo de cuota mensual permitido por la entidad
                                                    financiera. No debe superar el 40% del ingreso familiar mensual.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>Ingr. Reqs. m√°x. financiable</b>
                                                    Es el ingreso que el hogar debe tener para poder asumir la cuota
                                                    proyectada sin exceder el 40% permitido por los bancos.
                                                </div>
                                        
                                                <div class="infoItem">
                                                    <b>M√°ximo financiable (seg√∫n ingresos)</b>
                                                    Es el valor m√°ximo de cr√©dito que la familia puede obtener seg√∫n
                                                    su nivel de ingresos, la cuota m√°xima permitida y el factor por mill√≥n.
                                                    Permite identificar si los ingresos son suficientes para financiar
                                                    el 70% del inmueble.
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>

            <div class="pure-u-1-1 formDivision" style="font-size: 1.2em; display: flex;">
                <div class="pure-u-1 pure-u-md-1-2">
                    <span style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <span class="info-container">
                            Importe Financiaci√≥n
                            <i class="info-icon">‚ìò</i>
                            <div class="tooltip-opc tooltip-wide tooltip-top">
                                (*) Financiar tu inmueble en pesos, tambi√©n conocido como <b>TASA FIJA</b>, te permite
                                garantizar el
                                valor mensual
                                de la cuota de tu cr√©dito que pagar√°s en el tiempo. No te costar√° m√°s, pero tampoco menos;
                                sabr√°s
                                exactamente cu√°l es tu exposici√≥n y flujo de caja mensual.
                                Este modelo de financiamiento tiende a ser m√°s costoso toda vez que las entidades financieras
                                cobran una
                                mayor tasa
                                en el momento del desembolso para cubrir posibles alzas.<br><br>
        
                                Otra opci√≥n es financiar tu inmueble en <b>UVR (Unidades de Valor Real)</b>, tambi√©n conocido
                                como
                                <b>TASA VARIABLE</b>.
                                Este tipo de financiamiento tiene como ventaja que te permite acceder a un cr√©dito con un menor
                                valor de
                                cuota mes a mes
                                y/o contar con un mayor valor total del cr√©dito sobre tu inmueble. Este cr√©dito se alinea con la
                                inflaci√≥n (factor UVR),
                                al que los bancos suman puntos seg√∫n el riesgo de cada cliente. La desventaja es que si la
                                inflaci√≥n
                                sube, el costo del cr√©dito tambi√©n lo hace,
                                aunque con l√≠mites y salvaguardas del Banco de la Rep√∫blica.<br><br>
        
                                Por <b>LEY</b>, puedes solicitar a tu entidad el cambio de modalidad o trasladar tu hipoteca a
                                otro
                                banco en cualquier momento sin penalidades,
                                siempre que cumplas con el perfil de riesgo.<br><br>
        
                                Finalmente, el cliente o cesionario de la cotizaci√≥n es responsable del pago √≠ntegro del
                                inmueble y de
                                obtener la financiaci√≥n.
                                Si para la fecha de aprobaci√≥n del cr√©dito o escritura el comprador tiene <b>70 a√±os o m√°s</b>,
                                podr√≠a
                                no obtener aprobaci√≥n
                                por pol√≠ticas financieras externas a la constructora. En tal caso, acepta asumir la
                                responsabilidad y
                                consecuencias contractuales
                                seg√∫n los plazos establecidos.
                            </div>
                        </span>
                        <span class="resaltado">
                            {{ formatoMoneda(valor_credito_final) }}
                        </span>
                    </span>
                </div>
                <div class="pure-u-1 pure-u-md-1-12">
                </div>
                <div class="pure-u-1 pure-u-md-1-1">
                    <span
                        style="display: flex; justify-content: space-between; width: 100%; padding-right: .5rem; align-items: center;">
                        <span class="info-container">
                            Cuota Inicial despu√©s de subsidio, reformas, acabados, cesant√≠as y/o ahorros:
                            <i class="info-icon">‚ìò</i>
                            <div class="tooltip-opc tooltip-top">
                                (*) Valor aproximado del pago inicial.
                            </div>
                        </span>
        
                        <span class="resaltado">{{ formatoMoneda(cuota_inicial_final) }}</span>
                    </span>
                </div>
            </div>
            <div class="pure-u-1-1 pure-u-md-1-1">
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Fecha Entrega</span>
                        <input type="date" style="text-align: right;" v-model="display_fecha_entrega" @change="calcularMesesMaximos"
                            disabled />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Fecha Escrituraci√≥n</span>
                        <input type="date" style="text-align: right;" v-model="display_fecha_escrituracion"
                            @change="calcularMesesMaximos" disabled />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Fecha 1ra Cuota</span>
                        <input type="date" style="text-align: right;" v-model="display_fecha_primera_cuota" @change="calcularMesesMaximos" :disabled="esOpcionGuardada" />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Fecha Ultima Cuota</span>
                        <input type="date" style="text-align: right;" v-model="display_fecha_ultima_cuota"
                            @change="calcularMesesMaximos" :disabled="esOpcionGuardada" />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard">
                        <span>Meses</span>
                        <input type="text" style="text-align: right;" v-model="d_meses" @input="validarMeses($event.target.value)" :disabled="esOpcionGuardada" />
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-6">
                    <div class="formInputStandard" style="margin-top: 1.5rem;text-align: center;">
                        <button @click="verAmortizacion">Ver Tabla</button>
                    </div>
                </div>
            </div>
            <div class='pure-u-1-1 formDivision' style="font-size: 1em;" v-if="!subsidioActivo">
                Escrituraci√≥n
            </div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="!subsidioActivo">
                <div class="formInputStandard">
                     <span class="info-container">
                        Gastos de Escritura
                        <i class="info-icon">‚ìò</i>
                        <div class="tooltip-opc">
                            Nota: (1) Este valor de gastos notariales es aproximado. El valor final podr√≠a variar dependiendo de los anexos que
                            lleve la escritura, las autenticaciones y biometrias de la misma. (2) Si el cliente quiere afectar el inmueble como
                            vivienda familiar el valor se debe incrementar en $200.000.
                        </div>
                    </span>
                    <input type="text" style="text-align: right;" v-model="f_valor_escrituras" @keyup="validarFormato" disabled/>
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="!subsidioActivo">
                <div class="formInputStandard">
                    <span>Notariales:</span>
                    <input type="text" style="text-align: right;" v-model="f_valor_notariales" @keyup="validarFormato" :disabled="esOpcionGuardada" />
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="!subsidioActivo">
                <div class="formInputStandard">
                    <span>Beneficiencia:</span>
                    <input type="text" style="text-align: right;" v-model="f_valor_beneficiencia" @keyup="validarFormato" :disabled="esOpcionGuardada || modoSoloLectura" />
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="!subsidioActivo">
                <div class="formInputStandard">
                    <span>Registro:</span>
                    <input type="text" style="text-align: right;" v-model="f_valor_registro" @keyup="validarFormato" :disabled="esOpcionGuardada || modoSoloLectura" />
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="!subsidioActivo">
                <div class="formInputStandard" style="text-align: center;margin-top: 1.5rem;">
                    <button @click="detalle = true">Ver detalle</button>
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-5-6" v-if="subsidioActivo"></div>
            <div class="pure-u-1 pure-u-md-1-6" v-if="subsidioActivo">
                <div class="formInputStandard" style="text-align: center;margin-top: 1.5rem;">
                    <button @click="detalle = true">Ver detalle</button>
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-3" style="margin-top: 0.5rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="white-space: nowrap;">Pie Legal (Opcional):</span>
                    <select v-model="id_pie_legal_seleccionado" :disabled="esOpcionGuardada || modoSoloLectura" style="flex: 1;">
                        <option value="">-- Seleccione un pie legal (opcional) --</option>
                        <option v-for="item in pies_legales_activos" :key="item.id_pie_legal" :value="item.id_pie_legal">
                            {{ item.pie_legal }}
                        </option>
                    </select>
                </div>
            </div>
            <div class="pure-u-1 pure-u-md-1-1">
                <div v-if="tablaAmortizacion" class="tabla-modal-overlay">
                    <div class="tabla-modal-box" style="position: relative;">
                        <div style="position: sticky; top: 0; background: #fff; z-index: 10; border: 1px solid #eee; padding: 1em 1.5em;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0; padding: 0; text-align: left; font-size: 1.4em;">Plan de Pagos</h3>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <img src="../../img/cli/excel_02.png" alt="Excel" class="pure-img logoExcel"
                                        @click="exportExcelAmortizacion" title="Descargar tabla a Excel con f√≥rmulas"
                                        style="cursor: pointer; width: 35px; height: 35px;" />
                                    <span @click="cerrarModalTabla"
                                        style="font-size: 2em; font-weight: bold; color: #999; cursor: pointer; line-height: 1; margin: 0; padding: 0;">√ó</span>
                                </div>
                            </div>
                        </div>

                        <div class="tabla-scroll-content">
                            <table class="dataTable" style="table-layout: auto !important;">
                                <thead>
                                    <tr>
                                        <th colspan="6" style="text-align: left; background-color: #00839C; color: white; padding: 8px;">Concepto</th>
                                        <th style="text-align: right; background-color: #00839C; color: white; padding: 8px;">Importe</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px; color: #1976d2; font-weight: bold;">Cuota Inicial</td>
                                        <td style="text-align: right; padding: 8px; color: #1976d2; font-weight: bold;">{{ formatoMoneda(cuotaInicialOriginal) }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                    <tr style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cuota Inicial menos Subsido, Cecantias y Ahorros</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(cuotaInicialMenosSCA) }}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="6" style="text-align: left; padding: 8px;" title="Cuota Inicial menos Subsido, Cecantias, Ahorros y Separaci√≥n">Cuota Inicial menos Subsido, Cecantias, Ahorros y Separaci√≥n</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(cuotaInicialMenosSCAySeparacion) }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                    <tr v-if="!subsidioActivo" style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cuota Separaci√≥n</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(valor_separacion) }}</td>
                                    </tr>
                                    <tr v-if="subsidioActivo" style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cuota Gastos Notariales</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(valor_separacion) }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>

                                    <tr style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px; font-weight: bold;">N√∫mero de cuotas</td>
                                        <td style="text-align: right; padding: 8px; font-weight: bold;">{{ d_meses }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                </tbody>

                                <thead>
                                    <tr style="border-top: 3px solid #00839C;">
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 5% !important; max-width: none !important;">Concepto</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 5% !important; max-width: none !important;">Fecha</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 8% !important; max-width: none !important;">Saldo Inicial Periodo</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 6% !important; max-width: none !important;">Cuota deseada</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 8% !important; max-width: none !important;">Cuota Calculada</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 8% !important; max-width: none !important;">Saldo Final</th>
                                        <th style="background-color: #00839C; color: white; padding: 8px; width: 60% !important; max-width: none !important; min-width: 400px !important;">Nota</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(fila, index) in tablaPeriodos" :key="index">
                                        <td style="width: 5% !important; max-width: none !important;">Cuota No.{{ fila.periodo }}</td>
                                        <td style="width: 5% !important; max-width: none !important;">{{ fila.fecha }}</td>
                                        <td style="text-align: right; width: 8% !important; max-width: none !important;">{{ formatoMoneda(fila.saldo_inicial) }}</td>
                                        <td style="width: 6% !important; max-width: none !important;">
                                            <input type="text" v-model="fila.cuota_deseada"
                                                @input="recalcularFila(index)"
                                                class="input-cuota"
                                                :class="{'input-modificado': (fila.cuota_deseada !== null &&fila.cuota_deseada !== '' &&!isNaN(Number(fila.cuota_deseada.toString().replace(/\D/g, ''))))}"
                                                :disabled="esOpcionGuardada"
                                                :readonly="esOpcionGuardada"
                                                @keyup="validar(index)" />
                                        </td>
                                        <td style="text-align: right; width: 8% !important; max-width: none !important;">{{ formatoMoneda(fila.cuota_calculada) }}</td>
                                        <td :class="{'texto-negativo': Number(fila.saldo_final.toString().replace(/[^0-9.-]/g, '')) < 0}" style="text-align: right; width: 8% !important; max-width: none !important;">
                                            {{ formatoMoneda(fila.saldo_final) }}
                                        </td>
                                        <td style="width: 60% !important; max-width: none !important; min-width: 400px !important; white-space: normal !important;"><input type="text" class="input-cuota" :disabled="esOpcionGuardada" :readonly="esOpcionGuardada" style="width: 100%;"></td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                </tbody>
                                <thead>
                                    <tr style="border-top: 3px solid #00839C;">
                                        <th colspan="6" style="text-align: left; background-color: #00839C; color: white; padding: 8px;">Concepto</th>
                                        <th style="text-align: right; background-color: #00839C; color: white; padding: 8px;">Importe</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Subsidios</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(valor_subsidio) }}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cesant√≠as</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(cesantias) }}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="6" style="text-align: left; padding: 8px;">Ahorros</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(ahorros) }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                    <tr style="border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cr√©dito hipotecario</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(valor_credito_final) }}</td>
                                    </tr>
                                    <tr style="height: 10px;">
                                        <td colspan="7" style="padding: 0; border: none;"></td>
                                    </tr>
                                    <tr style="background: #e3f2fd; border-top: 2px solid #00839C;">
                                        <td colspan="6" style="text-align: left; padding: 8px; font-weight: bold;">Total Importes</td>
                                        <td style="text-align: right; padding: 8px; font-weight: bold;">{{ formatoMoneda(totalImportes) }}</td>
                                    </tr>
                                    <tr v-if="!subsidioActivo">
                                        <td colspan="6" style="text-align: left; padding: 8px;">Cuota Gastos notariales</td>
                                        <td style="text-align: right; padding: 8px;">{{ formatoMoneda(valor_escrituras) }}</td>
                                    </tr>
                                    <tr v-if="!subsidioActivo" style="background: #e3f2fd;">
                                        <td colspan="6" style="text-align: left; padding: 8px; font-weight: bold;" title="Total Importes con gastos notariales">Total Importes con gastos notariales</td>
                                        <td style="text-align: right; padding: 8px; font-weight: bold;">{{ formatoMoneda(totalImportesConGastos) }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="mostrarModal" class="asunto-modal-overlay">
        <div class="asunto-modal-box">
            <span class="asunto-modal-close" @click="cerrarModalSeguimiento">√ó</span>
            <h3>{{ tituloModalSeguimiento }}</h3>
            <div style="padding: 0 1em;">
                <div style="margin-bottom: 1em;">
                    <label style="display: block; margin-bottom: 0.3em; font-weight: bold;">Tipo de Seguimiento:</label>
                    <select class="asunto-select" v-model="seguimientoData.tipo" style="width: 100%;">
                        <option disabled value="">Seleccione el seguimiento...</option>
                        <option v-for="opcion in opcionesSeguimientoActuales" :key="opcion" :value="opcion">{{ opcion }}</option>
                    </select>
                </div>
                <div style="margin-bottom: 1em;">
                    <label style="display: block; margin-bottom: 0.3em; font-weight: bold;">Fecha de Seguimiento:</label>
                    <input type="date" v-model="seguimientoData.fecha" style="width: 100%; padding: 0.5em; border: 1px solid #ccc; border-radius: 4px;" />
                </div>
                <div style="margin-bottom: 1em;">
                    <label style="display: block; margin-bottom: 0.3em; font-weight: bold;">Descripci√≥n:</label>
                    <textarea v-model="seguimientoData.descripcion" rows="3" placeholder="Ingrese una descripci√≥n del seguimiento..." style="width: 100%; padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; resize: vertical; height: 12vh;"></textarea>
                </div>
            </div>
            <div style="text-align: center; margin-top: 1em;">
                <button @click="confirmarSeguimiento">Confirmar</button>
                <button @click="cerrarModalSeguimiento" style="margin-left: 0.5em; background-color: #666;">Cancelar</button>
            </div>
        </div>
    </div>

    <div  v-if="mode == 3" class="pdf-export-section" style="padding: 20px; background: white; width: 100%; box-sizing: border-box; display: none;">
        <div id="contenedor-pdf-completo">
                <div style="padding: .5rem 0 .4rem 0; page-break-inside: avoid;">
                    <table class="pdf-table datos-personales" style="width: 100%; border-collapse: collapse; border: 1px solid #777; page-break-inside: avoid; font-size: 9px; margin-bottom: 1rem;">
                        <thead>
                            <tr>
                                <th colspan="12" style="background: #305496; color: white;"> Clientes </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="height: 10px;">
                                <td colspan="5" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    Nombre y Apellidos
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    Tipo Doc
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    # Doc
                                </td>
                                <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    Pais
                                </td>
                                <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    Ciudad
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; background: #bdd7ee;">
                                    Porcentaje
                                </td>
                            </tr>
                            <template v-for="(cliente, index) in clientesParaPDF" :key="'resumen-' + index">
                                <tr>
                                    <td colspan="1"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        # {{ index + 1 }}
                                    </td>
                                    <td colspan="4"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word; max-width: 150px;">
                                        {{ cliente.nombres }} {{ cliente.apellido1 }} {{ cliente.apellido2 }}
                                    </td>
                                    <td colspan="1"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        {{ cliente.tipoDocumento }}
                                    </td>
                                    <td colspan="1"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        {{ cliente.numeroDocumento }}
                                    </td>
                                    <td colspan="2"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        {{ cliente.pais }}
                                    </td>
                                    <td colspan="2"
                                        style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        {{ cliente.ciudad }}
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777;
                                        border-bottom: 1px solid #777; text-align: center; padding: 4px; word-wrap: break-word; overflow-wrap: break-word;">
                                        {{ cliente.porcentaje ? cliente.porcentaje + '%' : 'N/A' }}
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <table class="pdf-table datos-personales" style="width: 100%; border-collapse: collapse; border: 1px solid #777; page-break-inside: avoid; font-size: 9px;">
                        <template v-for="(cliente, index) in clientesParaPDF" :key="'detalle-' + index">
                            <thead>
                                <tr>
                                    <th colspan="12" :style="'background: #2f75b5;color: white;border-left: #777 solid 1px;' + (index > 0 ? ' border-top: 2px solid #777;' : '')">{{ clientesParaPDF.length >= 1 ? 'Detalle del Cliente #' + (index + 1) : 'Cliente' }}{{ clientesParaPDF.length >= 1 && cliente.porcentaje ? ' - Participaci√≥n: ' + cliente.porcentaje + '%' : '' }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-left: #777 solid 1px;">
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Nombres</b>
                                    </td>
                                    <td colspan="5" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.nombres }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Apellido 1</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.apellido1 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Apellido 2</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.apellido2 }}</span>
                                    </td>
                                </tr>
                                <tr style="border-left: #777 solid 1px;">
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word; background: #bdd7ee;">
                                        <b style="font-size: 8px;">Tipo Id</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.tipoDocumento }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">N√∫mero Id</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.numeroDocumento }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word; background: #bdd7ee; white-space: nowrap;">
                                        <b style="font-size: 8px;">F. nacimiento</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.fechaNacimiento }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee; white-space: nowrap;">
                                        <b style="font-size: 8px;">Pa√≠s Exped.</b>
                                    </td>
                                    <td colspan="3" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word; max-width: 80px;">
                                       <span style="font-size: 8px;">{{ cliente.paisExpedicion }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee; white-space: nowrap;">
                                        <b style="font-size: 8px;">F. Expedici√≥n</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.fechaExpedicion }}</span>
                                    </td>
                                </tr>
                                <tr style="border-left: #777 solid 1px;">
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Pais</b>
                                    </td>
                                    <td colspan="5" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.pais }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Depart.</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.departamento }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Ciudad</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                       <span style="font-size: 8px;">{{ cliente.ciudad }}</span>
                                    </td>
                                </tr>
                                <tr style="border-left: #777 solid 1px;">
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Direcci√≥n</b>
                                    </td>
                                    <td colspan="11" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.direccion }}</span>
                                    </td>
                                </tr>
                                <tr style="border-left: #777 solid 1px;">
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Tel√©fono 1</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.telefono1 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Tel√©fono 2</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.telefono2 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Email 1</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.email1 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;background: #bdd7ee;">
                                        <b style="font-size: 8px;">Email 2</b>
                                    </td>
                                    <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777;  word-wrap: break-word; overflow-wrap: break-word;">
                                        <span style="font-size: 8px;">{{ cliente.email2 }}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </template>
                    </table>
                    <table class="pdf-table datos-personales" style="width: 100%; border-collapse: collapse; border: 1px solid #777; page-break-inside: avoid; font-size: 9px; margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th colspan="12" style="background: #305496; color: white;">Importes de la cotizaci√≥n</th>
                            </tr>
                            <tr>
                                <td colspan="12" style="height: 0.5rem; border: none;"></td>
                            </tr>
                            <tr>
                                <th colspan="12" style="background: #2f75b5; color: white; text-align: left; padding: 4px; text-align: center;">Resumen de la Operaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; background: #bdd7ee;">
                                    <b style="font-size: 8px;">Ciudad</b>
                                </td>
                                 <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <span style="font-size: 8px;">{{ proyectoData?.sede || '-' }}</span>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; background: #bdd7ee;">
                                    <b style="font-size: 8px;">Ciudadela</b>
                                </td>
                                 <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <span style="font-size: 8px;">{{ proyectoData?.ciudadela || '-' }}</span>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; background: #bdd7ee;">
                                    <b style="font-size: 8px;">Proyecto</b>
                                </td>
                                <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <span style="font-size: 8px;">{{ proyectoData?.nombre || '-' }}</span>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px; background: #bdd7ee;">
                                    <b style="font-size: 8px;">Total Importe</b>
                                </td>
                                <td colspan="2" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <span style="font-size: 8px;">{{ formatoMoneda(importeOriginal) }}</span>
                                </td>
                            </tr>
                        </tbody>
                        <thead>
                            <tr>
                                <td colspan="12" style="height: 0.5rem; border: none;"></td>
                            </tr>
                            <tr>
                                <th colspan="12" style="background: #2f75b5; color: white; text-align: left; padding: 4px; text-align: center;">Importes Base y Totales de la operaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #bdd7ee;">
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Item #</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Id</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Clase</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Tipolog√≠a</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Tipo</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Torre</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Planta</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Imp. Base</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Reformas</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Acabados</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Dto. adicional</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe Total Item</b>
                                </td>
                            </tr>
                            <template v-for="(unidad, index) in unidades" :key="'unidad-' + index">
                                <tr>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">#{{ index + 1 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.id_unidad || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.clase || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.tipo || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.numero_apartamento || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.consecutivo || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.piso || extraerPiso(unidad.numero_apartamento) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(unidad.valor_unidad || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(unidad.valor_reformas || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(unidad.valor_acabados || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(unidad.valor_descuento || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(Number(unidad.valor_unidad || 0) + Number(unidad.valor_reformas || 0) + Number(unidad.valor_acabados || 0) - Number(unidad.valor_descuento || 0)) }}</span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <table class="pdf-table datos-personales" style="width: 100%; border-collapse: collapse; border: 1px solid #777; page-break-inside: avoid; font-size: 9px; margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th colspan="12" style="background: #2f75b5; color: white;">Forma de pago y financiaci√≥n</th>
                            </tr>
                            <tr style="background: #bdd7ee;">
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Item #</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Id</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe Base</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Reformas y Acabados</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Dto. adicional</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe Total</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">% Financiaci√≥n s/Imp. Base</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe estimado Financiaci√≥n</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe estimado Cesantias</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe estimado Subsidio</b>
                                </td>
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe estimado Ahorros</b>
                                </td>   
                                <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                    <b style="font-size: 8px;">Importe estimado Cuota Inicial</b>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="(unidad, index) in unidades" :key="'pago-' + index">
                                <tr>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">#{{ index + 1 }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.id_unidad || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(Number(unidad.valor_unidad || 0) - Number(unidad.valor_descuento || 0)) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(Number(unidad.valor_reformas || 0) + Number(unidad.valor_acabados || 0)) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(valor_descuento_adicional || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(Number(unidad.valor_unidad || 0) + Number(unidad.valor_reformas || 0) + Number(unidad.valor_acabados || 0) - Number(unidad.valor_descuento || 0) - Number(valor_descuento_adicional || 0)) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(valor_credito || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(valor_credito_final || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(f_valor_cesantias || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(valor_subsidio || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(f_valor_ahorros || 0) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ formatoMoneda(cuota_inicial_final || 0) }}</span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <table class="pdf-table datos-personales" style="width: 100%; border-collapse: collapse; border: 1px solid #777; page-break-inside: avoid; font-size: 9px; margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th colspan="12" style="background: #305496; color: white;">Especificaciones de las unidades</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="(unidad, index) in unidades" :key="'espec-' + index">
                                <tr>
                                    <td colspan="12" style="height: 0.5rem; border: none;"></td>
                                </tr>
                                <tr>
                                    <th colspan="12" style="background: #2f75b5; color: white; text-align: center;">
                                        Especificaciones Item #{{ index + 1 }}
                                    </th>
                                </tr>
                                <tr>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Clase</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.clase1 || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Tipo</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.tipo || unidadesDetalladas[index]?.observacion_apto || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Planta</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.piso || extraerPiso(unidad.numero_apartamento) }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;"># Alcobas</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.num_alcobas || '0' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;"># Ba√±os</b>
                                    </td>
                                     <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.num_banos || '0' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Invent. Terminado</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.inv_terminado == '1' ? 'SI' : 'NO' }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Area Total</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.area_total ? unidadesDetalladas[index].area_total + ' m¬≤' : '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">√Årea Priv. Cubierta</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.area_privada_cub ? unidadesDetalladas[index].area_privada_cub + ' m¬≤' : '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">√Årea Priv. Libre</b>
                                    </td>
                                    <td colspan="7" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.area_privada_lib ? unidadesDetalladas[index].area_privada_lib + ' m¬≤' : '-' }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Localizaci√≥n</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.localizacion || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Altura</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.altura || '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Asoleaci√≥n</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.asoleacion == 'PM' ? 'Sol de tarde' : unidadesDetalladas[index]?.asoleacion == 'AM' ? 'Sol de ma√±ana' : '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Cerca Porter√≠a</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidadesDetalladas[index]?.cerca_porteria == '0' ? 'NO' : unidadesDetalladas[index]?.cerca_porteria == '1' ? 'SI' : '-' }}</span>
                                    </td>
                                      <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Plazo Obra</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ d_meses ? d_meses + ' meses' : '-' }}</span>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; background: #bdd7ee; text-align: center; padding: 4px;">
                                        <b style="font-size: 8px;">Fecha entrega</b>
                                    </td>
                                    <td colspan="1" style="border-right: 1px solid #777; border-bottom: 1px solid #777; text-align: center; padding: 4px;">
                                        <span style="font-size: 8px;">{{ unidad.fecha_entrega_f || d_fecha_entrega || '-' }}</span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                <div style="padding: .4rem 2.2rem; margin-top: 2rem;">
                    <span style="color: #00839C; font-weight: bold; font-size: 15px;">
                        Img Unidad:
                        <samp style="font-size: 1rem;">
                            {{ unidades[0]?.tipo || '-' }}
                        </samp>
                    </span>
                    <div v-if="tipoProyecto"
                        style="display: flex; justify-content: center; align-items: center; gap: 1rem; padding: .8rem 0;">
                        <img :src="tipoProyecto" alt="Imagen de Apartamento" crossorigin="anonymous"
                            style="max-width: 48%; height: auto; max-height: 350px; object-fit: contain; border-radius: 6px;">
                        <img :src="tipoPlanta" alt="Imagen de Apartamento" crossorigin="anonymous"
                            style="max-width: 48%; height: auto; max-height: 350px; object-fit: contain; border-radius: 6px;">
                    </div>
                    <div v-else style="font-size: 12px; text-align: center; color: #666;">
                        No hay imagen disponible
                    </div>
                </div>
                <div v-if="mostrarOtrosLinks" style="padding: .8rem 1rem; font-size: 11px; color: #444; line-height: 1.3; margin-top: .5rem; page-break-inside: avoid;">
                    <h3 style="font-size: 13px; font-weight: 700; color: #007a8c; margin-bottom: .6rem; text-align: center; page-break-after: avoid;">
                        Otros Links
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: .3rem;">
                        <div v-if="proyectoData && Number(proyectoData.incluir_especificaciones_tecnicias) === 0 && proyectoData.link_especificaciones_tecnicias">
                            <span style="font-weight: 600; color: #444;">Link a especificaciones T√©cnicas PDF web: </span>
                            <a :href="proyectoData.link_especificaciones_tecnicias" target="_blank"
                                style="color: #007a8c; text-decoration: none; word-break: break-all;">
                                {{ proyectoData.link_especificaciones_tecnicias }}
                            </a>
                        </div>
                        <div v-if="proyectoData && Number(proyectoData.incluir_cartilla_negocios_cotizacion) === 0 && proyectoData.link_cartilla_negocios">
                            <span style="font-weight: 600; color: #444;">Link a Cartilla de Negocios Fiduciarios: </span>
                            <a :href="proyectoData.link_cartilla_negocios" target="_blank"
                                style="color: #007a8c; text-decoration: none; word-break: break-all;">
                                {{ proyectoData.link_cartilla_negocios }}
                            </a>
                        </div>
                        <div v-if="proyectoData && Number(proyectoData.incluir_brochure) === 0 && proyectoData.link_brochure">
                            <span style="font-weight: 600; color: #444;">Link a brochure PDF web: </span>
                            <a :href="proyectoData.link_brochure" target="_blank"
                                style="color: #007a8c; text-decoration: none; word-break: break-all;">
                                {{ proyectoData.link_brochure }}
                            </a>
                        </div>
                    </div>
                </div>

                <div style="padding: .8rem 1rem; font-size: 11px; color: #444; line-height: 1.4; margin-top: .5rem; page-break-inside: avoid;">
                    <h3 style="font-size: 13px; font-weight: 700; color: #007a8c; margin-bottom: .6rem; text-align: center; page-break-after: avoid;">
                        Informaci√≥n Legal y Financiera
                    </h3>

                    <div style="page-break-inside: avoid; margin-bottom: .6rem;">
                        <p style="text-align: justify; margin: .4rem 0; line-height: 1.5;">
                            <strong>CONSTRUCTORA CAPITAL MEDELL√çN S.A.S.</strong> y <strong>CONSTRUCTORA CAPITAL BOGOT√Å S.A.S.</strong>
                            dejan constancia en que la visita realizada el d√≠a de hoy nos autoriz√≥ para recolectar y tratar sus datos
                            personales.
                            La pol√≠tica de tratamiento de datos se encuentra disponible en
                            <a href="https://www.constructoracapital.com" target="_blank"
                                style="color: #007a8c; text-decoration: none;">www.constructoracapital.com</a>.
                            Los datos personales suministrados ser√°n tratados de manera segura y confidencial con fines informativos,
                            comerciales y de an√°lisis,
                            conforme a la Ley 1581 de 2012.
                        </p>

                        <p style="text-align: justify; margin: .4rem 0; line-height: 1.5;">
                            Para consultas o reclamaciones sobre el tratamiento de sus datos personales, puede comunicarse al correo
                            <a href="mailto:protecciondedatos@constructoracapital.com" style="color: #007a8c; text-decoration: none;">
                                protecciondedatos@constructoracapital.com
                            </a>
                            o a las l√≠neas telef√≥nicas (604) 4487440 en Medell√≠n y (601) 4430700 en Bogot√°.
                        </p>
                    </div>

                    <div style="border-top: 1px dashed #bbb; margin: .8rem 0;"></div>

                    <div style="page-break-inside: avoid; margin-bottom: .6rem;">
                        <p style="text-align: justify; margin: .4rem 0; line-height: 1.5;">
                            <strong>(*) Financiar tu inmueble en pesos</strong>, tambi√©n conocido como <strong>TASA FIJA</strong>, te
                            permite garantizar el valor mensual de la cuota de tu cr√©dito sin variaciones a lo largo del tiempo.
                            Tambi√©n puedes financiarlo en <strong>UVR (Unidades de Valor Real)</strong>, o <strong>TASA VARIABLE</strong>,
                            que te permite acceder a cuotas iniciales m√°s bajas,
                            pero sujetas al comportamiento de la inflaci√≥n.
                        </p>

                        <p style="text-align: justify; margin: .4rem 0; line-height: 1.5;">
                            Recuerda que por ley puedes solicitar el cambio de modalidad o trasladar tu hipoteca entre bancos sin penalidad,
                            siempre que cumplas con el perfil de riesgo requerido por la entidad financiera.
                            El √∫nico responsable del pago del inmueble y de la obtenci√≥n de la financiaci√≥n es el comprador o cesionario.
                            En caso de tener 70 a√±os o m√°s, la aprobaci√≥n del cr√©dito puede estar sujeta a condiciones especiales.
                        </p>
                    </div>

                    <div style="border-top: 1px dashed #bbb; margin: .8rem 0;"></div>

                    <div style="page-break-inside: avoid; margin-bottom: .6rem;">
                        <p style="text-align: justify; margin: .4rem 0; line-height: 1.5;">
                            <strong>(*) El valor de la separaci√≥n</strong> no hace parte del pago del inmueble si este es de caracter√≠stica
                            <strong>VIS</strong>.
                            Estos recursos entregados a Constructora Capital o a la Fiducia corresponden al pago por los diferentes
                            conceptos requeridos para poder escriturar el inmueble,
                            entre los que se incluyen <em>aval√∫os, estudios de t√≠tulos, tr√°mites de subsidio, gastos administrativos,
                                notariado y registro</em>,
                            entre otros, y no son negociables por las partes.
                        </p>
                    </div>

                    <div v-if="texto_pie_legal" style="border-top: 1px solid #bbb; margin: .8rem 0;"></div>

                    <div v-if="texto_pie_legal" style="margin-bottom: .6rem;">
                        <h4 style="font-size: 11px; font-weight: 700; color: #007a8c; margin-bottom: .4rem; text-align: center;">
                            Pie Legal<span v-if="nombre_pie_legal"> ({{ nombre_pie_legal }})</span>
                        </h4>
                        <div v-html="texto_pie_legal" style="text-align: justify; margin: .4rem 0; line-height: 1.5; font-size: 11px; width: 100%; overflow: visible; word-wrap: break-word;"></div>
                    </div>
                </div>
                <div style="text-align: center; font-size: 14px; line-height: 1.4; margin-top: 2.5rem; page-break-inside: avoid;">
                    <div style="border-top: 1px solid #000; width: 30%; margin: 0 auto 0.4rem;"></div>
                    <div>Asesor: <span style="font-weight: bold;">{{ asesor.nombres }}</span></div>
                    <div>Fecha: <span style="font-weight: bold;">{{ f_cotizacion }}</span></div>
                </div>

            </div>
        </div>
    </div>
    <div v-if="tablaPeriodos && tablaPeriodos.length > 0" class="pure-u-1 pure-u-md-1-1" style="margin-top: 2rem; display: none;">
        <div id="tabla-amortizacion-landscape" style="width: 100%; padding: 5px 0; background: white;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 8px 0;">
                <div style="width: 20%;">
                    <img src="../img/ico/logo-capital.png" alt="Logo Capital" crossorigin="anonymous"
                        style="max-width: 100%; max-height: 70px; object-fit: contain;">
                </div>
                <div style="flex: 1; text-align: center;">
                    <h3 style="color: #00839C; font-weight: bold; font-size: 30px; margin: 0;">Plan de Pagos</h3>
                </div>
                <div v-if="logoProyecto" style="width: 30%; display: flex; justify-content: flex-end; align-items: center;">
                    <img :src="logoProyecto" alt="Logo Proyecto" crossorigin="anonymous"
                        style="max-width: 100%; max-height: 70px; object-fit: contain;">
                </div>
                <div v-else style="width: 30%;"></div>
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 10px; border: 2px solid #999;">
                <thead>
                    <tr style="background: #00839C; color: white; text-align: center;">
                        <th colspan="6" style="padding: 4px; border: 1px solid #777; font-weight: bold; text-align: left;">Concepto</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; text-align: right;">Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #e3f2fd;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd; font-weight: bold; color: #1976d2;">Cuota Inicial</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; font-weight: bold; color: #1976d2;">{{ formatoMoneda(cuotaInicialOriginal) }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                    <tr style="background: white; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota Inicial menos Subsido, Cecantias, Ahorros y Separaci√≥n</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(cuotaInicialMenosSCAySeparacion) }}</td>
                    </tr>
                    <tr style="background: #f9f9f9;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota Inicial menos Subsido, Cecantias, Ahorros y Separaci√≥n</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(cuotaInicialMenosSCAySeparacion) }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                    <tr v-if="!subsidioActivo" style="background: white; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota Separaci√≥n</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(valor_separacion) }}</td>
                    </tr>
                    <tr v-if="subsidioActivo" style="background: white; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota Gastos Notariales</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(valor_separacion) }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                    <tr style="background: #e3f2fd; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd; font-weight: bold;">N√∫mero de cuotas</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; font-weight: bold;">{{ d_meses }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                </tbody>
                <thead>
                    <tr style="background: #00839C; color: white; text-align: center; border-top: 2px solid #00839C;">
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 5%; white-space: nowrap;">Concepto</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 5%; white-space: nowrap;">Fecha</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 8%; white-space: nowrap;">Saldo Inicial</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 6%; white-space: nowrap;">Cuota Deseada</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 8%; white-space: nowrap;">Cuota Calculada</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 8%; white-space: nowrap;">Saldo Final</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; width: 60%;">Nota</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(fila, index) in tablaPeriodos" :key="index" :style="index % 2 === 0 ? 'background: #f9f9f9;' : 'background: white;'">
                        <td style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota No. {{ fila.periodo }}</td>
                        <td style="text-align: center; padding: 4px; border: 1px solid #ddd;">{{ fila.fecha }}</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; white-space: nowrap;">{{ formatoMoneda(fila.saldo_inicial) }}</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; white-space: nowrap;">{{ formatoMoneda(fila.cuota_deseada) }}</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; white-space: nowrap;">{{ formatoMoneda(fila.cuota_calculada) }}</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; white-space: nowrap;">{{ formatoMoneda(fila.saldo_final) }}</td>
                        <td style="padding: 4px; border: 1px solid #ddd; text-align: left;">{{ fila.nota }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                </tbody>
                <thead>
                    <tr style="background: #00839C; color: white; text-align: center; border-top: 2px solid #00839C;">
                        <th colspan="6" style="padding: 4px; border: 1px solid #777; font-weight: bold; text-align: left;">Concepto</th>
                        <th style="padding: 4px; border: 1px solid #777; font-weight: bold; text-align: right;">Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: white; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Subsidios</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(valor_subsidio) }}</td>
                    </tr>
                    <tr style="background: #f9f9f9;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cesant√≠as</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(cesantias) }}</td>
                    </tr>
                    <tr style="background: white;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Ahorros</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(ahorros) }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                    <tr style="background: #f9f9f9; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cr√©dito hipotecario</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(valor_credito_final) }}</td>
                    </tr>
                    <tr style="height: 8px;">
                        <td colspan="7" style="padding: 0; border: none;"></td>
                    </tr>
                    <tr style="background: #e3f2fd; border-top: 2px solid #00839C;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd; font-weight: bold;">Total Importes</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; font-weight: bold;">{{ formatoMoneda(totalImportes) }}</td>
                    </tr>
                    <tr v-if="!subsidioActivo" style="background: white;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd;">Cuota Gastos notariales</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd;">{{ formatoMoneda(valor_escrituras) }}</td>
                    </tr>
                    <tr v-if="!subsidioActivo" style="background: #e3f2fd;">
                        <td colspan="6" style="text-align: left; padding: 4px; border: 1px solid #ddd; font-weight: bold;">Total Importes con gastos notariales</td>
                        <td style="text-align: right; padding: 4px; border: 1px solid #ddd; font-weight: bold;">{{ formatoMoneda(totalImportesConGastos) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="pure-u-1 pure-u-md-1-1" v-if="mostrarModalCliente">
        <div class="tabla-modal-overlay">
            <div class="tabla-modal-box">
                <span class="asunto-modal-close" @click="mostrarModalCliente = false">√ó</span>
                <h3>Agregar Cliente</h3>
                <div class="tabla-scroll-content">
                    <div style="height: 9rem; overflow-y: auto; margin-top: 0.1em;">
                        <table class="dataTable">
                            <thead>
                                <tr>
                                    <th>Nombres</th>
                                    <th>Apellido 1</th>
                                    <th>Apellido 2</th>
                                    <th style="width: 15%;">N√∫mero Documento</th>
                                    <th style="width: 12%;">% de copropiedad</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(c, index) in clientes" :key="index" @dblclick="seleccionarCliente(c, true)">
                                    <td>{{ c.nombres }}</td>
                                    <td>{{ c.apellido1 }}</td>
                                    <td>{{ c.apellido2 }}</td>
                                    <td>{{ c.numeroDocumento }}</td>
                                    <td>
                                        <input type="text" v-model="c.porcentaje" class="inputInline" @blur="guardarPorcentaje(c)" />
                                    </td>
                                    <td style="text-align: center;">
                                        <div @click="eliminarCliente(index)" class="delete">‚úñ</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class="pure-u-md-8-24" style="display: flex; align-items: center;">
                            <input type="text" v-model="clienteOpcional" maxlength="100"
                                placeholder="N√∫mero de Documento (C.C, NIT, etc. Sin puntos ni espacios)" class="pure-u-md-22-24"
                                @keyup.enter="busquedaCliente(false)" />
                            <div class="imgGraybutton" style="cursor: pointer;">
                                <img src="./img/ico/svg/search.svg" @click="busquedaCliente(false)" />
                            </div>
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2' style="text-align: right;margin-top: .2rem;">
                        <button @click="agregarCliente">Agregar</button>
                    </div>
                    <div v-if="iscliente">
                        <div>
                            <div class="toggleSection" @click="mostrarCliente = !mostrarCliente" style="margin-top: 1rem;">
                                <span> Informaci√≥n B√°sica</span>
                                <span :class="{'arrow-up': mostrarCliente, 'arrow-down': !mostrarCliente}">‚ñº</span>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Nombres</span>
                                    <input type='text' v-model='ObjClienteOpcional.nombres' maxlength='100' placeholder="Seleccione" @input="validarTexto"/>
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Apellido 1</span>
                                    <input type='text' v-model='ObjClienteOpcional.apellido1' maxlength='100' @input="validarTexto"
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Apellido 2</span>
                                    <input type='text' v-model='ObjClienteOpcional.apellido2' maxlength='100' @input="validarTexto"
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Fecha Nacimiento</span>
                                    <input type='date' v-model='ObjClienteOpcional.fechaNacimiento' maxlength='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                        </div>
                        <div v-show="mostrarCliente" class="contenidoOculto">
                            <div style="height: 45vh; overflow-y: auto;">
                                <div class='formInputStandard'>
                                    <label class="check" style="display: flex; align-items: center; gap: 0.4em;">
                                        <input type="checkbox" value="1" v-model="isTitular" />
                                        <span class="checkmark"></span>
                                        <span style="font-size: 1.1em;">En representaci√≥n de:</span>
                                    </label>
                                </div>
                                <div v-if="isTitular">
                                    <div class='pure-u-1-1 pure-u-md-1-3'>
                                        <div class='formInputStandard'>
                                            <span>Nombre empresa / Representado</span>
                                            <input type='text' v-model='ObjClienteOpcional.nombreEmpresa' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>C√©dula / NIT</span>
                                            <input type='text' v-model='ObjClienteOpcional.nit' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                </div>
                                <div class='pure-u-4-5'>
                                    <div class='formInputStandard'>
                                        <span>Direcci√≥n</span>
                                        <input type='text' v-model='ObjClienteOpcional.direccion' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-3'>
                                    <div class='formInputStandard'>
                                        <span>Ciudad</span>
                                        <input type='text' v-model='ObjClienteOpcional.ciudad' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-3'>
                                    <div class='formInputStandard'>
                                        <span>Barrio</span>
                                        <input type='text' v-model='ObjClienteOpcional.barrio' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Departamento</span>
                                        <input type='text' v-model='ObjClienteOpcional.departamento' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Pais</span>
                                        <input type='text' v-model='ObjClienteOpcional.pais' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-3'>
                                    <div class='formInputStandard'>
                                        <span>Email 1</span>
                                        <input type='text' v-model='ObjClienteOpcional.email1' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-3'>
                                    <div class='formInputStandard'>
                                        <span>Email 2</span>
                                        <input type='text' v-model='ObjClienteOpcional.email2' maxlength='100'
                                            placeholder="Seleccione" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Telefono 1 / Indicativo</span>
                                        <input type='text' v-model='ObjClienteOpcional.telefono1' maxlength='12'
                                            @input="validarNumero" placeholder="Seleccione" id="telefono1" />
                                    </div>
                                </div>
                                <div class='pure-u-1-1 pure-u-md-1-6'>
                                    <div class='formInputStandard'>
                                        <span>Telefono 2 / Indicativo</span>
                                        <input type='text' v-model='ObjClienteOpcional.telefono2' maxlength='12'
                                            @input="validarNumero" placeholder="Seleccione" id="telefono2" />
                                    </div>
                                </div>
                                <div v-if="iscliente">
                                    <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.3em;">
                                        Documento de Identificaci√≥n
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>Tipo Documento</span>
                                            <select v-model='ObjClienteOpcional.tipoDocumento'>
                                                <option value='' selected>Seleccione</option>
                                                <option value='CC'>C√©dula de Ciudadan√≠a</option>
                                                <option value='TI'>Tarjeta de Identidad</option>
                                                <option value='CE'>C√©dula de Extranjer√≠a</option>
                                                <option value='PA'>Pasaporte</option>
                                                <option value='NIT'>NIT</option>
                                                <option value='RC'>Registro Civil</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>N√∫mero Documento</span>
                                            <input type='text' v-model='ObjClienteOpcional.numeroDocumento' maxlength='10'
                                                @input="validarNumero" placeholder="Seleccione" />
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>Pa√≠s Expedici√≥n</span>
                                            <input type='text' v-model='ObjClienteOpcional.paisExpedicion' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>Depart. Expedici√≥n</span>
                                            <input type='text' v-model='ObjClienteOpcional.departamentoExpedicion' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>Ciudad Expedici√≥n</span>
                                            <input type='text' v-model='ObjClienteOpcional.ciudadExpedicion' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                    <div class='pure-u-1-1 pure-u-md-1-6'>
                                        <div class='formInputStandard'>
                                            <span>Fecha Expedici√≥n</span>
                                            <input type='date' v-model='ObjClienteOpcional.fechaExpedicion' maxlength='100'
                                                placeholder="Seleccione" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="pure-g" style="justify-content: center; gap: 1em; display: flex;">
                        <div lass="pure-u-auto">
                            <button class="pure-button button-fixed" @click="addCliente" >Guardar</button>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
    <!-- ------------------------------------------------------------ -->
    <!-- ----------------------------- Global------------------------- -->
    <!-- ------------------------------------------------------------ -->
    <div class="pure-u-1-1" v-if="iscliente">
        <div class="pure-g" style="justify-content: center; gap: 1em; display: flex; margin-top: .5em;">
            <div v-if="mode >= 0 && mode <= 1 && !camposBloqueados" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="handleSave">
                    {{ (mode == 1 && ObjVisita.id_visita && !camposBloqueados) ? 'Editar' : 'Guardar' }}
                </button>
            </div>
            <div v-if="mode == 2" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="handleNext(3)">Siguiente</button>
            </div>

            <div v-if="mode == 3"
                style="display: flex; align-items: center; justify-content: space-between; width: 90%; gap: 1rem">
                <!-- <div style="flex: 1;"></div> -->
                <div style="flex: 1; display: flex; justify-content: flex-end; gap: 2rem; text-align: center;">
                    <div v-if="id_opcion && !opcion_bloq" class="boton-accion" @click="loadCupones()">
                        <img src="../../img/ico/pasarela.png" alt="Imprimir">
                        <span>Cupon de Pago</span>
                    </div>
                    <div class="boton-accion" @click="showDaviviendaModal = true; clearDavivienda()" style="margin-right: auto;">
                        <img src="../../img/ico/davivienda.png" alt="Imprimir">
                        <span>Preabrobar Cr√©dito</span>
                    </div>
                    <div v-if="!esOpcionGuardada && !modoSoloLectura" class="boton-accion" @click="showAtencionModal">
                        <img src="../../img/ico/achievement_orange.png" alt="Terminar Atenci√≥n">
                        <span>Terminar Atenci√≥n</span>
                    </div>
                    <div v-if="!esOpcionGuardada && !modoSoloLectura" class="boton-accion" @click="guardarBorradorYCerrar"
                        :disabled="guardandoBorrador">
                        <img src="../../img/ico/save.png" alt="Guardar Borrador">
                        <span>{{ guardandoBorrador ? 'Guardando...' : 'Guardar Borrador' }}</span>
                    </div>
                    <div class="boton-accion" @click="guardarYGenerarPDF">
                        <img src="../../img/ico/printer.png" alt="Imprimir">
                        <span>S√≥lo Imprimir</span>
                    </div>
                    <div class="boton-accion">
                        <img src="../../img/ico/mail.png" alt="Mail">
                        <span>S√≥lo Enviar al Mail</span>
                    </div>
                    <div v-if="!esOpcionGuardada && !modoSoloLectura" class="boton-accion" @click="f_permitirOpcionar && (showOpcionarModal = true)"
                        v-bind:class="{'boton-accion-disabled': !f_permitirOpcionar}"
                        @mouseenter="tooltipVisible = !f_permitirOpcionar; tooltipMsg = 'Proyecto no habilitado para opcionar';"
                        @mouseleave="tooltipVisible = false;" @mousemove="updateCursorRight">
                        <img src="../../img/ico/achievement.png" alt="Opcionar">
                        <span>Enviar y Opcionar</span>
                    </div>
                </div>
                <div v-if="tooltipVisible" class="cursor-tooltip"
                    :style="{ top: tooltipY + 'px', right: tooltipX + 'px' }">
                    {{tooltipMsg}}
                </div>
            </div>
        </div>
    </div>
    <div class="pure-u-1-1" style="padding-top: 1em;" v-if="israpida">
        <div class="pure-g" style="justify-content: center; gap: 1em; display: flex;">
            <div v-if="mode == 0" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="nuevoCliente(1)">Guardar</button>
            </div>
        </div>
    </div>

<div v-if="showBorradorModal" class="asunto-modal-overlay">
    <div class="asunto-modal-box" style="max-width: 700px;">
        <span class="asunto-modal-close" @click="rechazarBorrador">√ó</span>
        <h3>Borrador Guardado</h3>
        <p style="margin: 0 0 1em 0; line-height: 1.6; text-align: center;">
            Guardado el <strong>{{ borradorData?.fecha_formato }}</strong>
        </p>
        <div style="margin: 0 0 1.5em 0; padding: 1em; background-color: #fff3cd; border-radius: 6px; text-align: center;">
            <div style="font-size: 1.1rem; font-weight: 600; color: #856404;">
                {{ textoCotizacion || borradorData?.textoCotizacion || borradorData?.texto_cotizacion || 'No hay unidades cotizadas en este borrador' }}
            </div>
        </div>

        <p style="margin: 0 0 1.5em 0; color: #666; text-align: center;">
            ¬øDeseas continuar editando este borrador o descartarlo y empezar de nuevo?
        </p>
        <div style="display: flex; gap: 1em; justify-content: center;">
            <button @click="rechazarBorrador" class="pure-button"
                style="background-color: #e74c3c; color: white;">
                Descartar
            </button>
            <button @click="aceptarBorrador" class="pure-button pure-button-primary">
                Continuar Editando
            </button>
        </div>
    </div>
</div>

<div v-if="showDaviviendaModal" class="asunto-modal-overlay">
    <div class="asunto-modal-box" style="min-width: 300px; max-width: 75vw; width: min-content; padding: 1rem;">
        <span class="asunto-modal-close" @click="showDaviviendaModal = false;">√ó</span>
        <h3 style="margin-bottom: .5rem; color: #E1111C;">Cr√©dito Davivienda</h3>
        <div v-show="davForm" style="width: 320px;">
            <div class="formInputStandard">
                <span>Actividad Laboral</span>
                <select v-model="davivienda.customerInformation.workActivity"
                    @change="davivienda.customerInformation.workActivity != 'EMPLOYEE'
                        ? (davivienda.customerInformation.contractType = null) : null">
                    <option :value="null">[Seleccione]</option>
                    <option value="EMPLOYEE">EMPLEADO</option>
                    <option value="INDEPENDIENT">INDEPENDIENTE</option>
                    <option value="PENSIONED">PENSIONADO</option>
                </select>
            </div>
            <div class="formInputStandard">
                <span>Tipo de Contrato</span>
                <select v-model="davivienda.customerInformation.contractType" 
                    :disabled="davivienda.customerInformation.workActivity != 'EMPLOYEE'">
                    <option :value="null">[Seleccione]</option>
                    <option value="PERMANENT">FIJO</option>
                    <option value="INDEFINED">INDEFINIDO</option>
                    <option value="SERVICE PROVISION">PRESTACI√ìN DE SERVICIOS</option>
                </select>
            </div>
            <div class="formInputStandard">
                <span>Confirmar Tel√©fono</span>
                <input type="text" @input="validarEntero(['davivienda','customerInformation','mobileNumber'])" 
                    v-model="davivienda.customerInformation.mobileNumber" maxlength="15">
            </div>
            <div class="formInputStandard">
                <span>Confirmar Email</span>
                <input type="text" v-model="davivienda.customerInformation.email" maxlength="100">
            </div>
            <div class="formInputStandard">
                <span>Ingresos Mensuales</span>
                <input type="text" @input="validarFormato" v-model="f_monthlyIncome">
            </div>
            <div class="formInputStandard">
                <span>N√∫mero de cuotas</span>
                <input type="text" @input="validarFormato($event); inRange($event, 0, 480)" v-model="f_instalments">
            </div>
            <div class="formInputStandard" style="display: flex; width: 100%; justify-content: center;">
                <button class="btn-davivienda" @click="requestDavivienda">Consultar</button>
            </div>
        </div>
        <div id="dav-frame" v-show="!davForm">
            <!-- <iframe :src="davUrl" frameborder="0" style="min-width: 300px; min-height: 200px;"></iframe> -->
            <div class="formInputStandard" style="display: flex; width: 100%; justify-content: center;">
                <button class="btn-davivienda" @click="davVolver()">Volver</button>
            </div>
        </div>
    </div>
</div>


<div v-if="showAvisorModal" class="asunto-modal-overlay">
    <div class="asunto-modal-box" style="min-width: 500px; max-width: 75vw; width: min-content; padding: 1rem;">
        <span class="asunto-modal-close" @click="showAvisorModal = false;">√ó</span>
        <h3 style="margin-bottom: .5rem; color: #00839C;">Cupones de separaci√≥n - Avisor</h3>
        <div style="max-height: calc(100vh - 18rem); min-height: 250px; overflow-y: auto;">
            <ul>
                <li v-for="cupon in cupones" class="avisor-cupon-item">
                    <div class="pure-g" style="align-items: baseline;">
                        <span class="pure-u-1-2"><strong>Unidad:</strong> {{ cupon.unidad }}</span>
                        <span class="pure-u-1-2" style="text-align: center;">
                            <strong>Factura:</strong> {{ cupon.invoice }}
                        </span>

                        <div class="avisor-div-btn pure-u-1-2">
                            <button class="avisor-button" @click="openLink(cupon, '')">
                                Enviar Cup√≥n
                            </button>
                        </div>
                        <div class="avisor-div-btn pure-u-1-2">
                            <button class="avisor-button" @click="openLink(cupon, '10')">
                                Descargar Cup√≥n
                            </button>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<div v-if="showOpcionarModal" class="asunto-modal-overlay">
    <div class="asunto-modal-box" style="max-width: 600px;">
        <span class="asunto-modal-close" @click="showOpcionarModal = false">√ó</span>
        <h3 style="margin-bottom: 1em; color: #00839C;">Confirmar Enviar y Opcionar</h3>
        <p style="margin: 0 0 1.5em 0; line-height: 1.6; text-align: center; color: #555;">
            Al confirmar esta acci√≥n se enviar√° la cotizaci√≥n al cliente y se guardar√° la opci√≥n.
            Esta acci√≥n bloquear√° los campos para edici√≥n. ¬øDesea continuar?
        </p>
        <div style="display: flex; gap: 1em; justify-content: center;">
            <button @click="showOpcionarModal = false" class="pure-button"
                style="background-color: #999; color: white;">
                Cancelar
            </button>
            <button @click="confirmarEnviarYOpcionar" class="pure-button pure-button-primary"
                style="background-color: #00839C; color: white;">
                Enviar y Opcionar
            </button>
        </div>
    </div>
</div>

<div class="custom-loader-modal" id="modal-verificando">
    <div class="custom-loader-modal-content" role="dialog" aria-live="polite" aria-label="Verificando">
        <div class="custom-loader" aria-hidden="true"></div>
        <div class="custom-loader-modal-title">{{loadingProcess}}</div>
        <div class="custom-loader-modal-sub">Por favor espera un momento.</div>
    </div>
</div>