<!--Proceso Negocio -->
<div class="pure-g" style="height: max-content">
    <div class="pure-u-1-24"></div>
    <div class="pure-u-22-24" style="margin: 0em 0em 0.5em 0em;">
        <div class="pure-g steps">
            <div v-for="(tab, index) in tabs" :key="index" class="pure-u-1-1 pure-u-md-1-4">
                <div class="wizarTab wizarTabNoSelect" :class="tabClasses[index]"
                    @click="handleNext(index), setSubmode(index)">
                    {{ tab }}
                </div>
            </div>
        </div>
    </div>

    <div class="pure-u-1-24"></div>
    <div class="pure-u-1-24"></div>
    <div class="pure-u-22-24 menuCard"
        style="height: calc(100vh - 14rem); overflow-y: auto; padding: 1em 1em 0 1em !important ">
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Bienvenida------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div class="pure-g" v-if="mode == 0">
            <div class='pure-u-1-1 pure-u-md-1-1'>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em;">
                    Bienvenida a Cliente
                    <div v-if="isClienteVetado" class="btn-vetado" @click="modalveto">Situaci√≥n administrativa</div>
                </div>
                <div class="pure-g" style="align-items: center; justify-content: space-between; margin: 1em 0;">
                    <div class="pure-u-md-8-24" style="display: flex; align-items: center;">
                        <input type="text" v-model="cliente" maxlength="100" placeholder="N√∫mero de Documento (C.C, NIT, etc. Sin puntos ni espacios)"
                            class="pure-u-md-22-24"  @keyup.enter="busquedaCliente" />
                
                        <div class="imgGraybutton" style="cursor: pointer;">
                            <img src="./img/ico/svg/search.svg" @click="busquedaCliente" />
                        </div>
                    </div>

                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="continuarCliente">√öltimo Cliente</button>
                    </div>

                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="antencionRapida">Atenci√≥n Rapida</button>
                    </div>
                
                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="sincliente">Cotizar sin cliente</button>
                    </div>
                
                    <div class="pure-u-md-4-24" style="text-align: right;">
                        <button @click="limpiarObj">Nuevo Cliente</button>
                    </div>
                </div>
                <div v-if="iscliente">
                    <div>
                        <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em;">
                            Informaci√≥n B√°sica
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Nombres</span>
                                <input type='text' v-model='ObjCliente.nombres' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Apellido 1</span>
                                <input type='text' v-model='ObjCliente.apellido1' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Apellido 2</span>
                                <input type='text' v-model='ObjCliente.apellido2' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                    
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Fecha Nacimiento</span>
                                <input type='date' v-model='ObjCliente.fechaNacimiento' maxlength='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='formInputStandard'>
                            <label class="check" style="display: flex; align-items: center; gap: 0.4em;">
                                <input type="checkbox" value="1" v-model="isTitular" />
                                <span class="checkmark"></span>
                                <span style="font-size: 1.1em;">En representaci√≥n de:</span>
                            </label>
                        </div>
                        <div v-if="isTitular">
                            <div class='pure-u-1-1 pure-u-md-1-3'>
                                <div class='formInputStandard'>
                                    <span>Nombre empresa / Representado</span>
                                    <input type='text' v-model='ObjCliente.nombreEmpresa' maxlen='100' placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>C√©dula / NIT</span>
                                    <input type='text' v-model='ObjCliente.nit' maxlen='100' placeholder="Seleccione" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="max-height: calc(100dvh - 33rem); overflow-y: auto;">
                        <div class='pure-u-4-5'>
                            <div class='formInputStandard'>
                                <span>Direcci√≥n</span>
                                <input type='text' v-model='ObjCliente.direccion' maxlength='100'
                                    placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Ciudad</span>
                                <input type='text' v-model='ObjCliente.ciudad' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Barrio</span>
                                <input type='text' v-model='ObjCliente.barrio' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Departamento</span>
                                <input type='text' v-model='ObjCliente.departamento' maxlen='100'
                                    placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Pais</span>
                                <input type='text' v-model='ObjCliente.pais' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Email 1</span>
                                <input type='text' v-model='ObjCliente.email1' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-3'>
                            <div class='formInputStandard'>
                                <span>Email 2</span>
                                <input type='text' v-model='ObjCliente.email2' maxlen='100' placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Telefono 1 / Indicativo</span>
                                <input type='text' v-model='ObjCliente.telefono1' maxlen='100'
                                    placeholder="Seleccione" />
                            </div>
                        </div>
                        <div class='pure-u-1-1 pure-u-md-1-6'>
                            <div class='formInputStandard'>
                                <span>Telefono 2 / Indicativo</span>
                                <input type='text' v-model='ObjCliente.telefono2' maxlen='100'
                                    placeholder="Seleccione" />
                            </div>
                        </div>
                        <div v-if="iscliente">
                            <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em;">
                                Documento de Identificaci√≥n
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Tipo Documento</span>
                                    <select v-model='ObjCliente.tipoDocumento'>
                                        <option value='' selected>Seleccione</option>
                                        <option value='CC'>C√©dula de Ciudadan√≠a</option>
                                        <option value='TI'>Tarjeta de Identidad</option>
                                        <option value='CE'>C√©dula de Extranjer√≠a</option>
                                        <option value='PAS'>Pasaporte</option>
                                        <option value='NIT'>NIT</option>
                                        <option value='RC'>Registro Civil</option>
                                    </select>
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>N√∫mero Documento</span>
                                    <input type='text' v-model='ObjCliente.numeroDocumento' maxlen='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Pa√≠s Expedici√≥n</span>
                                    <input type='text' v-model='ObjCliente.paisExpedicion' maxlen='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Depart. Expedici√≥n</span>
                                    <input type='text' v-model='ObjCliente.departamentoExpedicion' maxlen='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Ciudad Expedici√≥n</span>
                                    <input type='text' v-model='ObjCliente.ciudadExpedicion' maxlen='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                            <div class='pure-u-1-1 pure-u-md-1-6'>
                                <div class='formInputStandard'>
                                    <span>Fecha Expedici√≥n</span>
                                    <input type='date' v-model='ObjCliente.fechaExpedicion' maxlen='100'
                                        placeholder="Seleccione" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
                    <div class="modal-card">
                        <div class="modal-header">
                            <h3>Situaci√≥n Administrativa del Cliente</h3>
                            <div class="close-btn" @click="closeModal">‚úï</div>
                        </div>
                        <div class="modal-body">
                            <div v-if="vetoData && vetoData.length">
                                <div v-for="(item, i) in vetoData" :key="i" class="veto-item">
                                    <p><strong>üìÖ Fecha:</strong> {{ item.fecha }}</p>
                                    <p><strong>‚ö†Ô∏è Motivo:</strong> {{ item.motivo }}</p>
                                    <p><strong>üë§ Responsable:</strong> {{ item.vetado_por }}</p>
                                    <hr v-if="i < vetoData.length - 1" />
                                </div>
                            </div>
                            <div v-else>
                                <p>No hay registros de veto para este cliente.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-1' v-if="iscliente">
                <div class='formInputStandard'>
                    <div class='pure-g'>
                        <div class='pure-u-1-1'>
                            <label class="check" style="display: inline-flex; align-items: center;">
                                <input type="checkbox" :value="1" v-model="policyAccepted"
                                    @change="acceptPolicy(policyAccepted)" />
                                <span class="checkmark"></span>
                                <span style="margin-right: 0.5em;">
                                    Al enviarnos su informaci√≥n personal usted autoriza a CONSTRUCTORA CAPITAL BOGOT√Å
                                    S.A.S y
                                    CONSTRUCTORA CAPITAL MEDELL√çN S.A.S en adelante ‚ÄúEL RESPONSABLE‚Äù para que traten sus
                                    datos de
                                    conformidad con la autorizaci√≥n <a
                                        href="https://www.constructoracapital.com/autorizacion-tratamiento-datos-personales"
                                        target="_blank">aqu√≠ indicada</a>.
                                </span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="israpida" class="pure-u-1">
                <div class="formDivision" style="font-size: 1.2em; margin-top: 1em;">
                    Atenci√≥n R√°pida
                </div>
                <div class="pure-g">
                    <div class="pure-u-1 pure-u-md-1-2">
                        <div class="formInputStandard">
                            <span>Nombres</span>
                            <input type="text" v-model="ObjCliente.nombres" maxlength="100" placeholder="Seleccione" />
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>Apellido 1</span>
                            <input type='text' v-model='ObjCliente.apellido1' maxlen='100' placeholder="Seleccione" />
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>Apellido 2</span>
                            <input type='text' v-model='ObjCliente.apellido2' maxlen='100' placeholder="Seleccione" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <div class="formInputStandard">
                            <span>Email</span>
                            <input type="text" v-model="ObjCliente.email1" maxlength="100" placeholder="Seleccione" />
                        </div>
                    </div>
                    <div class='pure-u-1-1 pure-u-md-1-2'>
                        <div class='formInputStandard'>
                            <span>N√∫mero Documento</span>
                            <input type='text' v-model='ObjCliente.numeroDocumento' maxlen='100' placeholder="Seleccione" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Registro--------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div class="pure-g" v-if="mode == 1">
            <div class='pure-u-1-1' style="font-size: 1.6em;">
                {{ ObjCliente.nombres }}
            </div>
            <div v-for="(tabItem, index) in tab" :key="index" @click="activeTab = index" :class="[
                'tab-registro', { active: activeTab === index },{ 'highlight-text': tabItem === 'Registros de compras' && registroCompras.length > 0 }]">
                {{ tabItem }}
                <span v-if="tabItem === 'Registros de compras' && registroCompras.length > 0" class="dot"></span>
            </div>
            <div v-if="activeTab == 0">
                <div class='pure-u-1-1 formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.5em;">Registros de visita</span>
                    <button @click="limpiarObj(1)" style="float: right;">Nueva visita</button>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-4 filtro-proyecto-inline'>
                    <label for="filtro-proyecto" style="white-space: nowrap;">Filtrar por Proyecto:</label>
                    <select v-model="filtroProyecto" id="filtro-proyecto" style="flex: 1;">
                        <option value="">Todos</option>
                        <option v-for="proy in proyectosUnicos" :key="proy" :value="proy">
                            {{ proy }}
                        </option>
                    </select>
                </div>
                <div
                    style="height: 11rem; overflow-y: auto; margin-top: 0.1em;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 16.5%;">Fecha</th>
                                <th>Proyecto</th>
                                <th>Tipo</th>
                                <th>Modo</th>
                                <th style="width: 30%;">Descripci√≥n</th>
                                <th>Contador</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in visitasFiltradas" :key="item.id_visita"
                                @click="editarVisita(item.id_visita)">
                                <td>{{ item.fecha }}</td>
                                <td>{{ item.proyecto }}</td>
                                <td style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                    :title="item.nombre_tipo_registro">
                                    {{ item.nombre_tipo_registro }}
                                </td>
                                <td style="max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                    :title="item.nombre_modo_atencion">
                                    {{ item.nombre_modo_atencion }}
                                </td>
                                <td>{{ item.descripcion }}</td>
                                <td>{{ contadorProyectos[item.proyecto] || 0 }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div v-if="activeTab == 1">
                <div class='pure-u-1-1 formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.5em;">Registros de compras</span>
                </div>
                <div
                    style="height: 11rem; overflow-y: auto; margin-top: 0.5em;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 15%;">Fecha</th>
                                <th>Proyecto</th>
                                <th>Tipo</th>
                                <th>Modo</th>
                                <th style="width: 30%;">Descripci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, idx) in registroCompras" :key="idx">
                                <td>{{ item.fecha }}</td>
                                <td>{{ item.proyecto }}</td>
                                <td>{{ item.tipo }}</td>
                                <td>{{ item.modo }}</td>
                                <td>{{ item.descripcion }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div>
                <div class='pure-u-1-1 formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.5em;">Tipo de Registro (referido a la visita seleccionada en la
                        tabla)</span>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1'>
                    <div class='formInputStandard'>
                        <div class='pure-g'>
                            <div v-for='(item, index) in tipo_registro' :key="index" class='pure-u-1-1 pure-u-md-1-6'
                                style='margin: .8rem 0 .8rem 0; '>
                                <label class="check">
                                    <input type="checkbox" value='1' v-model="item.checked" :disabled="camposBloqueados" />
                                    <span class="checkmark"></span>
                                    {{ item.tipo_registro }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision'>
                    <span style="font-size: 1.5em;">Motivo de atenci√≥n (referido a la visita seleccionada in la tabla)</span>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-1">
                    <div class="formInputStandard">
                        <div class="pure-g" style="align-items: center; flex-wrap: wrap;">
                            <template v-for="(item, index) in modo_atencion" :key="index">
                                <div v-if="item.modo_atencion !== 'Tramites' && item.modo_atencion !== 'Otro'"
                                    class="pure-u-1-1 pure-u-md-1-8" style="display: flex; align-items: center;">
                                    <label class="check">
                                        <input type="checkbox" v-model="item.checked" :disabled="camposBloqueados"/>
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Tramites'" class="pure-u-1-1 pure-u-md-1-12"
                                    style="display: flex; align-items: center;">
                                    <label class="check">
                                        <input type="checkbox" v-model="item.checked" :disabled="camposBloqueados"/>
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Tramites'" class="pure-u-1-1 pure-u-md-1-5"
                                    style="padding-left: 1rem;">
                                    <select v-model="ObjVisita.id_tipo_tramite" :disabled="camposBloqueados">
                                        <option disabled value="">[Tr√°mites]</option>
                                        <option v-for="opcion in tipo_tramite" :value="opcion.id_tipo_tramite">
                                            {{ opcion.tipo_tramite }}
                                        </option>
                                    </select>
                                </div>
                                <div v-if="item.modo_atencion === 'Otro'" class="pure-u-1-1 pure-u-md-1-12"
                                    style="padding-left: 1rem;">
                                    <label class="check">
                                        <input type="checkbox" v-model="item.checked" :disabled="camposBloqueados"/>
                                        <span class="checkmark"></span>
                                        {{ item.modo_atencion }}
                                    </label>
                                </div>
                                <div v-if="item.modo_atencion === 'Otro'" class="pure-u-1-1 pure-u-md-1-4">
                                    <input type="text" v-model="ObjVisita.otro_texto" maxlength="100" placeholder="Especificar"
                                         style="width: 100%;" :disabled="camposBloqueados"/>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1 formDivision'>
                    <span style="font-size: 1.5em;">Otra informaci√≥n (referido a la visita seleccionada en la
                        tabla)</span>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Categor√≠a Medio</span>
                        <select v-model='ObjVisita.id_categoria' :disabled="camposBloqueados">
                            <option value='' disabled selected>Seleccione</option>
                            <option v-for='item in categoria' v-bind:value='item.id_categoria'>
                                {{ item.categoria }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Medio</span>
                        <select v-model='ObjVisita.id_medio' :disabled="camposBloqueados">
                            <option value='' disabled selected>Seleccione</option>
                            <option v-for='item in medio' v-bind:value='item.id_medio'>
                                {{ item.medio }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Motivo de Compra</span>
                        <select v-model='ObjVisita.id_motivo_compra' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in motivo_compra' v-bind:value='item.id_motivo_compra'>
                                {{ item.motivo_compra }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Presupuesto disponible</span>
                        <select v-model='ObjVisita.id_presupuesto_vivienda' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in presupuesto_vivienda' v-bind:value='item.id_presupuesto_vivienda'>
                                {{ item.rango }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-5'>
                    <div class='formInputStandard'>
                        <span>Referencias</span>
                        <select v-model='ObjVisita.id_referencia' :disabled="camposBloqueados">
                            <option value='' selected>Seleccione</option>
                            <option v-for='item in referencia' v-bind:value='item.id_referencia'>
                                {{ item.referencia }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class='pure-u-1-1 pure-u-md-1-1'>
                    <div class='formInputStandard filtro-proyecto-inline'>
                        <span>Descripci√≥n</span>
                        <input type='text' v-model='ObjVisita.descripcion' maxlen='100' placeholder="Seleccione" :disabled="camposBloqueados"/>
                    </div>
                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- --------------------------- Cotizaci√≥n--------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div style="display: flex; flex-direction: column; gap: .5rem; height: 100%;" v-if="mode == 2">
            <div style="height: 50%;">
                <div class='pure-u-1-1' style="font-size: 2em;">
                    {{ ObjCliente.nombres + " " + ObjCliente.apellido1 + " " +  ObjCliente.apellido2 }}
                </div>
                <div class="formDivision" style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.5em;">
                    <span style="font-size: 1.8em;">Cotizaciones</span>
                    <label class="check" style="display: flex; align-items: center; gap: 0.4em;">
                        <input type="checkbox" value="1" v-model="ishistory" />
                        <span class="checkmark"></span>
                        <span style="font-size: 1.1em;">Historial</span>
                    </label>
                    <button @click="addCotizacion">Nueva Cotizaci√≥n</button>
                </div>
                <div style="width: 100%; height: calc(100% - 7rem); overflow-y: auto; margin-top: 0.5rem;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th class="col-1-6">Cotizaci√≥n</th>
                                <th class="col-1-6">Fecha</th>
                                <th class="col-3-6">Descripci√≥n</th>
                                <th class="col-1-6">Importe</th>
                                <th class="col-1-6">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in cotizacionesFiltradas" :key="index" @click="seleccionarCotizacion(item.cotizacion)"
                                :class="{ seleccionado: cotizacionSeleccionada === item.cotizacion }">
                                <td class="col-1-6">{{ item.cotizacion }}</td>
                                <td class="col-1-6">{{ item.fecha }}</td>
                                <td class="col-3-6">
                                    <input type="text" v-model="item.descripcion" placeholder="Descripci√≥n"
                                        @focus="seleccionarCotizacion(item.cotizacion)" />
                                </td>
                                <td class="col-1-6" style="text-align: right;">
                                    {{ item.importe ? formatoMoneda(item.importe - (item.valor_descuento || 0)) : '' }}
                                </td>
                                <td v-if="!item.importe" style="text-align: center;">
                                <span class="delete"
                                    @click.stop.prevent="reqOperation(`Desea eliminar la cotizacion? <b></b>.`, deleteCotiz, null, item)"> ‚úñ
                                </span>
                            </td>
                            <td v-else></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div style="height: 50%;">
                 <div class='formDivision' style="margin-top: 0.5em;">
                    <span style="font-size: 1.8em;">Unidad</span>
                    <button style="float: right;" @click="abrirNuevoModulo">Agregar Item</button>
                </div>
                <div style="width: 100%; height: calc(100% - 7rem); overflow-y: auto; margin-top: 0.5rem;">
                    <table class="dataTable">
                        <thead>
                            <tr>
                                <th style="width: 5%;">Torre</th>
                                <th style="width: 10%;">Tipo</th>
                                <th style="width: 8%;">ID Unidad</th>
                                <th style="width: 15%;">Fecha</th>
                                <th style="width: 35%;">Observaci√≥n</th>
                                <th style="width: 15%;">Importe</th>
                                <th style="width: 15%;">Descuento</th>
                                <th style="width: 10%;">Lista</th>
                                <th style="width: 5%;">UT</th>
                                <th style="width: 8%;">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in unidades" :key="index">
                                <td>{{ item.consecutivo }}</td>
                                <td>{{ item.tipo }}</td>
                                <td>{{ item.numero_apartamento }}</td>
                                <td>{{ item.fecha_formateada }}</td>
                                <td>{{ item.observacion_apto }}</td>
                                <td style="text-align: right;">{{ formatoMoneda(item.valor_unidad) }}</td>
                                <td style="text-align: right" contenteditable="true" @focus="item.editando = true" @blur="onBlurDescuento($event, item)"
                                    class="editable-cell">
                                    {{ item.editando ? item.editValor || item.valor_descuento : formatoMoneda(item.valor_descuento) }}
                                </td>
                                <td>{{ item.lista }}</td>
                                <td style="text-align: center;">{{ item.inv_terminado }}</td>
                                 <td style="text-align: center;">
                                    <span class="delete"
                                        @click.stop.prevent="reqOperation(`Desea eliminar el item? <b></b>.`, dropitem, null, item)"> ‚úñ
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="btn-modern btn-fixed" @click="showAtencionModal">
                    <span class="icon">‚úî</span>
                    <span class="text">Terminar<br>Atenci√≥n</span>
                </div>
            </div>
            <!-- <div class="pure-u-1-1"
                        style="margin-top: 0.5em; display: flex; align-items: center; justify-content: space-between;">
                        <div class="pure-u-1-1 pure-u-md-1-3" style="display: flex; align-items: center; gap: 6.5em;">
                            <samp class="pure-u-1-1 pure-u-md-1-3">Lista Activa:</samp>
                            <select v-model="">
                                <option value="" selected>[Seleccione]</option>
                                <option value="">Opci√≥n 1</option>
                            </select>
                        </div>
                 
                    </div> -->
            <div v-if="mostrarModal" class="asunto-modal-overlay">
                <div class="asunto-modal-box">
                    <span class="asunto-modal-close" @click="mostrarModal = false">√ó</span>
                    <h3>Seleccione el Seguimiento</h3>
                    <select class="asunto-select" v-model="asuntoSeleccionado">
                        <option disabled value="">Seleccione el seguimiento...</option>
                        <option v-for="(opcion, index) in cotizacion" :key="index">{{ opcion }}</option>
                    </select>
                    <div style="text-align: center; margin-top: 1em;">
                        <button @click="terminarAtencion">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- ----------------------------------------------------------------- -->
        <!-- ----------------------------- Opci√≥n ---------------------------- -->
        <!-- ----------------------------------------------------------------- -->
        <div v-if="mode == 3">
            <div class='pure-u-1-1'>
                <samp class="resaltado">{{ ObjCliente.nombres + " " + ObjCliente.apellido1 + " " +  ObjCliente.apellido2 }}</samp>
            </div>
            <div class='pure-u-1-1 formDivision' style="display: flex; justify-content: space-between;">
                <div class="pure-u-1 pure-u-md-6-8" style="display: flex;gap: .5rem;">
                    <span style="font-size: 1.2em;">Opcionar:</span>
                    <samp class="resaltado">{{ textoCotizacion }}</samp>
                </div>
                <div class="pure-u-1 pure-u-md-3-8" style="display: flex;gap: .5rem;">
                    <span style="font-size: 1.2em;">Importe:</span>
                    <samp class="resaltado">{{ formatoMoneda(importeActiva) }}</samp>
                </div>
            </div>
            <div class='pure-u-1-1 formDivision' style="font-size: 1em; margin-top: 1em;">
                Modo de Pago
            </div>
            <div class="pure-g" style="margin-top: 1em;">
                <div class="pure-u-1 pure-u-md-3-8" style="margin-bottom: .5em;">
                    <fieldset :class="['opcionPago', { activo: pagoSeleccionado === 'contado' }]"
                        @click="onSeleccionContado">
                        <div class="pure-u-1 pure-u-md-1-1">
                            <label class="check pure-u-1-1">
                                <input type="radio" name="pago" value="contado" v-model="pagoSeleccionado"/>
                                <span class="checkmark"></span>
                                Contado
                            </label>
                        </div>
                        <div class="pure-u-1 pure-u-md-1-1" style="padding-top: 1.7rem;">
                            <span class="pure-u-1 pure-u-md-1-4">Modalidad:</span>
                            <div class="pure-u-1 pure-u-md-3-4">
                                <select class="pure-input-1" v-model="planSeleccionado" @change="calcularPlanPago">
                                    <option value="">Seleccione</option>
                                    <option v-for="plan in planes_pago" :key="plan.id_planes_pago" :value="plan.id_planes_pago">
                                        {{ plan.descripcion }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="pure-u-1 pure-u-md-5-8">
                    <fieldset :class="['opcionPago', { activo: pagoSeleccionado === 'financiado' }]"
                        @click="pagoSeleccionado = 'financiado'">
                        <div class="pure-u-1 pure-u-md-1-1">
                            <label class="check pure-u-1 pure-u-md-1-6">
                                <input type="radio" name="pago" value="financiado" v-model="pagoSeleccionado" />
                                <span class="checkmark"></span>
                                Financiado
                            </label>
                            <span class="pure-u-1 pure-u-md-1-6">Entidad:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="bancoSeleccionado" @change="cargarFactor"
                                    :disabled="pagoSeleccionado !== 'financiado'">
                                    <option :value="0">Seleccione banco</option>
                                    <option v-for="b in banco_financiador" :key="b.id_bancos_financiador"
                                        :value="b.id_bancos_financiador">
                                        {{ b.banco }}
                                    </option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-24"></div>
                            <span class="pure-u-1 pure-u-md-1-12">Tipo:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="unidadSeleccionada" @change="cargarAnios"
                                    :disabled="pagoSeleccionado !== 'financiado'">
                                    <option value="">Seleccione unidad</option>
                                    <option v-for="unidad in unidadesDisponibles" :key="unidad" :value="unidad">
                                        {{ unidad }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="pure-u-1 pure-u-md-1-1" style="padding-top: 1rem;">
                            <div class="pure-u-1 pure-u-md-1-6"></div>
                            <span class="pure-u-1 pure-u-md-1-6">Modalidad:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="tipoFinanciacionSeleccionada" :disabled="pagoSeleccionado !== 'financiado'"
                                    @change="calcularFinanciacion">
                                    <option value="">Seleccione</option>
                                    <option v-for="tipo in tipo_financiacion" :key="tipo.id_tipo_financiacion" :value="tipo.tipo_financiacion">
                                        {{ tipo.tipo_financiacion }}
                                    </option>
                                </select>
                            </div>
                            <div class="pure-u-1 pure-u-md-1-24"></div>
                            <span class="pure-u-1 pure-u-md-1-12">A√±os:</span>
                            <div class="pure-u-1 pure-u-md-1-4">
                                <select class="pure-input-1" v-model="anioSeleccionado"
                                    :disabled="pagoSeleccionado !== 'financiado'">
                                    <option value="">Seleccione a√±os</option>
                                    <option v-for="anio in listaAnios" :key="anio" :value="anio">
                                        {{ anio }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class='pure-u-1-1 formDivision' style="font-size: 1.2em; margin-top: 1em;">
                Aportes y subsidios
            </div>
            <div class="pure-g">
                <div class="pure-u-1 pure-u-md-1-1">
                    <div class="pure-u-1 pure-u-md-1-6">
                        <div class="formInputStandard">
                            <span>Cesant√≠as</span>
                            <input type="text" style="text-align: right;" :value="new Intl.NumberFormat('es-CO').format(cesantias)"
                                @input="formatearEnTiempoRealGenerico($event, 'cesantias')" @blur="calcularFinanciacion" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6">
                        <div class="formInputStandard">
                            <span>Ahorros</span>
                            <input type="text" style="text-align: right;" :value="new Intl.NumberFormat('es-CO').format(ahorros)"
                                @input="formatearEnTiempoRealGenerico($event, 'ahorros')" @blur="calcularFinanciacion" />
                        </div>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-1">
                    <div class="pure-u-1 pure-u-md-1-8" style="margin-top: 1.5em">
                        <div class="formInputStandard">
                            <label class="check pure-u-1-1 pure-u-md-1-6" style="margin-top: .4em;" v-show="pagoSeleccionado === 'financiado'">
                                <input type="checkbox" v-model="subsidioActivo" />
                                <span class="checkmark"></span>
                                Subsidio
                            </label>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6">
                        <div class="formInputStandard">
                            <span>Ingresos Mensuales</span>
                            <input ref="inputIngresos" style="text-align: right;" type="text" v-model="ingresos_mensuales_texto"
                                @input="formatearEnTiempoRealGenerico($event, 'ingresos_mensuales')"
                                :disabled="!subsidioActivo || pagoSeleccionado === 'contado'" />
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-12">
                        <div class="formInputStandard">
                            <span>A√±o Entrega</span>
                            <select v-model="seleccionAnioEntrega" @change="calcularSubsidio" style="width: 100%;"
                                :disabled="!subsidioActivo || pagoSeleccionado === 'contado'">
                                <option value="">Seleccione</option>
                                <option v-for="anio in listaAniosEntrega" :key="anio" :value="anio">
                                    {{ anio }}
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-6">
                        <div class="formInputStandard">
                            <span>Valor Subsidio</span>
                            <input style="text-align: right;" type="text" :value="formatoMoneda(valor_subsidio)" readonly
                                :disabled="pagoSeleccionado === 'contado'" />
                        </div>
                    </div>
                    <div class="pure-u-1-1 pure-u-md-1-24"></div>
                    <div class="pure-u-1-1 pure-u-md-1-5" style="margin-top: 1.5em">
                        <div class="formInputStandard">
                            <span style="margin-top: .4em;">Caja de compensaci√≥n:</span>
                        </div>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-5" style="margin-top: 1.5em">
                        <div class="formInputStandard">
                            <select v-model="caja_compensacion" style="width: 100%;"
                                :disabled="!subsidioActivo || pagoSeleccionado === 'contado'">
                                <option value="">Seleccione</option>
                                <option v-for="caja in cajas_compensacion" :key="caja.id_caja" :value="caja.id_caja">
                                    {{ caja.caja }}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pure-u-1-1 formDivision" style="font-size: 1.2em; margin-top: 1em;">
                <div class="pure-u-1 pure-u-md-1-3">
                    <span >Importe Financiable: <span class="resaltado">{{ formatoMoneda(valor_credito) }}</span></span>
                </div>
                <div class="pure-u-1 pure-u-md-1-2">
                    <span >Cuota Inicial despu√©s de subsidio, cesant√≠as y/o ahorros: <span class="resaltado">{{ formatoMoneda(cuota_inicial) }}</span></span>
                </div>
            </div>
        </div>
    </div>
    <!-- ------------------------------------------------------------ -->
    <!-- ----------------------------- Global------------------------- -->
    <!-- ------------------------------------------------------------ -->
    <div class="pure-u-1-1" style="padding-top: 1em;" v-if="iscliente">
        <div class="pure-g" style="justify-content: center; gap: 1em; display: flex;">
            <!-- <div v-if="mode != 0" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="handleNext(mode - 1)">Volver</button>
            </div> -->
            <div v-if="mode == 0" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="nuevoCliente">Guardar</button>
            </div>
            <div v-if="mode == 1" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="nuevaVisita">Guardar</button>
            </div>
            <div v-if="mode == 2" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="guardarCotizacion">Guardar</button>
            </div>
            <!-- <div v-if="mode != 5 && ObjCliente.Nombres != ''" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="handleNext(mode + 1)">Siguiente</button>
            </div> -->
        </div>
    </div>
    <div class="pure-u-1-1" style="padding-top: 1em;" v-if="israpida">
        <div class="pure-g" style="justify-content: center; gap: 1em; display: flex;">
            <div v-if="mode == 0" class="pure-u-auto">
                <button class="pure-button button-fixed" @click="nuevoCliente(1)">Guardar</button>
            </div>
        </div>
    </div>
</div>