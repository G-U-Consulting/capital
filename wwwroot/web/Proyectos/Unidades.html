<div class="pure-g">
    <div class="pure-u-1-1 pure-u-md-1-1 menuCard" style="height: calc(100vh - 2rem); overflow-y: auto; margin: 1em;">
        <div style="display: flex; width: 100%;">
            <div class="zoom-bloque">
                <div style="display: flex; flex-direction: column; gap: 1rem;min-width: 9rem;">
                    <button @click="zoom = 'torres'" :class="zoom === 'torres' ? 'btn-azul' : 'btn-blanco'">
                        Zoom Torres
                    </button>
                    <button @click="zoom = 'unidades'" :class="zoom === 'unidades' ? 'btn-azul' : 'btn-blanco'">
                        Zoom Unidades
                    </button>
                </div>
            </div>
            <div class="filtros-bloque">
                <div class="filtros-wrapper">
                    <div class="filtros-container">
                        <div class="filtros-center">
                            <div class="input-group">
                                <input type="text" placeholder="ID Unidad" v-model="filtros.aptos['apartamento']"
                                    maxlength="10" />
                                <div class="imgGraybutton" @click="onClearFilters('aptos')">
                                    <img src="./img/ico/eraser.png" />
                                </div>
                            </div>
                            <select v-model="filtros.aptos['id_clase']" class="pure-input-1">
                                <option value="">[Clase]</option>
                                <option v-for="c in clases" :value="c.id_clase">{{c.clase}}</option>
                            </select>
                            <select v-model="filtros.aptos['codigo_planta']">
                                <option value="">[Tipos]</option>
                                <option v-for="t in tipos" :value="t">{{ t }}</option>
                            </select>
                            <select v-model="filtros.aptos['piso']">
                                <option value="">[Pisos]</option>
                                <option v-for="p in pisos" :value="p">{{ p }}</option>
                            </select>
                            <select v-model="filtros.aptos['id_estado_unidad']">
                                <option value="">[Estados]</option>
                                <option v-for="e in estados" :value="e.id_estado_unidad">{{ e.estado_unidad }}
                                </option>
                            </select>
                            <select v-model="filtros.aptos['localizacion']">
                                <option value="">[Localización]</option>
                                <option value="Interior">Interior</option>
                                <option value="Exterior">Exterior</option>
                            </select>
                            <div class="checkbox-group">
                                <label><input type="checkbox" v-model="filtros.aptos['tiene_balcon']" true-value="1"
                                        false-value="" />
                                    Con Balcón</label>
                                <label><input type="checkbox" v-model="filtros.aptos['tiene_parq_sencillo']"
                                        true-value="1" false-value="" /> Parq Sencillo</label>
                                <label><input type="checkbox" v-model="filtros.aptos['tiene_parq_doble']" true-value="1"
                                        false-value="" />
                                    Parq Doble</label>
                                <label><input type="checkbox" v-model="filtros.aptos['tiene_deposito']" true-value="1"
                                        false-value="" />
                                    Con Depósito</label>
                                <label><input type="checkbox" v-model="filtros.aptos['tiene_acabados']" true-value="1"
                                        false-value="" />
                                    Con Acabados</label>
                                <label><input type="checkbox" v-model="filtros.aptos['cerca_porteria']" true-value="1"
                                        false-value="" />
                                    Cerca Portería</label>
                                <label><input type="checkbox" v-model="filtros.aptos['cerca_juegos_infantiles']"
                                        true-value="1" false-value="" /> Cerca Juegos Inf</label>
                                <label><input type="checkbox" v-model="filtros.aptos['cerca_piscina']" true-value="1"
                                        false-value="" />
                                    Cerca Piscina</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="logos-bloque">
                <div class="logo-right-wrapper">
                    <div class="logo-right-outside">
                        <img :src="logoProyecto" alt="Proyecto" />
                        <div v-if="edge_estado == 'vigente'">
                            <img class="certification-badge-vig" src="./img/ico/svg/OIP.png" />
                        </div>
                        <div v-if="edge_estado == 'próxima'">
                            <img class="certification-badge-prox" src="./img/ico/svg/sello-proximo-edge.svg" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="display: flex; width: 100%;">
            <div class="zoom-bloque">
                <div v-if="viewProperties.viewType == 'classic'">
                    <div class="lista-torres">
                        <div v-for="item in torres" class="torre" @click="toggleTorre(item)"
                            v-bind:class="{'sel-torre': filtros.aptos.torres.includes(item.idtorre),'en-venta': item.en_venta == '1'}">
                            <div style="align-self: center;">
                                <span style="font-weight: bold;">Torre {{item.idtorre}}</span>
                            </div>
                            <div v-for="e in [...estados].reverse()">
                                <div class="cal-event-count" :style="`background: ${e.color_fondo}`">
                                    <span :style="`color: ${e.color_fuente}`">
                                        {{aptos.filter(a => a.id_estado_unidad === e.id_estado_unidad
                                        && a.id_torre === item.id_torre).length}}
                                    </span>
                                </div>
                                <span>{{e.estado_unidad_plural}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="filtros-bloque" class="filtros-bloque">
                <div class="aptos-list-agrupada" v-if="zoom === 'unidades'">
                    <div v-for="(pisos, idtorre) in aptosAgrupadosPorTorreYPiso" :key="idtorre">
                        <div class="titulo-torre">Torre {{ idtorre }}</div>
                        <div v-for="[piso, aptos] in Object.entries(pisos).sort((a,b)=>parseInt(b[0]) - parseInt(a[0]))"
                            :key="piso">
                            <div class="grupo-piso">
                                <div class="titulo-piso">
                                    <div>PISO</div>
                                    <div>{{ piso }}</div>
                                </div>
                                <div class="aptos-grid-rows">
                                    <div v-for="(row, rIndex) in rowsForTorre(idtorre, aptos)" :key="rIndex"
                                        :style="aptosRowStyle(idtorre, row)">
                                        <div v-for="apto in row" :key="apto.apartamento" class="apto-card-mini"
                                            @click="selectApto(apto)" :class="[
                                                                       { active: selectedApto && selectedApto.apartamento === apto.apartamento },
                                                                       'estado-' + (apto.estatus || '').trim().toLowerCase()
                                                                     ]">
                                            <div class="mini-header">
                                                {{ apto.apartamento }}
                                                <span v-if="apto.asignado == 1" class="candado">🔒</span>
                                            </div>
                                            <div class="mini-body">{{ apto.localizacion }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="aptos-list-unidades" v-if="zoom === 'torres'">
                    <div v-for="(pisos, idtorre) in aptosAgrupadosPorTorreYPiso" :key="idtorre" class="torre-block">
                        <div class="titulo-torre">Torre {{ idtorre }}</div>
                        <div v-for="[piso, aptos] in Object.entries(pisos).sort((a,b)=>parseInt(b[0]) - parseInt(a[0]))" :key="piso">
                            <div class="piso-row-flex">
                                <div class="piso-numero">P {{ piso }}</div>
                                <div class="aptos-grid-rows">
                                    <div v-for="(row, rIndex) in rowsForTorre(idtorre, aptos)" :key="rIndex"
                                        :style="aptosRowStyle(idtorre, row)">
                                        <div v-for="apto in row" :key="apto.apartamento" class="apto-cuadro" @click="selectApto(apto)"
                                            :class="[{ active: selectedApto && selectedApto.apartamento === apto.apartamento, 
                                            'apto-asignado': apto.asignado == 1 }, 'estado-' + (apto.estatus || '').trim().toLowerCase()]">
                                            {{ apto.apartamento }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            <div class="logos-bloque">
                <div class="contenedor-principal">
                    <div >
                        <div class="progress-card">
                            <div class="progress-header">
                                <samp>Vendidos</samp>
                                <strong style="color: #00BFA5; font-size: 1rem;">{{ vendidosPorcentaje }}%</strong>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill"
                                    :style="{ width: vendidosPorcentaje + '%', backgroundColor: barraColor }"></div>
                            </div>
                            <div class="progress-footer">
                                {{ vendidosSum }} / {{ totalAptos }}
                            </div>
                        </div>
                    </div>
                    <div class="seccion-bottom">
                        <div class="aptos-detail" v-if="selectedApto">
                            <div class="tabs-floating">
                                <div :class="{ active: activeTab === 'detalle' }" @click="activeTab = 'detalle'">
                                    📝 Detalle
                                </div>
                                <div :class="{ active: activeTab === 'imagenes' }" @click="activeTab = 'imagenes'">
                                    🖼️ Imágenes
                                </div>
                            </div>
                            <div class="tab-card">
                                <div v-if="activeTab === 'detalle'">
                                    <h3 v-if="selectedApto.id_agrupacion == ''">Valor Unidad: {{
                                        formatoMoneda(selectedApto.valor_unidad) }}</h3>
                                    <h3 v-else>Valor Agrupación: {{ formatoMoneda(selectedApto.agrupacion_total) }}
                                    </h3>
                                    <ul class="detail-list">
                                        <li v-if="selectedApto.id_agrupacion != ''"><span class="label">🏘️
                                                Agrupación:</span> {{ selectedApto.agrupacion_descripcion}}</li>
                                        <li><span class="label">📐 Tipo:</span> {{ selectedApto.codigo_planta }}
                                        </li>
                                        <li><span class="label">🏠 ID Unidad:</span> {{ selectedApto.apartamento }}
                                        </li>
                                        <li><span class="label">📊 Estatus:</span> {{ selectedApto.estatus }}</li>
                                        <li><span class="label">📍 Localización:</span> {{ selectedApto.localizacion
                                            }}</li>
                                        <li><span class="label">🔧 UT:</span> {{ selectedApto.inv_terminado == 1 ?
                                            'SI' : 'NO' }}</li>
                                        <li><span class="label">📏 Área Priv. Cubierta:</span>
                                            <samp class="area-card">{{ selectedApto.area_privada_cub }}</samp>
                                        </li>
                                        <li><span class="label">🏗️ Área Total Construida:</span>
                                            <samp class="area-card">{{ selectedApto.area_total }}</samp>
                                        </li>
                                        <li><span class="label">☀️ Asoleación:</span>
                                            {{ selectedApto.asoleacion == 'PM' ? 'Sol de mañana' : 'Sol de tarde' }}
                                        </li>
                                        <li><span class="label">🤝 Asesor</span> {{asesor}}</li>
                                        <li class="observacion-item">
                                            <span class="label">📝 Observación:</span>
                                            <div class="observacion-text">{{ selectedApto.observacion_apto }}</div>
                                        </li>
                                    </ul>
                                </div>
                                <div v-if="activeTab === 'imagenes'">
                                    <div class="image-gallery-container">
                                        <div class="image-gallery">
                                            <img :src="tipoProyecto" @click="openModal(tipoProyecto)" />
                                        </div>
                                        <div class="image-gallery">
                                            <img :src="plantProyecto" @click="openModal(plantProyecto)" />
                                        </div>
                                        <div class="image-gallery">
                                            <iframe id="v-player" :src="recorrido" :key="'v' + playIndex"
                                                frameborder="0" allowfullscreen allow="xr-spatial-tracking">
                                            </iframe>
                                        </div>
                                    </div>

                                    <div v-if="showModal" class="modal-overlay" @click="closeModal">
                                        <div class="modal-content" @click.stop>
                                            <span class="close" @click="closeModal">&times;</span>
                                            <img :src="modalImage" class="modal-img" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="action-footer">
                                <button v-if="selectedApto.estatus === 'Libre' && selectedApto.asignado != 1" @click="addUnidad(selectedApto)"
                                    class="pure-button pure-button-primary">
                                    Agregar
                                </button>
                                <button v-else @click="addListaEspera(selectedApto)"
                                    class="pure-button pure-button-primary">
                                    Ag. Lista de Espera
                                </button>
                            </div>
                        </div>
                        <div v-else class="aptos-detail"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>