<div v-if="mode == 0" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">

        <div class="pure-u-1-1 pure-u-md-1-1 formDivision right-button">
            <span style="font-size: 1.5em;">Desistimientos En Proceso </span>
            <div style="min-width: 150px;">
                <button @click="setMode(1)">Nuevo Desistimiento</button>
            </div>
        </div>
        <div class="searchBox" style="padding: .5rem 0;">
            <div class="pure-g">
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="Radicado" maxlength="50"
                        v-model="filtros.desistimientos['radicado']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="ID Venta" maxlength="50"
                        v-model="filtros.desistimientos['id_venta']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="Doc. Comprador" maxlength="50"
                        v-model="filtros.desistimientos['numero_documento']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="Nombre" maxlength="50"
                        v-model="filtros.desistimientos['nombre_cliente']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <div class="combo-container" @blur="optVisible = false">
                        <input type="text" class="combo-input" placeholder="Proyectos"
                            v-model="filtros.desistimientos['proyecto']" @click="optVisible = true;">
                        <select class="combo-options" :size="completeProjects().length + 1"
                            :style="`display: ${optVisible && completeProjects().length ? 'block' : 'none'}`"
                            v-model="filtros.desistimientos['proyecto']" @change="optVisible = false;">
                            <option value="">[Todos]</option>
                            <option v-for="p in completeProjects()" :value="p.nombre">
                                {{p.nombre}}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="Agrupaci√≥n" maxlength="50"
                        v-model="filtros.desistimientos['unidad']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <input type="text" placeholder="Asesor" maxlength="50" v-model="filtros.desistimientos['asesor']" />
                </div>
                <div class="pure-u-1-1 pure-u-md-1-8 formInputStandard">
                    <select v-model="filtros.desistimientos['id_estado']">
                        <option value="">[Estados]</option>
                        <option v-for="e in estados" :value="e.id_estado">
                            {{e.nombre}}
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <div class="main-content">
            <table class="dataTable" style="font-size: 15px;">
                <thead>
                    <tr>
                        <th style="width: 8%;">Radicado</th>
                        <th style="width: 8%;">ID Venta</th>
                        <th style="width: 10%;">Doc Comprador</th>
                        <th style="width: 12%;">Nombre</th>
                        <th style="width: 12%;">Proyecto</th>
                        <th style="width: 6%;">Torre</th>
                        <th style="width: 12%;">Agrupaci√≥n/Und</th>
                        <th style="width: 12%;">Asesor</th>
                        <th style="width: 10%;">Fecha</th>
                        <th style="width: 10%;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="d in getFilteredList('desistimientos')" @dblclick="onSelectDes(d)">
                        <td>{{d.radicado}}</td>
                        <td>{{d.id_venta}}</td>
                        <td>{{d.numero_documento}}</td>
                        <td @mouseenter="tooltipVisibleL = true; tooltipMsg = d.nombre_cliente;"
                            @mouseleave="tooltipVisibleL = false;" @mousemove="updateCursor">
                            {{d.nombre_cliente}}
                        </td>
                        <td>{{d.proyecto}}</td>
                        <td>{{d.torre}}</td>
                        <td>{{d.unidad}}</td>
                        <td @mouseenter="tooltipVisibleR = true; tooltipMsg = d.asesor;"
                            @mouseleave="tooltipVisibleR = false;" @mousemove="updateCursorRight">
                            {{d.asesor}}
                        </td>
                        <td>{{formatDatetime(d.created_on, 'bdate')}}</td>
                        <td @mouseenter="tooltipVisibleR = true; tooltipMsg = d.estado;"
                            @mouseleave="tooltipVisibleR = false;" @mousemove="updateCursorRight">
                            {{d.estado}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <div v-if="tooltipVisibleR && tooltipMsg" class="cursor-tooltip" v-html="tooltipMsg"
                :style="{ top: tooltipY + 'px', right: tooltipX + 'px' }">
            </div>
            <div v-if="tooltipVisibleL && tooltipMsg" class="cursor-tooltip" v-html="tooltipMsg"
                :style="{ top: tooltipY + 'px', left: tooltipX + 'px' }">
            </div>
        </div>
    </div>
</div>

<div v-if="mode == 1" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em; margin-bottom: 4px;">
            Nuevo Desistimiento
        </div>
        <div class="pure-u-1-4 formInputStandard">
            <label>ID Venta</label>
            <input type="text" v-model="searchID" @input="searchDoc = null">
        </div>
        <div class="pure-u-1-4 formInputStandard">
            <label>N√∫mero Documento</label>
            <input type="text" v-model="searchDoc" @input="searchID = null">
        </div>
        <div class="pure-u-1-4 formInputStandard" style="text-align: left; margin-top: 1.2rem;">
            <button @click="onFind">Buscar</button>
        </div>

        <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em; margin-bottom: 4px;">
            Informaci√≥n del Cliente
        </div>
        <div class="pure-u-1-2 pure-u-md-1-5">
            <div class="formInputStandard">
                <label>Nombre</label>
                <input type="text" :value="cliente.nombres" readonly>
            </div>
        </div>
        <div class="pure-u-1-2 pure-u-md-1-5">
            <div class="formInputStandard">
                <label>Apellido 1</label>
                <input type="text" :value="cliente.apellido1" readonly>
            </div>
        </div>
        <div class="pure-u-1-2 pure-u-md-1-5">
            <div class="formInputStandard">
                <label>Apellido 2</label>
                <input type="text" :value="cliente.apellido2" readonly>
            </div>
        </div>
        <div class="pure-u-1-2 pure-u-md-1-5">
            <div class="formInputStandard">
                <label>N√∫mero Documento</label>
                <input type="text" :value="cliente.numero_documento" readonly>
            </div>
        </div>
        <div class="pure-u-1-2 pure-u-md-1-5" v-if="cliente && cliente.id_cliente" style="text-align: right;">
            <button @click="redirect2Customer(cliente.id_cliente)" style="margin-top: 1.7rem;">
                Ver Cliente
            </button>
        </div>

        <div v-if="cliente && cliente.id_cliente">
            <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em; margin-bottom: 4px;">
                Ventas
            </div>
            <div style="height: calc(100vh - 25rem); overflow-y: auto;">
                <table class="dataTable" style="table-layout: auto; font-size: 15px;">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Radicado</th>
                            <th style="width: 10%;">ID Venta</th>
                            <th style="width: 14%;">Proyecto</th>
                            <th style="width: 8%;">Torre</th>
                            <th style="width: 12%;">Agrupaci√≥n/Und</th>
                            <th style="width: 12%;">Estado</th>
                            <th style="width: 12%;">Fecha</th>
                            <th style="width: 14%;">Asesor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="v in cliVentas" @dblclick="onSelectVenta(v)">
                            <td>{{v.radicado}}</td>
                            <td>{{v.id_venta}}</td>
                            <td>{{v.proyecto}}</td>
                            <td>{{v.torre}}</td>
                            <td>{{v.unidad}}</td>
                            <td>{{v.estado}}</td>
                            <td>{{v.created_on}}</td>
                            <td>{{v.asesor}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<div v-if="mode == 2" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision'
            style="font-size: 1.5em; margin-bottom: 4px; max-height: 2rem; overflow: hidden;">
            Cliente {{cliente.nombre_cliente}}; #{{desistimiento.radicado}}; {{desistimiento.unidad}}
        </div>

        <div style="height: calc(100vh - 16rem); overflow-y: auto;">
            <div class="pure-u-1-4 formInputStandard">
                <label>ID Venta</label>
                <input type="text" :value="desistimiento.id_venta" readonly>
            </div>
            <div class="pure-u-1-4 formInputStandard">
                <label>N√∫mero Documento</label>
                <input type="text" :value="cliente.numero_documento" readonly>
            </div>

            <div class='formDivision deployable' @click="showClient = !showClient">
                <span>Informaci√≥n del Cliente</span>
                <span class="arrow" v-bind:class="{'expanded': showClient}">&lt;</span>
            </div>
            <div v-show="showClient" style="padding: .5rem;">
                <div class="pure-u-1-2 pure-u-md-1-5">
                    <div class="formInputStandard">
                        <label>Nombre</label>
                        <input type="text" :value="cliente.nombres" readonly>
                    </div>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-5">
                    <div class="formInputStandard">
                        <label>Apellido 1</label>
                        <input type="text" :value="cliente.apellido1" readonly>
                    </div>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-5">
                    <div class="formInputStandard">
                        <label>Apellido 2</label>
                        <input type="text" :value="cliente.apellido2" readonly>
                    </div>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-5">
                    <div class="formInputStandard">
                        <label>N√∫mero Documento</label>
                        <input type="text" :value="cliente.numero_documento" readonly>
                    </div>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-5" v-if="cliente && cliente.id_cliente" style="text-align: right;">
                    <button @click="redirect2Customer(cliente.id_cliente)" style="margin-top: 1.7rem;">
                        Ver Cliente
                    </button>
                </div>
            </div>

            <div class='formDivision deployable' @click="showInfo = !showInfo">
                <span>Informaci√≥n Radicaci√≥n #{{desistimiento.radicado}}</span>
                <span class="arrow" v-bind:class="{'expanded': showInfo}">&lt;</span>
            </div>
            <div v-show="showInfo" style="padding: .5rem;">
                <div class="pure-u-1-5 formInputStandard">
                    <label># Radicado:</label>
                    <input type="text" v-model="f_radicado" @input="validarNumero($event, true)">
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Fecha Creaci√≥n:</label>
                    <input type="datetime-local" :value="desistimiento.created_on" readonly>
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Incumplimientos:</label>
                    <input type="text" v-model="f_cant_incumplida" @input="validarNumero($event, true)">
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>F. Resoluci√≥n Sinco:</label>
                    <input type="date" v-model="desistimiento.fecha_resolucion">
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Estado Actual:</label>
                    <select :value="desistimiento.id_estado" disabled>
                        <option value="">[Seleccionar]</option>
                        <option v-for="e in estados" :value="e.id_estado">{{e.nombre}}</option>
                    </select>
                </div>
            </div>

            <div class='formDivision deployable' @click="showDatamart = !showDatamart">
                <span>Valores de la operaci√≥n en Datamart</span>
                <span class="arrow" v-bind:class="{'expanded': showDatamart}">&lt;</span>
            </div>
            <div v-show="showDatamart" style="padding: .5rem;">
                <table class="dataTable">
                    <thead>
                        <tr>
                            <th>Fecha FPC</th>
                            <th>FEC Program.</th>
                            <th>Valor Venta Neto</th>
                            <th>Valor Abonado</th>
                            <th>A Capital</th>
                            <th>A Intereses</th>
                            <th>Condonaci√≥n</th>
                            <th>Imp. Reformas</th>
                        </tr>
                    </thead>
                    <tbody class="editTable">
                        <tr>
                            <td>
                                <input type="date" v-model="desistimiento.fecha_fpc">
                            </td>
                            <td>
                                <input type="date" v-model="desistimiento.fecha_program">
                            </td>
                            <td>
                                <input type="text" v-model="f_v_venta_neto" @input="validarNumero($event, true)">
                            </td>
                            <td>
                                <input type="text" :value="f_v_abonado" readonly>
                            </td>
                            <td>
                                <input type="text" v-model="f_a_capital" @input="validarNumero($event, true)">
                            </td>
                            <td>
                                <input type="text" v-model="f_a_intereses" @input="validarNumero($event, true)">
                            </td>
                            <td>
                                <input type="text" v-model="f_condonacion" @input="validarNumero($event, true)">
                            </td>
                            <td>
                                <input type="text" v-model="f_imp_reformas" @input="validarNumero($event, true)">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class='formDivision deployable' @click="showGestion = !showGestion">
                <span>Gesti√≥n</span>
                <span class="arrow" v-bind:class="{'expanded': showGestion}">&lt;</span>
            </div>
            <div v-show="showGestion" style="padding: .5rem;">
                <div class="pure-u-1-2 formInputStandard">
                    <label>Categor√≠a Desistimiento:</label>
                    <select v-model="desistimiento.id_categoria" :disabled="Number(desistimiento.id_estado) > 4">
                        <option value="">[Seleccionar]</option>
                        <option v-for="c in categorias" :value="c.id_categoria">
                            {{c.categoria}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-4 formInputStandard">
                    <label>Fiduciaria:</label>
                    <select v-model="desistimiento.id_fiduciaria" :disabled="Number(desistimiento.id_estado) > 4">
                        <option value="">[Seleccionar]</option>
                        <option v-for="f in fiduciarias" :value="f.id_fiduciaria">
                            {{f.fiduciaria}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-4 formInputStandard">
                    <label>Etapa Proyecto:</label>
                    <select v-model="desistimiento.etapa" :disabled="Number(desistimiento.id_estado) > 4">
                        <option value="">[Seleccionar]</option>
                        <option value="INMOBILIARIO">INMOBILIARIO</option>
                        <option value="PREVENTA">PREVENTA</option>
                    </select>
                </div>

                <div class="pure-u-1-4 formInputStandard">
                    <label>Aplica Penalidad:</label>
                    <select v-model="desistimiento.id_penalidad" :disabled="Number(desistimiento.id_estado) > 4">
                        <option v-for="p in penalidades" :value="p.id_penalidad">
                            {{p.penalidad}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-4">
                    <div class="formInputStandard" v-if="getCampoPenalidad()">
                        <label>{{getCampoPenalidad()}}:</label>
                        <input v-if="Number(desistimiento.id_estado) > 4" type="text" :value="f_campo" readonly>
                        <input v-else type="text" v-model="f_campo" @input="validarNumero">
                    </div>
                </div>
                <div class="pure-u-1-2"></div>

                <div class="pure-u-1-4 formInputStandard">
                    <label>Inter√©s Generado:</label>
                    <input v-if="Number(desistimiento.id_estado) > 4" type="text" :value="f_interes" readonly>
                    <input v-else type="text" v-model="f_interes" @input="validarNumero">
                </div>
                <div class="pure-u-1-4 formInputStandard">
                    <label>Gastos Administrativos:</label>
                    <input v-if="Number(desistimiento.id_estado) > 4" type="text" :value="f_gasto" readonly>
                    <input v-else type="text" v-model="f_gasto" @input="validarNumero">
                </div>
                <div class="pure-u-1-4 formInputStandard">
                    <label>Otro descuento devoluci√≥n:</label>
                    <input v-if="Number(desistimiento.id_estado) > 4" type="text" :value="f_descuento" readonly>
                    <input v-else type="text" v-model="f_descuento" @input="validarNumero">
                </div>
                <div class="pure-u-1-4 formInputStandard">
                    <label class="check" for="devolver_reforma" style="margin-top: 1.7rem;">
                        <input v-if="Number(desistimiento.id_estado) > 4" type="checkbox" id="devolver_reforma"
                            :value="desistimiento.devolver_reforma" true-value="1" false-value="0" disabled />
                        <input v-else type="checkbox" id="devolver_reforma" v-model="desistimiento.devolver_reforma"
                            true-value="1" false-value="0" />
                        <span class="checkmark"></span>
                        Devolver Valor Reformas
                    </label>
                </div>

            </div>

            <div class='formDivision deployable' @click="showLiq = !showLiq">
                <span>Liquidaci√≥n</span>
                <span class="arrow" v-bind:class="{'expanded': showLiq}">&lt;</span>
            </div>
            <div v-show="showLiq" style="padding: .5rem;">
                <table class="dataTable">
                    <thead>
                        <tr>
                            <th>% PNL PCV</th>
                            <th>% PNL Aplicada</th>
                            <th>PNL Aplicada</th>
                            <th>PNL Bruta</th>
                            <th>PNL Neta</th>
                            <th>Devoluci√≥n</th>
                            <th>4xmil</th>
                            <th>L√≠quido</th>
                        </tr>
                    </thead>
                    <tbody class="editTable">
                        <tr>
                            <td>
                                <input type="text" v-model="f_pnl_pcv" readonly>
                            </td>
                            <td>
                                <input type="text" v-model="f_pnl_aplicada_ptg" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_pnl_aplicada_val" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_pnl_bruta" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_pnl_neta" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_devolucion" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_4xmil" readonly>
                            </td>
                            <td>
                                <input type="text" :value="f_liquido" readonly>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>



            <div class='formDivision deployable' @click="showDocs = !showDocs">
                <span>Documentos Adjuntos</span>
                <span class="arrow" v-bind:class="{'expanded': showDocs}">&lt;</span>
            </div>
            <div v-show="showDocs" style="padding: .5rem;">
                <div class="pure-u-1 small-files" @mousemove="updateCursor" @mouseleave="tooltipVisibleL = false"
                    style="position: relative; padding: .5rem;">
                    <label for="file-input" class="preview-container"
                        style="height: 8rem; cursor: pointer; max-height: 100%;" @dragover.prevent="handleDragOver"
                        @drop.prevent="handleDrop"
                        @mouseenter="tooltipVisibleL = true; tooltipMsg = 'Arrastra o haz clic para cargar archivos.'"
                        @mouseleave="tooltipVisibleL = false">
                        <div v-if="previews.length === 0" class="center-absolute ">
                            Arrastra o haz clic para cargar archivos.
                        </div>
                        <div class="image-card" v-for="(item, index) in previews" :key="index" draggable="true"
                            @dragstart="dragStart(index)" @mouseenter="tooltipVisibleL = false"
                            @mouseleave="tooltipVisibleL = true" style="position: relative;">
                            <img :src="item.src" @click.stop.prevent=""
                                @mouseenter="tooltipVisibleL = true; tooltipMsg = item.newName"
                                @mouseleave="tooltipVisibleL = false; tooltipMsg = 'Arrastra o haz clic para cargar archivos.'" />
                            <input v-model="item.newName" class="image-name-overlay editable" @click.stop />
                            <div class="download-btn">
                                <a :href="getURLFile(item.file)" :download="item.file.name">
                                    <img src="../../img/ico/download.jpg">
                                </a>
                            </div>
                            <div class="delete-btn" @click.stop.prevent="removeImage(index)">‚úñ</div>
                        </div>
                        <div v-if="tooltipVisibleL" class="cursor-tooltip"
                            :style="{ top: tooltipY + 'px', left: tooltipX + 'px' }">
                            {{tooltipMsg}}
                        </div>
                    </label>
                    <input type="file" id="file-input" class="hidden-input" style="display: none;" multiple accept="*"
                        @change="handleFileChange" ref="fileInput" />
                </div>

                <div class="pure-u-1-1 formInputStandard">
                    <label>Comentarios de Asesor:</label>
                    <textarea rows="5" v-model="desistimiento.observacion" style="resize: none; height: auto;">
                    </textarea>
                </div>
            </div>

        </div>
        <div class="pure-u-2-5" style="text-align: left; padding-top: 1rem;">
            <button v-if="previews.length && desistimiento.id_estado != '5' && desistimiento.id_estado != '6'"
                @click="onSaveFiles">Guardar Adjuntos</button>
        </div>
        <div class="pure-u-1-5" style="text-align: center; padding-top: 1rem;">
            <button @click="onSave(false)"
                v-if="desistimiento.id_estado != '4' && desistimiento.id_estado != '5' && desistimiento.id_estado != '6'">
                Guardar
            </button>
        </div>
        <div class="pure-u-2-5" style="text-align: right; padding-top: 1rem;">
            <button v-if="desistimiento.id_estado === '1'" @click="setEstado('2')" class="red-btn">Solicitar</button>
            <button v-if="Number(desistimiento.id_estado) >= 2" @click="setMode(3)">Ver Solicitud</button>
        </div>

    </div>
</div>

<div v-if="mode == 3" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision'
            style="font-size: 1.5em; margin-bottom: 4px; max-height: 2rem; overflow: hidden;">
            Cliente {{cliente.nombre_cliente}}; #{{desistimiento.radicado}}; {{desistimiento.unidad}}
        </div>

        <div style="height: calc(100vh - 16rem); overflow-y: auto;">
            <div class="pure-u-1-4 formInputStandard">
                <label>ID Venta</label>
                <input type="text" :value="desistimiento.id_venta" readonly>
            </div>
            <div class="pure-u-1-4 formInputStandard">
                <label>N√∫mero Documento</label>
                <input type="text" :value="cliente.numero_documento" readonly>
            </div>

            <div class='formDivision'>
                <span>Aprobaciones Coordinaci√≥n/Direcci√≥n y Gerencia</span>
            </div>
            <div class="pure-u-1-2">
                <div class="formInputStandard">
                    <span>{{selApprover.type}}</span>
                    <select v-model="selApprover">
                        <option v-for="a in optApprove" :value="a">{{a.name}}</option>
                    </select>
                    <textarea rows="5" v-model="desistimiento.com_coordinacion"
                        style="resize: none; height: auto; margin-top: .5rem;"
                        :placeholder="`Comentarios ${selApprover.type}`"
                        :disabled="desistimiento.id_estado !== '2'"></textarea>
                </div>
                <div class="pure-u-1-2" style="padding: 0 .5rem;">
                    <input type="date" readonly :disabled="desistimiento.id_estado !== '2'"
                        :value="desistimiento.fec_com_coordinacion || formatDatetime('', 'bdate')">
                </div>
                <div class="pure-u-1-2"></div>
                <div v-if="enableCoordinacion || enableDireccion"
                    v-bind:class="{'grp-btn-disabled': desistimiento.id_estado !== '2'}">
                    <div class="pure-u-1-2 formInputStandard">
                        <button class="red-btn"
                            @click="desistimiento.id_estado === '2' && includesMsg(desistimiento.com_coordinacion) && setEstado('3')">
                            Aprobar
                        </button>
                    </div>
                    <div class="pure-u-1-2 formInputStandard">
                        <button
                            @click="desistimiento.id_estado === '2' && includesMsg(desistimiento.com_coordinacion) && setEstado('6')">
                            No Aceptar
                        </button>
                    </div>
                </div>
            </div>
            <div class="pure-u-1-2">
                <div class="formInputStandard">
                    <span>Gerencia</span>
                    <input type="text" :value="desistimiento.gerente" readonly>
                    <textarea rows="5" v-model="desistimiento.com_gerencia"
                        style="resize: none; height: auto; margin-top: .5rem;" placeholder="Comentarios Gerencia"
                        :disabled="desistimiento.id_estado !== '3'"></textarea>
                </div>
                <div class="pure-u-1-2" style="padding: 0 .5rem;">
                    <input type="date" readonly :disabled="desistimiento.id_estado !== '3'"
                        :value="desistimiento.fec_com_gerencia || formatDatetime('', 'bdate')">
                </div>
                <div class="pure-u-1-2"></div>
                <div v-if="enableGerencia" v-bind:class="{'grp-btn-disabled': desistimiento.id_estado !== '3'}">
                    <div class="pure-u-1-2 formInputStandard">
                        <button class="red-btn"
                            @click="desistimiento.id_estado === '3' && includesMsg(desistimiento.com_gerencia) && setEstado('4')">
                            Aprobar
                        </button>
                    </div>
                    <div class="pure-u-1-2 formInputStandard">
                        <button
                            @click="desistimiento.id_estado === '3' && includesMsg(desistimiento.com_gerencia) && setEstado('6')">
                            No Aceptar
                        </button>
                    </div>
                </div>
            </div>

            <div class='formDivision deployable' @click="showCarta = !showCarta"
                v-if="desistimiento.id_estado == '4' || desistimiento.id_estado == '5'">
                <span>Carta de segunda oportunidad</span>
                <span class="arrow" v-bind:class="{'expanded': showCarta}">&lt;</span>
            </div>
            <div id="pdf-content" v-show="showCarta" style="padding: .5rem;">
                <div class="pure-u-1-5 formInputStandard">
                    <label>Titular</label>
                    <input type="text" :value="desistimiento.nombre_cliente" readonly>
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Documento titular</label>
                    <input type="text" :value="desistimiento.numero_documento" readonly>
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Fecha prorroga</label>
                    <input type="date" v-model="desistimiento.fec_prorroga_carta">
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Extra por prorroga</label>
                    <input type="text" v-model="f_extra_prorroga_carta" @input="validarNumero($event, true)">
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <label>Valor Carta</label>
                    <input type="text" :value="f_val_carta" readonly>
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <button @click="printPDF('template-carta')">
                        Ver Carta
                    </button>
                </div>
                <div class="pure-u-1-5 formInputStandard">
                    <button class="red-btn" @click="printPDF('template-formato-dev')">Enviar carta</button>
                </div>
                <div class="pure-u-2-5 formInputStandard"></div>
                <div class="pure-u-1-5 formInputStandard" style="text-align: right;">
                    <button v-if="desistimiento.id_estado == '4'" @click="onSave(true)">
                        Guardar
                    </button>
                </div>
            </div>

            <div class='formDivision deployable' @click="showCuentas = !showCuentas"
                v-if="desistimiento.id_estado == '4' || desistimiento.id_estado == '5'">
                <span>Cuenta(s) para consignaci√≥n de recursos</span>
                <button v-if="showCuentas" style="margin-left: auto; margin-right: 1rem;"
                    @click.stop.prevent="onAddAccount">
                    Agregar cuenta
                </button>
                <span class="arrow" v-bind:class="{'expanded': showCuentas}">&lt;</span>
            </div>
            <div v-show="showCuentas" style="padding: .5rem;">
                <table class="dataTable" style="font-size: 15px;">
                    <thead>
                        <tr>
                            <th style="width: 18%;">Titular</th>
                            <th style="width: 11%;">Doc. titular</th>
                            <th style="width: 13%;">Entidad financiera</th>
                            <th style="width: 14%;">Num. de cuenta</th>
                            <th style="width: 11%;">Tipo de cuenta</th>
                            <th style="width: 6%;">%</th>
                            <th style="width: 12%;">Tipo Giro</th>
                            <th style="width: 7%;">Editar</th>
                            <th style="width: 8%;">Eliminar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="newRow" class="editTable">
                            <td>
                                <select v-model="selCliente">
                                    <option v-for="c in getCustomers()" :value="c">
                                        {{c.nombre_cliente}}
                                    </option>
                                </select>
                            </td>
                            <td>
                                <input type="text" readonly :value="selCliente.numero_documento">
                            </td>
                            <td>
                                <input type="text" v-model="cuenta.entidad">
                            </td>
                            <td>
                                <input type="text" v-model="cuenta.numero_cuenta">
                            </td>
                            <td>
                                <input type="text" v-model="cuenta.tipo_cuenta">
                            </td>
                            <td>
                                <input type="text" v-model="f_cuenta_porcentaje">
                            </td>
                            <td>
                                <select v-model="cuenta.tipo_giro">
                                    <option value="" selected>[Seleccione]</option>
                                    <option value="Cheque">Cheque</option>
                                    <option value="Transferencia">Transferencia</option>
                                </select>
                            </td>
                            <td style="text-align: center;">
                                <span @click.stop.prevent="onSaveAccount" class="delete">üíæ</span>
                            </td>
                            <td style="text-align: center;">
                                <span @click.stop.prevent="onDeleteAccount" class="delete">‚úñ</span>
                            </td>
                        </tr>
                        <tr v-for="(c, i) in cuentas" @click="onSelectRow(i)"
                            v-bind:class="{'destacada': selRow === i, 'editTable': editRow && selRow === i}">
                            <td>
                                <select v-if="editRow && selRow === i" v-model="selCliente">
                                    <option v-for="cl in getCustomers()" :value="cl">
                                        {{cl.nombre_cliente}}
                                    </option>
                                </select>
                                <span v-else>{{ c.nombre_cliente }}</span>
                            </td>
                            <td>
                                <input v-if="editRow && selRow === i" type="text" readonly
                                    :value="selCliente.numero_documento">
                                <span v-else>{{ c.numero_documento }}</span>
                            </td>
                            <td>
                                <input v-if="editRow && selRow === i" type="text" v-model="cuenta.entidad">
                                <span v-else>{{ c.entidad }}</span>
                            </td>
                            <td>
                                <input v-if="editRow && selRow === i" type="text" v-model="cuenta.numero_cuenta">
                                <span @mouseenter="tooltipVisibleL = true; tooltipMsg = c.numero_cuenta;"
                                    @mouseleave="tooltipVisibleL = false;" @mousemove="updateCursor" v-else>
                                    {{ c.numero_cuenta }}
                                </span>
                            </td>
                            <td>
                                <input v-if="editRow && selRow === i" type="text" v-model="cuenta.tipo_cuenta">
                                <span v-else>{{ c.tipo_cuenta }}</span>
                            </td>
                            <td>
                                <input v-if="editRow && selRow === i" type="text" v-model="f_cuenta_porcentaje">
                                <span v-else>{{ formatNumber(c.porcentaje, true) }}</span>
                            </td>
                            <td>
                                <select v-if="editRow && selRow === i" v-model="cuenta.tipo_giro">
                                    <option value="" selected>[Seleccione]</option>
                                    <option value="Cheque">Cheque</option>
                                    <option value="Transferencia">Transferencia</option>
                                </select>
                                <span v-else>{{ c.tipo_giro }}</span>
                            </td>
                            <td style="text-align: center;">
                                <span v-if="editRow && selRow === i" @click.stop.prevent="onSaveAccount"
                                    class="delete">üíæ</span>
                                <span v-else @click.stop.prevent="enableEdit(c, i)" class="delete">‚úèÔ∏è</span>
                            </td>
                            <td style="text-align: center;">
                                <span @click.stop.prevent="onDeleteAccount(c)" class="delete">‚úñ</span>
                            </td>

                        </tr>
                    </tbody>
                </table>
                <div v-if="tooltipVisibleL" class="cursor-tooltip"
                    :style="{ top: tooltipY + 'px', left: tooltipX + 'px' }">
                    {{tooltipMsg}}
                </div>
            </div>

        </div>

        <div class="pure-u-2-5" style="text-align: left; padding-top: 1rem;">
            <button @click="setMode(2)">Volver</button>
        </div>
        <div class="pure-u-1-5" style="text-align: center; padding-top: 1rem;">
            <button @click="onSave(false)"
                v-if="desistimiento.id_estado !== '4' && desistimiento.id_estado !== '5' && desistimiento.id_estado !== '6'">
                Guardar
            </button>
        </div>
        <div class="pure-u-2-5" style="text-align: right; padding-top: 1rem;">
            <button v-if="desistimiento.id_estado === '4'" @click="setEstado('5')" class="red-btn">
                Terminar
            </button>
        </div>
    </div>
</div>

<div style="display: none;" v-if="desistimiento && mode == 3">
    <div id="template-carta" class="pdf-template">

        <img src="../../img/background/pdf_header.png" alt="Capital" style="width: 100%; height: auto;">
        <img src="../../img/background/pdf_watermark.png" style="position: absolute;
                    top: 65%;
                    left: 52%;
                    opacity: 0.1;
                    z-index: 0;
                    width: 400px;" />
        <div style="padding: 0 2.2rem; font-size: 13px; color: #000; font-weight: 400; line-height: 1.19; flex: 1;">

            <p>{{desistimiento.sede}}, {{formatDatetime(desistimiento.created_on, 'textdate')}}</p>
            <p>Se√±or(a):
                <br>
                <span style="font-weight: bold;">{{desistimiento.nombre_cliente}} </span>
                <span> (CC {{desistimiento.numero_documento}})</span>
            </p>
            <p style="font-weight: bold;">
                Ref: Carta de Segunda Oportunidad
                <br>
                Desistimiento Inmueble: {{desistimiento.proyecto}} TORRE {{desistimiento.torre}}
                {{desistimiento.unidad}}
            </p>
            <p style="margin-top: 2rem;">Respetado(s) se√±or(es):</p>
            <p style="text-align: justify;">
                Reciba(n) un cordial saludo. Lamentamos profundamente que no hayamos logrado
                cumplir nuestro objetivo
                com√∫n de llevar
                su negocio a feliz t√©rmino. En Constructora Capital reiteramos nuestro compromiso de hacer tu vida
                nuestro proyecto, por
                esta raz√≥n y de manera especial queremos informarle que a partir de este momento y
                <span style="font-weight: bold;">{{desistimiento.fec_prorroga_carta
                    ? formatDatetime(desistimiento.fec_prorroga_carta, 'textdate')
                    : formatDatetime(null, 'textdate', dateAddYears(desistimiento.created_on, 1))}}
                    {{desistimiento.fec_prorroga_carta ? ' (Fecha Prorrogada)' : ''}}</span>
                usted tendr√° la posibilidad de adquirir otro inmueble en alguno de nuestros proyectos; y para ello puede
                emplear el valor
                penalizado como abono a un inmueble.
            </p>
            <div style="border: 1px solid black; width: 100%;">
                <div style="padding: 6px .5rem; border-bottom: 1px solid black; display: flex;">
                    <span style="width: 50%; font-weight: bold;">VALOR PENALIZADO</span>
                    <span style="width: 50%;">${{f_pnl_neta}}</span>
                </div>
                <div style="padding: 6px .5rem; border-bottom: 1px solid black; display: flex;">
                    <span style="width: 50%; font-weight: bold;">GASTOS ADMINISTRATIVOS</span>
                    <span style="width: 50%;">${{f_gasto}}</span>
                </div>
                <div style="padding: 6px .5rem; border-bottom: 1px solid black;"
                    :style="`display: ${f_extra_prorroga_carta && f_extra_prorroga_carta != '0' ? 'flex': 'none'}`">
                    <span style="width: 50%; font-weight: bold;">EXTRA POR PR√ìRROGA</span>
                    <span style="width: 50%;">${{f_extra_prorroga_carta}}</span>
                </div>
                <div style="padding: 6px .5rem; display: flex; background: #eee;">
                    <span style="width: 50%; font-weight: bold;">VALOR AUTORIZADO NUEVO NEGOCIO</span>
                    <span style="width: 50%;">${{f_val_carta}}</span>
                </div>
                <div style="padding: 0 .5rem 6px .5rem; display: flex; background: #eee; align-items: center;">
                    <span style="width: 50%; font-weight: bold;">VALOR EN LETRAS</span>
                    <span style="width: 50%;">{{desistimiento.val_carta_texto}}</span>
                </div>
            </div>
            <p style="text-align: justify;">
                Para hacer efectiva esta opci√≥n, lo invitamos a acercarse a cualquiera de nuestras salas de ventas,
                realizar su separaci√≥n y
                presentar este documento al asesor para que este refleje el valor del descuento en la nueva negociaci√≥n.
            </p>
            <p style="text-align: justify;">
                Es importante tener en cuenta las condiciones del nuevo negocio, mantener un impecable comportamiento en
                los pagos y
                cumplir con las fechas pactadas para cada uno de los tr√°mites de su proceso de compra y de esta forma
                evitar un nuevo
                desistimiento. Por favor tener presente que este valor es aplicable por una sola vez en cabeza del (de
                los) titular(es) de esta
                carta.
            </p>
            <p style="text-align: justify;">
                Lo invitamos a visitar nuestra p√°gina web
                <a style="color: #000; text-decoration: none;"
                    href="https://www.constructoracapital.com">www.constructoracapital.com.co</a>
                para conocer los proyectos con inventario
                disponible o estar inform√°ndose de los lanzamientos que realizaremos en los pr√≥ximos meses, para as√≠
                poder escoger el
                proyecto que le permita alcanzar su meta de comprar vivienda con nosotros.
            </p>
            <p style="font-weight: bold; text-align: justify;">
                NOTA: Esta carta no es un t√≠tulo valor, su aplicaci√≥n al respectivo
                plan de pagos estar√° sujeto a revisi√≥n por parte
                de Constructora Capital para garantizar que los recursos se encuentran vigentes y/o no han sido
                aplicados a otras
                negociaciones o reintegrados al titular de la carta por alguna excepci√≥n o reconsideraci√≥n en el
                proceso de desistimiento que genero la presente carta.
            </p>
            <p>Cordialmente,</p>
            <div style="height: 90px;"></div>
            <p>
                <span style="font-weight: bold;">CARLOS ALBERTO PERRY WOBST</span>
                <br>
                Gerente Comercial Constructora Capital Bogot√° S.A.S
            </p>
        </div>
        <div style="height: 50px; text-align: center; font-size: 12px;">
            <span style="display: block;">Constructora Capital Bogot√° S.A.S. NIT: 900192711-6</span>
            <span style="display: block;">
                Carrera 67 N¬∫ 100 - 20 Of. 503 | PBX: (571) 641 7033 | Bogot√° - Colombia
                <a style="color: #000; text-decoration: none; font-weight: bold;"
                    href="https://www.constructoracapital.com">www.constructoracapital.com</a>
            </span>
        </div>
    </div>
</div>

<div style="display: block;" v-if="desistimiento && mode == 3">
    <div id="template-formato-dev" class="pdf-template">
        <div
            style="padding: 2.2rem; padding-bottom: .5rem; padding-top: 1.8rem; display: flex; justify-content: space-between; line-height: 1.08;">
            <div style="width: 23%;" id="logo-capital">
            </div>
            <div style="height: 100%; display: flex; align-items: center; width: 25%;">
                <h4 style="color: #009AB9; font-weight: bold;">Formato √∫nico de Devoluci√≥n</h4>
            </div>
            <div style="height: 100%; display: flex; flex-direction: column; width: 33%; font-size: 12.5px;">
                <div><span style="font-weight: bold;">Radicado #</span>{{desistimiento.radicado}}</div>
                <div><span style="font-weight: bold;">ID Venta Sinco:</span> {{desistimiento.id_venta}}</div>
                <div style="margin-top: 13px;"><span style="font-weight: bold;">Estado Actual:</span>
                    {{desistimiento.estado}}</div>
                <div><span style="font-weight: bold;">Cant. Incumplimientos:</span> {{desistimiento.cant_incumplida}}
                </div>
                <div><span style="font-weight: bold;">Fecha Creado:</span> {{formatDatetime(desistimiento.created_on,
                    'bdate')}}</div>
                <div><span style="font-weight: bold;">Fecha Resoluci√≥n Sinco:</span> {{desistimiento.fecha_resolucion ?
                    formatDatetime(desistimiento.fecha_resolucion, 'bdate') : ''}}</div>
            </div>
        </div>
        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Informaci√≥n del Negocio</span>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="border-left: #777 solid 1px;">Macroproyecto</th>
                        <th>Proyecto</th>
                        <th>Agrupaci√≥n</th>
                        <th>No.Encargo</th>
                        <th>Referencia Banc.</th>
                        <th>Fecha FPC</th>
                        <th>FEC Programada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border-left: #777 solid 1px;">{{desistimiento.proyecto}}</td>
                        <td>{{`${desistimiento.proyecto} Torre ${desistimiento.torre}`}}</td>
                        <td>{{desistimiento.unidad}}</td>
                        <td></td>
                        <td></td>
                        <td>{{desistimiento.fecha_fpc}}</td>
                        <td>{{desistimiento.fecha_program}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        
        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Informaci√≥n General Desistimiento</span>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="border-left: #777 solid 1px;">Categor√≠a Desistimiento</th>
                        <th>Fiduciaria</th>
                        <th>Etapa Proyecto</th>
                        <th>% PNL PCV</th>
                        <th>% PNL Aplicada</th>
                        <th>PNL Aplicada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border-left: #777 solid 1px;">{{desistimiento.categoria}}</td>
                        <td>{{desistimiento.fiduciaria}}</td>
                        <td>{{desistimiento.etapa}}</td>
                        <td>{{f_pnl_pcv}}</td>
                        <td>{{f_pnl_aplicada_ptg}}</td>
                        <td>{{f_pnl_aplicada_val}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Comentario</span>
            <p style="text-align: justify;">{{desistimiento.observacion}}</p>
        </div>

        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Informaci√≥n General Desistimiento</span>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="border-left: #777 solid 1px;">Valor Venta Neto</th>
                        <th>Valor Abonado</th>
                        <th>Abonado a Intereses</th>
                        <th>Abonado a Capital</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border-left: #777 solid 1px;">${{f_v_venta_neto}}</td>
                        <td>${{f_v_abonado}}</td>
                        <td>${{f_a_intereses}}</td>
                        <td>${{f_a_capital}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Liquidaci√≥n - Aplica penalidad: {{desistimiento.penalidad}}</span>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="border-left: #777 solid 1px;">Valor Abonado</th>
                        <th>PNL Bruta</th>
                        <th>PNL Neta</th>
                        <th>Inter√©s Pagado</th>
                        <th>Inter√©s Generado</th>
                        <th>Inter√©s Condonado</th>
                        <th>Reformas</th>
                        <th>Otro descuento devoluci√≥n</th>
                        <th>Saldo a favor del cliente</th>
                        <th>4xMil</th>
                        <th>Giro al cliente</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border-left: #777 solid 1px;">${{f_v_abonado}}</td>
                        <td>${{f_pnl_bruta}}</td>
                        <td>${{f_pnl_neta}}</td>
                        <td>${{f_a_intereses}}</td>
                        <td>${{f_interes}}</td>
                        <td>${{f_condonacion}}</td>
                        <td>${{f_imp_reformas}}</td>
                        <td>${{f_descuento}}</td>
                        <td>${{f_devolucion}}</td>
                        <td>${{f_4xmil}}</td>
                        <td>${{f_liquido}}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="padding: .5rem 2.2rem;">
            <span style="color: #009AB9; font-weight: bold; font-size: 15px;">Carta de Segunda Oportunidad</span>
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th style="border-left: #777 solid 1px;">Carta.</th>
                        <th>PNL Neta</th>
                        <th>Gastos Admin.</th>
                        <th>Vlr. Carta</th>
                        <th>Vigencia</th>
                        <th>Fecha Pr√≥rroga</th>
                        <th>Vlr Extra Pr√≥rroga</th>
                        <th>Vlr Carta Prorrogada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border-left: #777 solid 1px;">SI</td>
                        <td>${{f_pnl_neta}}</td>
                        <td>${{f_gasto}}</td>
                        <td>${{f_val_carta}}</td>
                        <td>{{formatDatetime(null, 'bdate', dateAddYears(desistimiento.created_on, 1))}}</td>
                        <td>{{desistimiento.fecha_prorroga_carta}}</td>
                        <td>${{f_extra_prorroga_carta}}</td>
                        <td>${{f_val_carta}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>