<div v-if="mode == 0" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision right-button' style="margin-bottom: 4px;">
            <span style="font-size: 1.5em;">Trazabilidad Acciones Clientes</span>
            <div style="display: flex; gap: 5px; width: 240px;">
                <button>Enviar Correos</button>
                <button @click="openModal('grafica')">Ver Gr√°fico</button>
            </div>
        </div>
        <div class="filtros-container" style="padding: .7rem;">
            <div class="filtros-center" style="grid-template-columns: repeat(9, 1fr);">

                <div style="display: flex; grid-column: 1 / -1; align-items: center; gap: .5rem; width: 100%;">
                    <div class="radio-group cal-opc">
                        <label for="view-s" style="text-align: center; width: 8rem;">
                            <input type="radio" name="view" id="view-s" :checked="filMode == 'week'"
                                @click="updateFilMode('week')">
                            <span>√öltima Semana</span>
                        </label>
                        <label for="view-m" style="text-align: center; width: 8rem;">
                            <input type="radio" name="view" id="view-m" :checked="filMode == 'month'"
                                @click="updateFilMode('month')">
                            <span>√öltimo Mes</span>
                        </label>
                        <label for="view-r" style="text-align: center; width: 8rem;">
                            <input type="radio" name="view" id="view-r" :checked="filMode == 'range'"
                                @click="updateFilMode('range')">
                            <span>Rango Fechas</span>
                        </label>
                    </div>
                    <div v-if="filMode == 'range'" style="display: flex; align-items: center;">
                        <input type="date" style="width: 8rem;" v-model="filtros.trazabilidad.created_on1"
                            :max="filtros.trazabilidad.created_on2">
                        &ensp;-&ensp;
                        <input type="date" style="width: 8rem;" v-model="filtros.trazabilidad.created_on2"
                            :min="filtros.trazabilidad.created_on1" :max="formatDatetime('', 'bdate')">
                    </div>
                    <div style="margin-left: auto;">
                        <img src="../../img/cli/excel_02.png" alt="Excel" class="pure-img logoExcel"
                            @click="exportExcel('trazabilidad')" title="Descargar datos a Excel" />
                    </div>
                </div>
                <div class="checkbox-group" style="margin-top: .4rem; padding-top: .5rem; border-top: 2px solid #d1d5db; 
                    justify-content: space-evenly; grid-column: 1 / 4;">
                    <div style="display: flex; gap: .5rem">
                        <select v-model="filtros.trazabilidad.asesor" style="flex: 3;">
                            <option :value="undefined">[Asesor]</option>
                            <option v-for="a in asesores" :value="a.usuario">{{a.nombres}}</option>
                        </select>
                        <input type="text" v-model="filtros.trazabilidad.nombre_cliente" placeholder="Cliente"
                            style="flex: 2;">
                    </div>
                </div>
                <div class="checkbox-group" style="margin-top: .4rem; margin-left: -5px; padding-top: .5rem; padding-left: 5px;
                    border-top: 2px solid #d1d5db; justify-content: space-evenly; grid-column: 4 / -1;">
                    <label v-for="a in acciones">
                        <input type="checkbox" :true-value="a.obj" false-value="" v-model="filtros.trazabilidad.obj"
                            @change="setAccion">
                        {{a.accion}}
                    </label>
                </div>
            </div>
        </div>

        <div style="height: calc(100vh - 20rem); overflow-y: auto;">

            <table class="dataTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th style="width: 20%;">Cliente</th>
                        <th style="width: 14%;">Proyecto</th>
                        <th style="width: 15%;">Unidad</th>
                        <th style="width: 12%;">Fecha</th>
                        <th style="width: 20%;">Asesor</th>
                        <th style="width: 13%;">Tipo Acci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="t in getFilteredList('trazabilidad')"
                        @dblclick="['Cotizaci√≥n', 'Opci√≥n'].includes(t.obj) && (openModal(t.obj, t.id_obj));">
                        <td style="text-align: center; padding: 0.2em 2px; font-size: 15px;">{{t.id_obj}}</td>
                        <td>{{t.nombre_cliente}}</td>
                        <td>{{t.proyecto}}</td>
                        <td @mouseenter="tooltipVisible = true; tooltipMsg = t.unidad"
                            @mouseleave="tooltipVisible = false;" @mousemove="updateCursor">
                            {{t.unidad}}
                        </td>
                        <td>{{t.created_on}}</td>
                        <td>{{t.nombre_asesor}}</td>
                        <td>{{t.obj}}
                        </td>
                    </tr>
                </tbody>
            </table>
            <div v-if="tooltipVisible && tooltipMsg" class="cursor-tooltip"
                :style="{ top: tooltipY + 'px', left: tooltipX + 'px' }">
                {{tooltipMsg}}
            </div>
        </div>
    </div>

    <div class="cal-modal-overlay" id="modalOverlay" @click.stop.prevent="closeModal">
        <div class="modal-container" style="min-width: 80vw; max-width: 80vw;"
            :style="modalMode == 'Opci√≥n' && 'padding: 0;'">
            <div style=" position: relative;">
                <img src="../../img/ico/svg/cerrar-transparente.svg" @click="closeModal($event, true)"
                    class="modal-cerrar" v-if="modalMode != 'Opci√≥n'">

                <div v-show="modalMode == 'grafica'">
                    <h2 style="text-align: center; margin-bottom: .5rem;">
                        <span v-if="chartMode == 'acciones_asesor'">Informe trazabilidad acciones por asesor</span>
                        <span v-if="chartMode == 'temporal_asesor'">Informe temporal acciones por asesor</span>
                        <span v-if="chartMode == 'temporal_unidad'">Informe temporal acciones por unidad</span>
                        <span v-if="chartMode == 'total_acciones'">Informe efectividad acciones {{groupMode ==
                            'porc_visitas' ? ' - sobre visitas' : ''}}</span>
                    </h2>

                    <div style="display: flex; justify-content: center; width: 100%; gap: 2rem;">
                        <select v-model="chartMode" style="width: 10rem;" @change="setGroupMode();resetChart()">
                            <option value="acciones_asesor">Acciones por Asesor</option>
                            <option value="temporal_asesor">Temporal Asesor</option>
                            <option value="temporal_unidad">Temporal Unidad</option>
                            <option value="total_acciones">Efectividad Acciones</option>
                        </select>
                        <select v-if="chartMode == 'acciones_asesor' || chartMode == 'temporal_asesor'"
                            style="width: 10rem;" v-model="filIdSala" @change="resetChart">
                            <option value="">[Salas]</option>
                            <option v-for="s in salas" :value="s.id_sala_venta">{{s.sala_venta}}</option>
                        </select>
                        <select v-if="chartMode == 'temporal_unidad'" v-model="groupMode" style="width: 10rem;"
                            @change="resetChart">
                            <option value="sede">Sede</option>
                            <option value="zona">Zona</option>
                            <option value="ciudadela">Ciudadela</option>
                            <option value="proyecto">Proyecto</option>
                        </select>
                        <select v-if="chartMode == 'total_acciones'" v-model="groupMode" style="width: 10rem;"
                            @change="resetChart">
                            <option value="total">Totales</option>
                            <option value="porc_visitas">Porcentaje sobre visitas</option>
                        </select>
                        <select v-if="chartMode == 'total_acciones'" v-model="filIdProyecto" style="width: 10rem;"
                            @change="resetChart">
                            <option value="">[Proyectos]</option>
                            <option v-for="p in proyectos" :value="p.id_proyecto">{{p.proyecto}}</option>
                        </select>
                        <button @click="exportChart">Exportar</button>
                        <label v-if="chartMode == 'temporal_asesor'" @click="verBarras = !verBarras; resetChart();"
                            style="display: flex; align-items: baseline; padding-top: 5px;">
                            <input style="pointer-events: none;" type="checkbox" v-model="verBarras">
                            Barras
                        </label>
                    </div>

                    <div class="unidades-tabla-modal" style="height: 66vh;">
                        <canvas id="chart-js"></canvas>
                    </div>

                    <div style="display: flex; gap: .5rem">
                        <div v-if="!filtros.trazabilidad.asesor && chartMode === 'acciones_asesor'"
                            class="checkbox-group horizontal-bar-checks" style="flex: 5;">
                            <label @click="selTodosAs = !selTodosAs; onSelTodosAs()">
                                <input style="pointer-events: none;" type="checkbox" v-model="selTodosAs">
                                Todos
                            </label>
                            <label v-for="a in filAsesorSala" @click="toggleAsesor(a)">
                                <input style="pointer-events: none;" type="checkbox" v-model="a.selected">
                                {{a.nombres}}
                            </label>
                        </div>
                        <div class="checkbox-group horizontal-bar-checks" style="flex: 5;"
                            v-if="!filtros.trazabilidad.obj && (chartMode === 'temporal_asesor' || chartMode === 'temporal_unidad')">
                            <label @click="selTodosAcc = !selTodosAcc; onSelTodosAcc()">
                                <input style="pointer-events: none;" type="checkbox" v-model="selTodosAcc">
                                Todos
                            </label>
                            <label v-for="a in acciones" @click="toggleAccion(a)">
                                <input style="pointer-events: none;" type="checkbox" v-model="a.selected">
                                {{ a.accion }}
                            </label>
                        </div>
                    </div>
                </div>
                <div v-show="modalMode == 'Cotizaci√≥n'">
                    <h2 style="text-align: center; margin-bottom: .5rem;">
                        Detalles Cotizaci√≥n
                    </h2>
                    <div style="display: flex; gap: 1rem;">
                        <div style="display: flex; flex-direction: column;">
                            <div class="infoModal">
                                <h3>Cotizaci√≥n #{{infoCotizacion.cotizacion}}</h3>
                                <p>
                                    <span style="font-weight: bold;">Fecha: </span>
                                    <span>{{infoCotizacion.fecha}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Proyecto: </span>
                                    <span>{{infoCotizacion.proyecto}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Descripcion: </span>
                                    <span>{{infoCotizacion.descripcion}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Valor Total: </span>
                                    <span>{{formatoMoneda(f_total)}}</span>
                                </p>
                            </div>
                            <div class="infoModal">
                                <h3>Datos del Cliente</h3>
                                <p>
                                    <span style="font-weight: bold;">Nombre: </span>
                                    <span>{{infoCotizacion.nombre}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Documento: </span>
                                    <span>{{infoCotizacion.tipo_documento}}. {{infoCotizacion.numero_documento}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Tel√©fono: </span>
                                    <span>{{infoCotizacion.codigo_tel}} {{infoCotizacion.telefono}}</span>
                                </p>
                                <p>
                                    <span style="font-weight: bold;">Email: </span>
                                    <span>{{infoCotizacion.email}}</span>
                                </p>
                            </div>
                            <div>
                                <h3>Unidades</h3>
                                <div style="max-height: 145px; overflow-y: auto;">
                                    <table class="dataTable">
                                        <thead>
                                            <tr>
                                                <th>Unidad</th>
                                                <th>Torre</th>
                                                <th style="width: 150px;">Fecha</th>
                                                <th>Lista</th>
                                                <th>Descuento Base</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="a in aptos" @click="selectApto(a)"
                                                v-bind:class="{'selected': a == selectedApto}">
                                                <td>{{a.nombre_unidad}}</td>
                                                <td>{{a.torre}}</td>
                                                <td>{{a.fecha}}</td>
                                                <td>{{a.lista}}</td>
                                                <td>{{formatoMoneda(a.valor_descuento)}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="aptos-detail" v-if="selectedApto">
                                <div class="tabs-floating">
                                    <div :class="{ active: activeTab === 'detalle' }" @click="activeTab = 'detalle'">
                                        üìù Detalle
                                    </div>
                                    <div :class="{ active: activeTab === 'imagenes' }" @click="activeTab = 'imagenes'">
                                        üñºÔ∏è Im√°genes
                                    </div>
                                </div>
                                <div class="tab-card">
                                    <div v-if="activeTab === 'detalle'">
                                        <h3 v-if="selectedApto.id_agrupacion == ''">Valor Unidad: {{
                                            formatoMoneda(selectedApto.valor_unidad) }}</h3>
                                        <h3 v-else>Valor Agrupaci√≥n: {{ formatoMoneda(selectedApto.agrupacion_total) }}
                                        </h3>
                                        <ul class="detail-list">
                                            <li v-if="selectedApto.id_agrupacion != ''"><span class="label">üèòÔ∏è
                                                    Agrupaci√≥n:</span> {{ selectedApto.agrupacion_descripcion}}</li>
                                            <li><span class="label">üí∞ Descuento:</span> {{
                                                formatoMoneda(selectedApto.valor_descuento) }}
                                            </li>
                                            <li>
                                                <span class="label">üí∞ Valor Final:</span>
                                                {{ calcularValorFinal(selectedApto) }}
                                            </li>
                                            <li><span class="label">üìê Tipo:</span> {{ selectedApto.codigo_planta }}
                                            </li>
                                            <li><span class="label">üè† ID Unidad:</span> {{ selectedApto.apartamento }}
                                            </li>
                                            <li><span class="label">üìä Estatus:</span> {{ selectedApto.estatus }}</li>
                                            <li><span class="label">üìç Localizaci√≥n:</span> {{ selectedApto.localizacion
                                                }}</li>
                                            <li><span class="label">üîß UT:</span> {{ selectedApto.inv_terminado == 1 ?
                                                'SI' : 'NO' }}</li>
                                            <li><span class="label">üìè √Årea Priv. Cubierta:</span>
                                                <samp class="area-card">{{ selectedApto.area_privada_cub }}</samp>
                                            </li>
                                            <li><span class="label">üèóÔ∏è √Årea Total Construida:</span>
                                                <samp class="area-card">{{ selectedApto.area_total }}</samp>
                                            </li>
                                            <li><span class="label">‚òÄÔ∏è Asoleaci√≥n:</span>
                                                {{ selectedApto.asoleacion == 'PM' ? 'Sol de ma√±ana' : 'Sol de tarde' }}
                                            </li>
                                            <li><span class="label">ü§ù Asesor</span> {{infoCotizacion.asesor}}</li>
                                            <li class="observacion-item">
                                                <span class="label">üìù Observaci√≥n:</span>
                                                <div class="observacion-text">{{ selectedApto.observacion_apto }}</div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div v-if="activeTab === 'imagenes'">
                                        <div class="image-gallery-container">
                                            <div class="image-gallery">
                                                <img :src="tipoProyecto" @click="openImgModal(tipoProyecto)" />
                                            </div>
                                            <div class="image-gallery">
                                                <img :src="plantProyecto" @click="openImgModal(plantProyecto)" />
                                            </div>
                                            <div class="image-gallery" style="height: 195px;">
                                                <iframe id="v-player" :src="recorrido" frameborder="0" allowfullscreen
                                                    allow="xr-spatial-tracking">
                                                </iframe>
                                            </div>
                                        </div>

                                        <div v-if="showModal" class="modal-overlay" @click="closeImgModal"
                                            style="z-index: 1000;">
                                            <div class="modal-content" @click.stop>
                                                <span class="close" @click="closeImgModal">&times;</span>
                                                <img :src="modalImage" class="modal-img" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="action-footer">
                                </div>
                            </div>
                            <div v-else class="aptos-detail"></div>
                        </div>
                    </div>

                </div>
                <div class="modal-card-large" v-show="modalMode == 'Opci√≥n'" style="width: 100%;">
                    <div class="modal-header">
                        <h2>{{tablaAmortizacion ? 'Tabla Amortizaci√≥n' : 'Detalles del c√°lculo'}}</h2>
                        <div style="display: flex; gap: 1rem;">
                            <div v-if="!tablaAmortizacion" class="close-btn size-1-5" @click="generarTabla">üìÖ</div>
                            <div v-else class="close-btn size-1-5" @click="tablaAmortizacion = false; ">üìã</div>
                            <div class="close-btn size-1-5" @click="closeModal($event, true); tablaAmortizacion = false;">‚úñ</div>
                        </div>
                    </div>
                    <div class="modal-body" style="padding-top: 0;">
                        <div v-if="!tablaAmortizacion" class="grid-detalles elegante" style="padding: .5rem;">
                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>IMPORTE TOTAL DE LA OPERACI√ìN</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Importe Unidades <strong>(A):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.importeOriginal)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Acabados <strong>(B):</strong>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ infoOpcion.f_valor_acabados }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Reformas <strong>(C):</strong>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ infoOpcion.reformaActivo }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Descuento Adicional <strong>(D):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_descuento_adicional)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Importe Total <strong>(E):</strong>
                                            <div class="formula-pequena">
                                                ((A)+(B)+(C)-(D))
                                            </div>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{formatoMoneda(infoOpcion.importeActiva)}}</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>IMPORTE M√ÅXIMO FINANCIABLE Y CUOTA MENSUAL HIPOTECA</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Modalidad Financiaci√≥n:
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ infoOpcion.tipoFinanciacionSeleccionada ||
                                                'N/A'
                                                }}</span>
                                        </div>
                                    </li>
                                    <li>A√±os Financiaci√≥n:
                                        <span class="valor-badge">{{ infoOpcion.anioSeleccionado || 'N/A' }}</span>
                                    </li>
                                    <li>
                                        <div>
                                            Factor/mill√≥n <strong>(F):</strong>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ infoOpcion.f_factorBanco || 'N/A' }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            M√°ximo Financiable <strong>(G):</strong>
                                            <div class="formula-pequena">
                                                {{infoOpcion.porcentajeFinanciacion}}%(A-D)
                                            </div>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.valor_credito_base)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Cuota mes M√°x. financiable <strong>(H):</strong>

                                            <div class="formula-pequena">
                                                (G)x(F) / 1e6
                                            </div>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.valorCreditoMillonFormateado)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            <strong>(Nota):</strong>

                                            <div class="formula-pequena">
                                                M√°x. financiable: porcentaje de financiaci√≥n aplicado al total de la
                                                operaci√≥n.
                                                Cuota m√°x.: resultado de multiplicar el monto financiado por el
                                                factor/mill√≥n del plazo del cr√©dito.
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-detalle" v-if="infoOpcion.excedentePagoCuotaInicial > 0">
                                <div class="card-header">
                                    <h3 style="color: black;">AJUSTE POR EXCEDENTE EN CUOTA INICIAL</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Importe Financiaci√≥n Base:
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.valor_credito_final_base)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Excedente Pagado en Cuota Inicial:
                                        </div>
                                        <div>
                                            <span class="valor-badge"
                                                style="color: #27ae60; font-weight: bold;">{{formatoMoneda(infoOpcion.excedentePagoCuotaInicial)}}</span>
                                        </div>
                                    </li>
                                    <li style="border-top: 2px solid #27ae60; padding-top: 0.5rem; margin-top: 0.5rem;">
                                        <div>
                                            <strong>Importe Financiaci√≥n Ajustado:</strong>
                                        </div>
                                        <div>
                                            <span class="valor-badge"
                                                style="color: #2980b9; font-weight: bold;">{{formatoMoneda(infoOpcion.importeFinanciacionAjustado)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            <strong>(Nota):</strong>

                                            <div class="formula-pequena">
                                                El cliente pag√≥ m√°s de lo requerido en la cuota inicial. Este
                                                excedente se aplica para reducir el importe de financiaci√≥n,
                                                resultando en un menor monto a financiar.
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>IMPORTE PERMISIBLE POR INGRESOS DE LA UNIDAD FAMILIAR</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Ingresos de la Unidad Familiar <strong>(I):</strong>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ formatoMoneda(infoOpcion.f_ingresos_mensuales)
                                                }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Cuota m√°x. permisible UF <strong style="font-weight: bold;">(J):</strong>
                                            <div class="formula-pequena">
                                                40% (I)
                                            </div>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ formatoMoneda(infoOpcion.cuotaMaxima) }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Ingresos Reqs. para m√°x. financiable <strong>(K):</strong>
                                            <div class="formula-pequena">
                                                (H) / 40%
                                            </div>
                                        </div>
                                        <div>
                                            <span class="valor-badge">{{ formatoMoneda(infoOpcion.minimoFamiliar)
                                                }}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Financiaci√≥n m√°x. permisible por ingresos UF:
                                            <div class="formula-pequena">
                                                Max. permisible (Cuota menor al 40% Ingre. grupo familiar)
                                            </div>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.valor_maxfinanciable)}}</span>
                                        </div>
                                    </li>
                                    <li> Cuota mensual permisible:
                                        <span class="valor-badge">{{formatoMoneda(infoOpcion.cuotaMaxima)}}</span>
                                    </li>
                                </ul>
                            </div>


                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>SEPARACI√ìN Y GASTOS DE ESCRITURA</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Separaci√≥n <strong>(L):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_separacion)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Gastos de Escritura <strong>(M):</strong>
                                            <div class="formula-pequena">
                                                (M1) + (M2) + (M3)
                                            </div>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_escrituras)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Notariales <strong>(M1):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_notariales)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Beneficiencia <strong>(M2):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_beneficiencia)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Registro <strong>(M3):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_registro)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            <strong>(Nota):</strong>

                                            <div class="formula-pequena">
                                                Nota: (1) Este valor de gastos notariales es aproximado. El valor
                                                final podr√≠a variar dependiendo de los anexos que
                                                lleve la escritura, las autenticaciones y biometrias de la misma.
                                                (2) Si el cliente quiere afectar el inmueble como
                                                vivienda familiar el valor se debe incrementar en $200.000.
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>SUBSIDIOS, CESANTIAS Y AHORROS</h3>
                                </div>
                                <ul>
                                    <li>
                                        <div>
                                            Subsidio <strong>(N):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.valor_subsidio)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Cesantias <strong>(O):</strong>
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_cesantias)}}</span>
                                        </div>
                                    </li>
                                    <li>
                                        <div>
                                            Ahorros:
                                        </div>
                                        <div>
                                            <span
                                                class="valor-badge">{{formatoMoneda(infoOpcion.f_valor_ahorros)}}</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="card-detalle">
                                <div class="card-header">
                                    <h3>FECHAS ESTIMADAS</h3>
                                </div>
                                <ul>
                                    <li>Entrega: <span class="valor-badge">{{ infoOpcion.display_fecha_entrega || 'N/A'
                                            }}</span>
                                    </li>
                                    <li>Escrituraci√≥n: <span class="valor-badge">{{
                                            infoOpcion.display_fecha_escrituracion ||
                                            'N/A' }}</span>
                                    </li>
                                    <li>1ra cuota: <span class="valor-badge">{{ infoOpcion.display_fecha_primera_cuota
                                            || 'N/A'
                                            }}</span>
                                    </li>
                                    <li>√öltima cuota: <span class="valor-badge">{{ infoOpcion.display_fecha_ultima_cuota
                                            ||
                                            'N/A' }}</span>
                                    </li>
                                    <li>Meses: <span class="valor-badge">{{ infoOpcion.d_meses || 'N/A' }}</span></li>
                                </ul>
                            </div>
                        </div>
                        <div v-else style="display: flex; justify-content: center;">
                            <div class="tabla-scroll-content" style="padding: 0; font-size: 15px; color: #111;">
                                <table class="dataTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 8%;">Concepto</th>
                                            <th style="width: 8%;">Fecha</th>
                                            <th style="width: 12%;">Saldo Inicial Periodo</th>
                                            <th style="width: 8%;">Cuota deseada</th>
                                            <th style="width: 10%;">Cuota Calculada</th>
                                            <th style="width: 8%;">Saldo Final</th>
                                            <th style="width: 22%;">Nota</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-top: 2px solid #009AB9;">
                                            <td style="text-align: left; padding: 8px; color: #f57c00;">Separaci√≥n
                                            </td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td style="text-align: right; padding: 8px; color: #f57c00;">{{
                                                formatoMoneda(infoOpcion.f_valor_separacion) }}</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: left; padding: 8px; color: #e64a19;">Gastos
                                                Escritura</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td style="text-align: right; padding: 8px; color: #e64a19;">{{
                                                formatoMoneda(infoOpcion.f_valor_escrituras) }}</td>
                                            <td></td>
                                        </tr>

                                        <tr v-for="(fila, index) in tablaPeriodos" :key="index">
                                            <td>Cuota No.{{ fila.periodo }}</td>
                                            <td>{{ fila.fecha }}</td>
                                            <td style="text-align: right;">{{ formatoMoneda(fila.saldo_inicial) }}
                                            </td>
                                            <td>
                                                <input type="text" v-model="fila.cuota_deseada"
                                                    @input="validar(index); recalcularFila(index)" class="input-cuota"
                                                    :class="{'input-modificado': (fila.cuota_deseada !== null &&fila.cuota_deseada !== '' &&!isNaN(Number(fila.cuota_deseada.toString().replace(/\D/g, ''))))}" />
                                            </td>
                                            <td style="text-align: right;">{{ formatoMoneda(fila.cuota_calculada) }}
                                            </td>
                                            <td :class="{'texto-negativo': Number(fila.saldo_final.toString().replace(/[^0-9.-]/g, '')) < 0}"
                                                style="text-align: right;">
                                                {{ formatoMoneda(fila.saldo_final) }}
                                            </td>
                                            <td><input type="text" class="input-cuota"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>