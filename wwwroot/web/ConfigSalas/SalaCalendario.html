<div style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard" style="height: calc(100vh - 8rem)">
        <div class='pure-u-1-3 pure-u-md-9-24 formDivision' style="font-size: 1.5em;">
            Fecha actual: {{ formatDatetime(null, 'date') }}
        </div>
        <div class='pure-u-2-3 pure-u-md-5-8 formDivision' style="font-size: 1.5em;">
            Fecha seleccionada: {{ formatDatetime(null, 'date', selDate) }}
        </div>
        <div style="display: flex; align-items: center; padding: 5px 0;">
            <div class="pure-u-1-1 pure-u-md-7-24">
                <div class="btn-view-group">
                    <div class="radio-group cal-opc">
                        <input type="radio" name="view" id="view-s1" :checked="viewMode.class == 's1'"
                            @click="updateViewMode('s1')" />
                        <label for="view-s1">
                            <span>1 semana</span>
                        </label>
                        <input type="radio" name="view" id="view-m1" :checked="viewMode.class == 'm1'"
                            @click="updateViewMode('m1')" />
                        <label for="view-m1">
                            <span>1 mes</span>
                        </label>
                        <input type="radio" name="view" id="view-m6" :checked="viewMode.class == 'm6'"
                            @click="updateViewMode('m6')" />
                        <label for="view-m6">
                            <span>6 meses</span>
                        </label>
                        <input type="radio" name="view" id="view-m12" :checked="viewMode.class == 'm12'"
                            @click="updateViewMode('m12')" />
                        <label for="view-m12">
                            <span>12 meses</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="pure-u-1-1 pure-u-md-1-12"></div>
            <div class="pure-u-1-1 pure-u-md-3-8">
                <div class="btn-view-group">
                    <div class="radio-group" style="gap: 1rem; padding-top: 0;">
                        <button style="padding: 5px .5rem;" @click="openModal(1)">Agregar
                            Hito</button>
                        <button style="padding: 5px .5rem;" @click="toggleHoliday">
                            {{currentDay.isHoliday ? 'Desmarcar festivo' : 'Marcar como festivo'}}
                        </button>
                    </div>
                </div>
            </div>
            <div class="pure-u-1-1 pure-u-md-1-4" style="text-align: end;">
                <div @click="!isToday() && setToday()" class="cal-btn today"
                    :style="isToday() ? 'background-color: #636363;' : ''">Ir a Hoy</div>
                <div @click="setDate(-1)" class="cal-btn"
                    style="border-top-right-radius: 0; border-bottom-right-radius: 0;">&lt;</div>
                <div @click="setDate(1)" class="cal-btn"
                    style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                    &gt;</div>
            </div>
        </div>
        <div style="display: flex; gap: 5px;">
            <div
                :class="`calendar pure-u-1-1 ${viewMode.class == 'm6' || viewMode.class == 'm12' ? 'pure-u-md-1-1' : 'pure-u-md-1-3'} ` + viewMode.class">
                <div class="cal-month"
                    v-for="i in Array.from({length: viewMode.months}, (_, i) => i + viewMode.initMonth)"
                    v-bind:class="{'cal-sel-month': viewMonths[nameMonths[i]].selected}">
                    <div class="cal-header">
                        <div class="cal-name-month">
                            <span>{{`${nameMonths[i]} - ${viewMonths[nameMonths[i]].year}`}}</span>
                        </div>
                    </div>
                    <div class="cal-header">
                        <div class="cal-name-day" v-for="name in nameDays">
                            <span>{{name}}</span>
                        </div>
                    </div>
                    <div class="cal-matrix">
                        <div class="cal-day" v-for="day in viewMonths[nameMonths[i]].days"
                            v-bind:class="{'cal-today': day.isToday, 'cal-fade-day': !day.currentMonth, 
                            'cal-sel-day': day.isSelected, 'cal-holiday': day.isHoliday, 'cal-sel-week': viewMode.class == 's1' && currentDay.weekCount == day.weekCount}"
                            @click="day.currentMonth && selDay(day, i)" :style="day.events && day.events.filter(e => e.festivo != '1').length ? 
                            `background-color: ${day.events.filter(e => e.festivo != '1')[0].color}40;` : ''"
                            @dblclick="day.currentMonth && day.events && day.events.filter(e => e.festivo != '1').length && openModal(3)">
                            <span>
                                {{day.monthDay}}
                            </span>
                            <div class="hide-editor" v-bind:class="{'cal-event-count': day.events && 
                            day.events.filter(e => e.festivo != '1').length}">
                                <span>{{day.events.filter(e => e.festivo != '1').length}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pure-u-1-1 pure-u-md-2-3 cal-table" v-if="viewMode.class == 's1' || viewMode.class == 'm1'">
                <table class="dataTable">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Titulo</th>
                            <th>Tipo</th>
                            <th>Rol</th>
                            <th>Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="day in tableDays"
                            :style="day.events.length 
                            ? ('background: ' + day.events[day.isHoliday && day.events[1] ? 1 : 0].color + '40;') : day.isHoliday ? 'background: #c8000040;' : ''">
                            <td>{{formatDatetime(null, 'date', day.date)}}</td>
                            <td>{{day.e_titulo}}</td>
                            <td>{{day.e_tipo}}</td>
                            <td>{{day.e_rol}}</td>
                            <td>{{day.e_hora}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="modalOverlay" @click="closeModal($event)">
        <div class="modal-content pure-g" v-if="mode == 1 || mode == 2">
            <img src="../../img/ico/svg/cerrar-transparente.svg" @click="closeModal($event, true)" class="modal-cerrar">
            <div class='pure-u-1-1 pure-u-md-1-1'>
                <h2 style="text-align: center;">{{ formatDatetime(null, 'date', selDate) }}</h2>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-1 formInputStandard'>
                <span>Titulo</span>
                <input type='text' maxlength="100" v-model="hito.titulo" />
            </div>
            <div class='pure-u-1-3 pure-u-md-1-3 formInputStandard'>
                <span>Hora</span>
                <input type='time' v-model="hito.hora" />
            </div>
            <div class='pure-u-1-6 pure-u-md-1-6 formInputStandard' style="text-align: center;">
                <span>Color</span>
                <input type='color' v-model="hito.color" />
            </div>
            <div class='pure-u-1-2 pure-u-md-1-2 formInputStandard' style="text-align: center;">
                <span style="margin-left: 22px;">Aplica para</span>
                <div style="display: flex; justify-content: space-around; padding-top: 5px;">

                    <label for="rad-pro"><input type="radio" name="event-type" id="rad-pro" :checked="hitoPro"
                            @change="hitoPro = true" /><span>Proyecto ({{proyecto.nombre}})</span></label>

                    <label for="rad-sala"><input type="radio" name="event-type" id="rad-sala" :checked="!hitoPro"
                            @change="hitoPro = false" /><span>Sala</span></label>
                </div>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-1 formInputStandard'>
                <span>Descripci√≥n</span>
                <textarea maxlength="255" v-model="hito.descripcion"
                    style="width: 100%; height: 100px; resize: none; font-size: 14px;"></textarea>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-6 formInputStandard'></div>
            <div class='pure-u-1-1 pure-u-md-1-3 formInputStandard'>
                <button @click="onCancel">Cancelar</button>
            </div>
            <div class='pure-u-1-1 pure-u-md-1-3 formInputStandard'>
                <button @click="onSave">Guardar</button>
            </div>
        </div>

        <div class="modal-content pure-g" v-if="mode == 3">
            <img src="../../img/ico/svg/cerrar-transparente.svg" @click="closeModal($event, true)" class="modal-cerrar">
            <div class="pure-u-1-1">
                <h2 style="text-align: center; margin-bottom: 1rem;">
                    Hitos del {{ formatDatetime(null, 'date', selDate) }}
                </h2>
            </div>
            <div class="event-list">
                <div v-for="e in currentDay.events.filter(e => e.festivo != '1')" class="event-card pure-g"
                    :style="`border: 1px solid ${e.color}90; border-left: 6px solid ${e.color}; background-color: ${e.color}10;`">
                    <div class="pure-u-5-6 pure-u-md-5-6">
                        <h4 class="event-title">
                            {{ e.titulo }} - {{ e.id_proyecto ? proyecto.nombre : sala.sala_venta }} - {{
                            formatDatetime(e.fecha, 'time') }}
                        </h4>
                        <p class="event-description">{{ e.descripcion }}</p>
                    </div>
                    <div class="event-edit-btn pure-u-1-12 pure-u-md-1-12">
                        <img src="../../img/ico/svg/pencil.svg" alt="Editar" @click="selEvent(e)">
                    </div>
                    <div class="event-edit-btn pure-u-1-12 pure-u-md-1-12">
                        <img src="../../img/ico/svg/cerrar-transparente.svg" alt="Eliminar" @click="reqDeleteEvent(e)">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>