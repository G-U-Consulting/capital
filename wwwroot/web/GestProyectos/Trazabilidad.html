<div v-if="mode == 0" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em; margin-bottom: 4px;">
            Trazabilidad
        </div>
        <div class="searchBox" style="padding: .5rem 0;">
            <div class="pure-g">
                <div class="pure-u-1-2 pure-u-md-1-4 formInputStandard">
                    <select v-model="selSede" @change="selCiu = {}; selPro = {}; selTorre = {}; unidades = []">
                        <option :value="{}">[Sedes]</option>
                        <option v-for="s in sedes" :value="s">
                            {{s.sede}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-4 formInputStandard">
                    <select v-model="selCiu" @change="selPro = {}; selTorre = {}; unidades = []">
                        <option :value="{}">[ciudadelas]</option>
                        <option v-for="c in ciudadelas.filter(i => !selSede.id_sede || i.id_sede === selSede.id_sede)"
                            :value="c">
                            {{c.ciudadela}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-4 formInputStandard">
                    <select v-model="selPro" @change="loadTorres(selPro)">
                        <option :value="{}">[Proyectos]</option>
                        <option v-for="p in proyectos
                                .filter(i => (!selSede.id_sede || i.id_sede === selSede.id_sede) 
                                    && (!selCiu.id_ciudadela || i.id_ciudadela === selCiu.id_ciudadela))" :value="p">
                            {{p.nombre}}
                        </option>
                    </select>
                </div>
                <div class="pure-u-1-2 pure-u-md-1-4 formInputStandard">
                    <select v-model="selTorre" @change="loadUnidades(selTorre)">
                        <option :value="{}">[Torres]</option>
                        <option v-for="t in selPro.torres" :value="t">
                            {{t.consecutivo}}
                        </option>
                    </select>
                </div>

                <div class='pure-u-1-2 pure-u-md-1-4 formInputStandard'>
                    <select v-model="filtros.unidades['id_clase']" class="pure-input-1">
                        <option :value="undefined">[Clase]</option>
                        <option v-for="c in clases" :value="c.id_clase">{{c.clase}}</option>
                    </select>
                </div>
                <div class='pure-u-1-2 pure-u-md-1-4 formInputStandard'>
                    <select v-model="filtros.unidades['id_tipo']" class="pure-input-1">
                        <option :value="undefined">[Tipos]</option>
                        <option v-for="t in tipos" :value="t.id_tipo">{{t.tipo}}</option>
                    </select>
                </div>
                <div class='pure-u-1-2 pure-u-md-1-4 formInputStandard'>
                    <input type="text" placeholder="ID Unidad" v-model="filtros.unidades['unidad']" maxlength="10" />
                </div>

            </div>
        </div>

        <div style="height: calc(100vh - 19rem); overflow-y: auto;">

            <table class="dataTable">
                <thead>
                    <tr>
                        <th style="width: 20%;">Unidad</th>
                        <th style="width: 15%;">Piso</th>
                        <th style="width: 25%;">Clase</th>
                        <th style="width: 20%;">Tipo</th>
                        <th style="width: 20%;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="u in getFilteredList('unidades')" @dblclick="onSelect(u)">
                        <td>{{u.unidad}}</td>
                        <td>{{u.piso}}</td>
                        <td>{{u.clase}}</td>
                        <td>{{u.tipo}}</td>
                        <td>{{u.estado_unidad}}</td>
                    </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>

<div v-if="mode == 1" style="padding: 1em">
    <div class="pure-u-1-24 pure-u-md-1-24"></div>
    <div class="pure-u-22-24 pure-u-md-22-24 menuCard">
        <div class='pure-u-1-1 pure-u-md-1-1 formDivision' style="font-size: 1.5em; margin-bottom: 4px;">
            Historial de cambios: {{unidad.unidad}}
        </div>

        <div class="pure-u-1-1" style="background: #f4f6f8; height: calc(100vh - 13rem); overflow-y: auto;">
            <div class="log-container">
                <div class="log-entry" v-for="log in unidad.logs">
                    <div class="log-header">
                        <div class="log-title" v-html="log.titulo"></div>
                        <div class="log-date">{{log.fecha}}</div>
                    </div>
                    <div class="log-content" v-html="log.texto"></div>
                    <div class="log-footer">
                        Responsable: {{log.usuario}}
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>